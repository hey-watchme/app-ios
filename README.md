# WatchMe - iOS éŒ²éŸ³ã‚¢ãƒ—ãƒª

## æ¦‚è¦

WatchMe ã¯ã€éŸ³å£°ã‚’30åˆ†é–“éš”ã§è‡ªå‹•åˆ†å‰²ã—ã¦éŒ²éŸ³ã—ã€AWS EC2ä¸Šã®`watchme-vault-api`ã‚µãƒ¼ãƒãƒ¼ã«è‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹iOSã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚é•·æ™‚é–“ã®éŒ²éŸ³ã§ã‚‚ç¢ºå®Ÿã«ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã•ã‚Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã«é–¢ä¿‚ãªãå®‰å®šã—ãŸãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ä¸»è¦æ©Ÿèƒ½

### ğŸ™ï¸ éŒ²éŸ³æ©Ÿèƒ½
- **30åˆ†è‡ªå‹•åˆ†å‰²éŒ²éŸ³**: æ­£ç¢ºãªæ™‚åˆ»å¢ƒç•Œï¼ˆæ¯æ™‚0åˆ†ãƒ»30åˆ†ï¼‰ã§ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²
- **é€£ç¶šéŒ²éŸ³å¯¾å¿œ**: ä½•æ™‚é–“éŒ²éŸ³ã—ã¦ã‚‚30åˆ†å˜ä½ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹
- **é«˜å“è³ªéŒ²éŸ³**: ãƒªãƒ‹ã‚¢PCM 16kHz, 16bit, ãƒ¢ãƒãƒ©ãƒ«å½¢å¼
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŒ²éŸ³æ™‚é–“è¡¨ç¤º**: 0.1ç§’é–“éš”ã§ã®æ™‚é–“æ›´æ–°
- **è‡ªå‹•ä¸Šæ›¸ãéŒ²éŸ³**: åŒä¸€æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆã¯ç¢ºèªãªã—ã§è‡ªå‹•ä¸Šæ›¸ã
- **å®Œå…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çŠ¶æ…‹ã‚’å®Œå…¨å‰Šé™¤

### â˜ï¸ ã‚¯ãƒ©ã‚¦ãƒ‰é€£æºæ©Ÿèƒ½
- **Supabaseèªè¨¼**: ãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
- **ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²**: Supabaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®è‡ªå‹•ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²ãƒ»ç®¡ç†
- **è‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: éŒ²éŸ³å®Œäº†æ™‚ã«è‡ªå‹•çš„ã«ã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- **çŠ¶æ…‹æ°¸ç¶šåŒ–**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çŠ¶æ…‹ã‚’UserDefaultsã§æ°¸ç¶šä¿å­˜
- **ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½**: å¤±æ•—æ™‚ã®è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ï¼ˆæœ€å¤§3å›ã¾ã§ï¼‰
- **é€²æ—è¡¨ç¤º**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€²æ—ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º

### ğŸ“± ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£
- **çµ±è¨ˆæƒ…å ±è¡¨ç¤º**: ç·éŒ²éŸ³æ•°ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿æ•°ã€å¾…æ©Ÿæ•°ã®è¡¨ç¤º
- **ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã€ä½œæˆæ—¥æ™‚ã€ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®è©³ç´°è¡¨ç¤º
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼IDç®¡ç†**: ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªãƒ¦ãƒ¼ã‚¶ãƒ¼è­˜åˆ¥å­
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: å¤ã„å½¢å¼ã‚„ç ´æãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€æ‹¬å‰Šé™¤

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
ios_watchme_v9/
â”œâ”€â”€ ios_watchme_v9App.swift          # ã‚¢ãƒ—ãƒªã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ MainAppView.swift               # ã‚¢ãƒ—ãƒªçŠ¶æ…‹ç®¡ç†ãƒ»èªè¨¼åˆ†å²
â”œâ”€â”€ LoginView.swift                 # ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ç”»é¢
â”œâ”€â”€ ContentView.swift               # ãƒ¡ã‚¤ãƒ³UIç”»é¢
â”œâ”€â”€ SupabaseAuthManager.swift       # Supabaseèªè¨¼ç®¡ç†
â”œâ”€â”€ DeviceManager.swift             # ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²ãƒ»ç®¡ç†
â”œâ”€â”€ RecordingModel.swift            # éŒ²éŸ³ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãƒ»æ°¸ç¶šåŒ–
â”œâ”€â”€ AudioRecorder.swift             # éŒ²éŸ³åˆ¶å¾¡ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
â”œâ”€â”€ NetworkManager.swift            # ã‚¯ãƒ©ã‚¦ãƒ‰é€šä¿¡ãƒ»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
â””â”€â”€ ConnectionStatus.swift          # æ¥ç¶šçŠ¶æ…‹å®šç¾©
```

### ã‚¯ãƒ©ã‚¹è¨­è¨ˆ

#### SupabaseAuthManager
```swift
class SupabaseAuthManager: ObservableObject {
    @Published var isAuthenticated: Bool = false
    @Published var currentUser: SupabaseUser? = nil
    @Published var authError: String? = nil
    @Published var isLoading: Bool = false
}
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `signIn(email:password:)`: ãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³
- `signUp(email:password:)`: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
- `signOut()`: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
- `refreshToken()`: JWTãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
- `fetchUserInfo()`: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãƒ»ç¢ºèªçŠ¶æ…‹ã®å–å¾—

#### DeviceManager
```swift
class DeviceManager: ObservableObject {
    @Published var isDeviceRegistered: Bool = false
    @Published var currentDeviceID: String? = nil
    @Published var registrationError: String? = nil
    @Published var isLoading: Bool = false
}
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `registerDevice(ownerUserID:)`: Supabaseã¸ã®ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²ï¼ˆUPSERTï¼‰
- `getDeviceInfo()`: ç™»éŒ²æ¸ˆã¿ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã®å–å¾—
- `resetDeviceRegistration()`: ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²çŠ¶æ…‹ã®ãƒªã‚»ãƒƒãƒˆ

**ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²ãƒ•ãƒ­ãƒ¼**:
1. `UIDevice.current.identifierForVendor`ã§ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è­˜åˆ¥å­å–å¾—
2. Supabaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«`platform_identifier`ãƒ»`owner_user_id`ã§UPSERT
3. æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Œã°å†åˆ©ç”¨ã€ãªã‘ã‚Œã°æ–°è¦ä½œæˆ
4. `device_id`ã‚’UserDefaultsã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦é«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹

#### RecordingModel
```swift
class RecordingModel: ObservableObject, Codable {
    @Published var fileName: String          // ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆHH-mm.wavå½¢å¼ï¼‰
    @Published var date: Date               // ä½œæˆæ—¥æ™‚
    @Published var isUploaded: Bool         // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ãƒ•ãƒ©ã‚°
    @Published var fileSize: Int64          // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆbytesï¼‰
    @Published var uploadAttempts: Int      // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è©¦è¡Œå›æ•°
    @Published var lastUploadError: String? // æœ€å¾Œã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
}
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `markAsUploaded()`: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸæ™‚ã®çŠ¶æ…‹æ›´æ–°
- `markAsUploadFailed(error:)`: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—æ™‚ã®çŠ¶æ…‹æ›´æ–°
- `resetUploadStatus()`: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çŠ¶æ…‹ã®ãƒªã‚»ãƒƒãƒˆ
- `fileExists()`: ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
- `canUpload`: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½æ€§åˆ¤å®š

#### AudioRecorder
```swift
class AudioRecorder: NSObject, ObservableObject {
    @Published var isRecording: Bool         // éŒ²éŸ³çŠ¶æ…‹
    @Published var recordings: [RecordingModel] // éŒ²éŸ³ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§
    @Published var recordingTime: TimeInterval  // éŒ²éŸ³çµŒéæ™‚é–“
    @Published var currentSlot: String       // ç¾åœ¨ã®ã‚¹ãƒ­ãƒƒãƒˆæ™‚åˆ»
}
```

**éŒ²éŸ³åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼**:
1. `startRecording()`: éŒ²éŸ³é–‹å§‹ãƒ»åˆæœŸã‚¹ãƒ­ãƒƒãƒˆè¨­å®š
2. `handleExistingRecording()`: åŒä¸€ã‚¹ãƒ­ãƒƒãƒˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•ä¸Šæ›¸ãå‡¦ç†
3. `startRecordingForCurrentSlot()`: ç¾åœ¨ã‚¹ãƒ­ãƒƒãƒˆã§ã®éŒ²éŸ³é–‹å§‹
4. `setupSlotSwitchTimer()`: 30åˆ†å¢ƒç•Œã§ã®åˆ‡ã‚Šæ›¿ãˆã‚¿ã‚¤ãƒãƒ¼è¨­å®š
5. `performSlotSwitch()`: ã‚¹ãƒ­ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆå®Ÿè¡Œ
6. `finishCurrentSlotRecording()`: ç¾åœ¨ã‚¹ãƒ­ãƒƒãƒˆéŒ²éŸ³å®Œäº†ãƒ»ä¿å­˜
7. `stopRecording()`: éŒ²éŸ³åœæ­¢ãƒ»æœ€çµ‚ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜

**ã‚¹ãƒ­ãƒƒãƒˆæ™‚åˆ»ç®—å‡º**:
```swift
private func getCurrentSlot() -> String {
    let now = Date()
    let calendar = Calendar.current
    let components = calendar.dateComponents([.hour, .minute], from: now)
    
    let hour = components.hour ?? 0
    let minute = components.minute ?? 0
    let adjustedMinute = minute < 30 ? 0 : 30
    
    return String(format: "%02d-%02d", hour, adjustedMinute)
}
```

#### NetworkManager
```swift
class NetworkManager: ObservableObject {
    @Published var serverURL: String = "https://api.hey-watch.me"
    @Published var connectionStatus: ConnectionStatus
    @Published var currentUserID: String
    @Published var uploadProgress: Double
    @Published var currentUploadingFile: String?
}
```

## ã‚µãƒ¼ãƒãƒ¼é€£æºä»•æ§˜

### ã‚µãƒ¼ãƒãƒ¼æƒ…å ±
- **ã‚µãƒ¼ãƒãƒ¼å**: `watchme-vault-api`
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: AWS EC2
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `https://api.hey-watch.me/upload`
- **ãƒ—ãƒ­ãƒˆã‚³ãƒ«**: HTTPS
- **ãƒ¡ã‚½ãƒƒãƒ‰**: POST
- **Content-Type**: multipart/form-data

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜

#### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```
POST https://api.hey-watch.me/upload
```

#### ãƒ˜ãƒƒãƒ€ãƒ¼
```http
Content-Type: multipart/form-data; boundary={UUID}
```

#### ãƒœãƒ‡ã‚£æ§‹é€ 
```http
--{boundary}
Content-Disposition: form-data; name="user_id"

{currentUserID}
--{boundary}
Content-Disposition: form-data; name="timestamp"

{ISO8601å½¢å¼ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—}
--{boundary}
Content-Disposition: form-data; name="device_id"

{Supabaseç™»éŒ²æ¸ˆã¿ãƒ‡ãƒã‚¤ã‚¹ID}
--{boundary}
Content-Disposition: form-data; name="file"; filename="{fileName}"
Content-Type: audio/wav

{ãƒã‚¤ãƒŠãƒªéŸ³å£°ãƒ‡ãƒ¼ã‚¿}
--{boundary}--
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼è©³ç´°

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ | å‹ | å¿…é ˆ | èª¬æ˜ | ä¾‹ |
|---|---|---|---|---|
| user_id | String | â—‹ | ãƒ¦ãƒ¼ã‚¶ãƒ¼è­˜åˆ¥å­ï¼ˆèªè¨¼æ¸ˆã¿User IDï¼‰ | `164cba5a-dba6-4cbc-9b39-4eea28d98fa5` |
| timestamp | String | â—‹ | ISO8601å½¢å¼ã®éŒ²éŸ³ä½œæˆæ—¥æ™‚ | `2025-06-24T13:00:00Z` |
| device_id | String | â—‹ | Supabaseç™»éŒ²æ¸ˆã¿ãƒ‡ãƒã‚¤ã‚¹ID | `device_uuid_12345` |
| file | Binary | â—‹ | WAVå½¢å¼ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ« | ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ |

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä»•æ§˜

#### æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "status": "success",
  "message": "File uploaded successfully",
  "file_id": "recording_20250624_1300_user12345",
  "uploaded_at": "2025-06-24T13:01:23Z"
}
```

#### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
```http
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
  "status": "error",
  "message": "Invalid file format",
  "error_code": "INVALID_FORMAT"
}
```

### å®Ÿè£…ã‚³ãƒ¼ãƒ‰ä¾‹

```swift
func uploadRecording(_ recording: RecordingModel) {
    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‰ãƒã‚§ãƒƒã‚¯
    guard recording.canUpload else { return }
    
    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨­å®š
    guard let uploadURL = URL(string: "\(serverURL)/upload") else { return }
    var request = URLRequest(url: uploadURL)
    request.httpMethod = "POST"
    request.timeoutInterval = 120.0
    
    // Boundaryè¨­å®š
    let boundary = UUID().uuidString
    request.setValue("multipart/form-data; boundary=\(boundary)", 
                     forHTTPHeaderField: "Content-Type")
    
    // ãƒœãƒ‡ã‚£æ§‹ç¯‰
    var body = Data()
    
    // user_idãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
    body.append("--\(boundary)\r\n".data(using: .utf8)!)
    body.append("Content-Disposition: form-data; name=\"user_id\"\r\n\r\n".data(using: .utf8)!)
    body.append("\(currentUserID)\r\n".data(using: .utf8)!)
    
    // timestampãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
    let timestampFormatter = ISO8601DateFormatter()
    let timestampString = timestampFormatter.string(from: recording.date)
    body.append("--\(boundary)\r\n".data(using: .utf8)!)
    body.append("Content-Disposition: form-data; name=\"timestamp\"\r\n\r\n".data(using: .utf8)!)
    body.append("\(timestampString)\r\n".data(using: .utf8)!)
    
    // fileãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
    let fileData = try Data(contentsOf: recording.getFileURL())
    body.append("--\(boundary)\r\n".data(using: .utf8)!)
    body.append("Content-Disposition: form-data; name=\"file\"; filename=\"\(recording.fileName)\"\r\n".data(using: .utf8)!)
    body.append("Content-Type: audio/wav\r\n\r\n".data(using: .utf8)!)
    body.append(fileData)
    body.append("\r\n--\(boundary)--\r\n".data(using: .utf8)!)
    
    request.httpBody = body
    
    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
    URLSession.shared.dataTask(with: request) { data, response, error in
        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†
        if let httpResponse = response as? HTTPURLResponse,
           httpResponse.statusCode == 200 {
            recording.markAsUploaded()
        } else {
            recording.markAsUploadFailed(error: "Upload failed")
        }
    }.resume()
}
```

## éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ä»•æ§˜

### ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: WAV (Waveform Audio File Format)
- **ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯**: ãƒªãƒ‹ã‚¢PCM
- **ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆ**: 16,000 Hz (16kHz)
- **ãƒ“ãƒƒãƒˆæ·±åº¦**: 16 bit
- **ãƒãƒ£ãƒ³ãƒãƒ«æ•°**: 1 (ãƒ¢ãƒãƒ©ãƒ«)

### ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡
```
{æ™‚åˆ»ã‚¹ãƒ­ãƒƒãƒˆ}.wav

ä¾‹:
- 13-00.wav (13:00-13:29ã®éŒ²éŸ³)
- 13-30.wav (13:30-13:59ã®éŒ²éŸ³)
- 14-00.wav (14:00-14:29ã®éŒ²éŸ³)
```

### AVAudioRecorderè¨­å®š
```swift
let settings: [String: Any] = [
    AVFormatIDKey: Int(kAudioFormatLinearPCM),
    AVSampleRateKey: 16000.0,  // 16kHzã«è¨­å®š
    AVNumberOfChannelsKey: 1,
    AVLinearPCMBitDepthKey: 16,
    AVLinearPCMIsFloatKey: false,
    AVLinearPCMIsBigEndianKey: false,
    AVEncoderAudioQualityKey: AVAudioQuality.medium.rawValue
]
```

## ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ä»•æ§˜

### UserDefaultsæ§‹é€ 
```swift
// ã‚­ãƒ¼: "recordingUploadStatus"
// å€¤: [String: RecordingStatus]ã®è¾æ›¸

struct RecordingStatus: Codable {
    let isUploaded: Bool
    let uploadAttempts: Int
    let lastUploadError: String?
}
```

### ä¿å­˜ãƒ‡ãƒ¼ã‚¿ä¾‹
```json
{
  "13-00.wav": {
    "isUploaded": true,
    "uploadAttempts": 1,
    "lastUploadError": null
  },
  "13-30.wav": {
    "isUploaded": false,
    "uploadAttempts": 2,
    "lastUploadError": "Network timeout"
  }
}
```

### æ°¸ç¶šåŒ–æ“ä½œ
```swift
// çŠ¶æ…‹ä¿å­˜
func saveUploadStatus() {
    var statusDict: [String: RecordingStatus] = [:]
    
    // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    if let data = UserDefaults.standard.data(forKey: uploadStatusKey),
       let existingDict = try? JSONDecoder().decode([String: RecordingStatus].self, from: data) {
        statusDict = existingDict
    }
    
    // ç¾åœ¨çŠ¶æ…‹ä¿å­˜
    statusDict[fileName] = RecordingStatus(
        isUploaded: isUploaded,
        uploadAttempts: uploadAttempts,
        lastUploadError: lastUploadError
    )
    
    if let data = try? JSONEncoder().encode(statusDict) {
        UserDefaults.standard.set(data, forKey: uploadStatusKey)
    }
}
```

## UIè¨­è¨ˆä»•æ§˜

### ãƒ¡ã‚¤ãƒ³ç”»é¢æ§‹æˆ
1. **ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨**: ã‚¢ãƒ—ãƒªã‚¿ã‚¤ãƒˆãƒ« "WatchMe"
2. **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹éƒ¨**: æ¥ç¶šçŠ¶æ³ã¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€²æ—
3. **è¨­å®šéƒ¨**: ã‚µãƒ¼ãƒãƒ¼URLãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼IDè¡¨ç¤ºãƒ»å¤‰æ›´
4. **éŒ²éŸ³åˆ¶å¾¡éƒ¨**: éŒ²éŸ³é–‹å§‹/åœæ­¢ãƒœã‚¿ãƒ³ã€ç¾åœ¨ã‚¹ãƒ­ãƒƒãƒˆæƒ…å ±
5. **çµ±è¨ˆéƒ¨**: ç·éŒ²éŸ³æ•°ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿æ•°ã€å¾…æ©Ÿæ•°
6. **ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§éƒ¨**: éŒ²éŸ³ãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°ä¸€è¦§

### éŒ²éŸ³ä¸­UI
```swift
VStack(spacing: 8) {
    Text("ğŸ”´ éŒ²éŸ³ä¸­...")
        .font(.headline)
        .foregroundColor(.red)
    
    Text(audioRecorder.formatTime(audioRecorder.recordingTime))
        .font(.title2)
        .fontWeight(.bold)
        .foregroundColor(.red)
    
    Text(audioRecorder.getCurrentSlotInfo())
        .font(.caption)
        .foregroundColor(.secondary)
}
```

### ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§é …ç›®
```swift
HStack {
    VStack(alignment: .leading) {
        Text(recording.fileName)           // ãƒ•ã‚¡ã‚¤ãƒ«å
        Text(recording.fileSizeFormatted) // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º
        Text("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰: \(recording.isUploaded ? "âœ…" : "âŒ")") // çŠ¶æ…‹
        if recording.uploadAttempts > 0 {
            Text("è©¦è¡Œ: \(recording.uploadAttempts)/3") // è©¦è¡Œå›æ•°
        }
    }
    
    Spacer()
    
    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ or ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
    if recording.canUpload {
        Button("ğŸ“¤") { networkManager.uploadRecording(recording) }
    } else if !recording.isUploaded {
        Button("ğŸ”„") { recording.resetUploadStatus() }
    }
    
    // å‰Šé™¤ãƒœã‚¿ãƒ³
    Button("ğŸ—‘ï¸") { audioRecorder.deleteRecording(recording) }
}
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. é–‹ç™ºç’°å¢ƒè¦ä»¶
- **Xcode**: 15.0ä»¥ä¸Š
- **iOS SDK**: 18.0ä»¥ä¸Š
- **Swift**: 5.9ä»¥ä¸Š
- **å¯¾è±¡iOS**: 18.5ä»¥ä¸Š

### 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
```bash
# æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
# Xcode > File > New > Project
# iOS > App > SwiftUI
```

### 3. ä¾å­˜é–¢ä¿‚è¿½åŠ 
**Supabase Swift ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ ï¼š
```
1. Xcode > File > Add Package Dependencies
2. URL: https://github.com/supabase/supabase-swift
3. Version: 2.5.1ä»¥ä¸Š
4. Target: ios_watchme_v9ã«è¿½åŠ 
```

### 4. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆãƒ»é…ç½®ï¼š
- `ios_watchme_v9App.swift`
- `MainAppView.swift`
- `LoginView.swift`
- `ContentView.swift`
- `SupabaseAuthManager.swift`
- `DeviceManager.swift`
- `RecordingModel.swift`
- `AudioRecorder.swift`
- `NetworkManager.swift`
- `ConnectionStatus.swift`

### 5. Info.plistè¨­å®š
```xml
<key>NSMicrophoneUsageDescription</key>
<string>ã“ã®ã‚¢ãƒ—ãƒªã¯éŸ³å£°éŒ²éŸ³ã®ãŸã‚ã«ãƒã‚¤ã‚¯ãƒ­ãƒ•ã‚©ãƒ³ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã§ã™</string>
```

### 6. ã‚µãƒ¼ãƒãƒ¼è¨­å®š
NetworkManager.swiftã®`serverURL`ã‚’é©åˆ‡ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«è¨­å®šï¼š
```swift
@Published var serverURL: String = "https://api.hey-watch.me"
```

### 7. ãƒ“ãƒ«ãƒ‰ãƒ»å®Ÿè¡Œ
```bash
xcodebuild -project ios_watchme_v9.xcodeproj \
           -scheme ios_watchme_v9 \
           -destination 'platform=iOS Simulator,name=iPhone 16' \
           build
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–

#### 1. ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦
**ç—‡çŠ¶**: éŒ²éŸ³ãŒé–‹å§‹ã•ã‚Œãªã„
**è§£æ±º**: è¨­å®š > ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ > ãƒã‚¤ã‚¯ãƒ­ãƒ•ã‚©ãƒ³ã§ã‚¢ãƒ—ãƒªã‚’è¨±å¯

#### 2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå¤±æ•—ã™ã‚‹
**è§£æ±º**: 
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šç¢ºèª
- ã‚µãƒ¼ãƒãƒ¼URLè¨­å®šç¢ºèª
- ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šç¢ºèª

#### 3. ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã•ã‚Œãªã„
**ç—‡çŠ¶**: é•·æ™‚é–“éŒ²éŸ³ã§1ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¾ã¾
**è§£æ±º**:
- ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
- ã‚¹ãƒ­ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆãƒ­ã‚°ç¢ºèª
- ã‚¢ãƒ—ãƒªã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œåˆ¶é™ç¢ºèª

#### 4. ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çŠ¶æ…‹ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹
**ç—‡çŠ¶**: ã‚¢ãƒ—ãƒªå†èµ·å‹•ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãŒæœªå‡¦ç†ã«ãªã‚‹
**è§£æ±º**:
- UserDefaultsèª­ã¿è¾¼ã¿å‡¦ç†ç¢ºèª
- JSON ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰ç¢ºèª

#### 5. åŒä¸€ã‚¹ãƒ­ãƒƒãƒˆéŒ²éŸ³ã®é‡è¤‡å•é¡Œ
**ç—‡çŠ¶**: æ—¢å­˜éŒ²éŸ³ãŒæ®‹ã‚Šã€é‡è¤‡ãƒ•ã‚¡ã‚¤ãƒ«ãŒç™ºç”Ÿ
**è§£æ±º**:
- `handleExistingRecording()`ãƒ¡ã‚½ãƒƒãƒ‰ã®å‹•ä½œç¢ºèª
- ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤æ¨©é™ã®ç¢ºèª
- UserDefaultsçŠ¶æ…‹ã‚¯ãƒªã‚¢å‡¦ç†ã®ç¢ºèª
- ãƒ­ã‚°å‡ºåŠ›ã§ä¸Šæ›¸ãå‡¦ç†ã®å®Ÿè¡ŒçŠ¶æ³ã‚’ç¢ºèª

### ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ç¢ºèª
```swift
// éŒ²éŸ³é–¢é€£ãƒ­ã‚°
print("ğŸ™ï¸ éŒ²éŸ³é–‹å§‹ - ã‚¹ãƒ­ãƒƒãƒˆ: \(currentSlot)")
print("ğŸ”„ ã‚¹ãƒ­ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆ: \(oldSlot) â†’ \(newSlot)")
print("ğŸ’¾ ã‚¹ãƒ­ãƒƒãƒˆéŒ²éŸ³å®Œäº†: \(fileName)")

// åŒä¸€ã‚¹ãƒ­ãƒƒãƒˆä¸Šæ›¸ããƒ­ã‚°
print("ğŸ”„ åŒä¸€ã‚¹ãƒ­ãƒƒãƒˆéŒ²éŸ³ã®è‡ªå‹•ä¸Šæ›¸ã: \(fileName)")
print("ğŸ“ æ—¢å­˜ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤: \(fileURL.path)")
print("âœ… ä¸Šæ›¸ãæº–å‚™å®Œäº† - æ–°éŒ²éŸ³ã‚’é–‹å§‹ã—ã¾ã™")

// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–¢é€£ãƒ­ã‚°
print("ğŸš€ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–‹å§‹: \(recording.fileName)")
print("âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ: \(recording.fileName)")
print("âŒ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—: \(error)")

// ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ãƒ­ã‚°
print("ğŸ“‹ èª­ã¿è¾¼ã¿å®Œäº†: \(recordings.count)å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«")
print("ğŸ—‘ï¸ ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤: \(recording.fileName)")
```

## ãƒ•ã‚¡ã‚¤ãƒ«ä¸Šæ›¸ãä»•æ§˜

### åŒä¸€ã‚¹ãƒ­ãƒƒãƒˆéŒ²éŸ³ã®å‡¦ç†
WatchMeã‚¢ãƒ—ãƒªã§ã¯ã€åŒã˜æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆï¼ˆä¾‹ï¼š13-00.wavï¼‰ã§éŒ²éŸ³ãŒé–‹å§‹ã•ã‚ŒãŸå ´åˆã€**è‡ªå‹•çš„ã«ä¸Šæ›¸ã**ã•ã‚Œã¾ã™ã€‚

#### ä¸Šæ›¸ãå‡¦ç†ã®æµã‚Œ
1. **æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«æ¤œå‡º**: åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«åã®éŒ²éŸ³ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œå‡º
2. **ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤**: æ—¢å­˜ã®WAVãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Œå…¨å‰Šé™¤
3. **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çŠ¶æ…‹ã‚’UserDefaultsã‹ã‚‰å‰Šé™¤
4. **ãƒªã‚¹ãƒˆæ›´æ–°**: éŒ²éŸ³ãƒªã‚¹ãƒˆã‹ã‚‰æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’é™¤å»
5. **æ–°éŒ²éŸ³é–‹å§‹**: ã‚¯ãƒªãƒ¼ãƒ³ãªçŠ¶æ…‹ã§æ–°ã—ã„éŒ²éŸ³ã‚’é–‹å§‹

#### å®Ÿè£…ã‚³ãƒ¼ãƒ‰
```swift
// AudioRecorder.swift: handleExistingRecording()
private func handleExistingRecording(fileName: String) {
    if let existingIndex = recordings.firstIndex(where: { $0.fileName == fileName }) {
        let existingRecording = recordings[existingIndex]
        print("ğŸ”„ åŒä¸€ã‚¹ãƒ­ãƒƒãƒˆéŒ²éŸ³ã®è‡ªå‹•ä¸Šæ›¸ã: \(fileName)")
        
        // æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®ç‰©ç†å‰Šé™¤
        let fileURL = existingRecording.getFileURL()
        if FileManager.default.fileExists(atPath: fileURL.path) {
            try? FileManager.default.removeItem(at: fileURL)
            print("ğŸ“ æ—¢å­˜ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤: \(fileURL.path)")
        }
        
        // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çŠ¶æ…‹ã‚¯ãƒªã‚¢ï¼ˆUserDefaultsã‹ã‚‰ã‚‚å‰Šé™¤ï¼‰
        clearUploadStatus(fileName: fileName)
        
        // ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤
        recordings.remove(at: existingIndex)
        pendingRecordings.removeAll { $0.fileName == fileName }
        
        print("âœ… ä¸Šæ›¸ãæº–å‚™å®Œäº† - æ–°éŒ²éŸ³ã‚’é–‹å§‹ã—ã¾ã™")
    }
}
```

#### å‡¦ç†ä¾‹ã¨ãƒ­ã‚°å‡ºåŠ›
```
ã‚·ãƒŠãƒªã‚ª: åŒä¸€ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ13-00.wavï¼‰ã§ã®éŒ²éŸ³é‡è¤‡

ãƒ­ã‚°å‡ºåŠ›ä¾‹:
ğŸ”„ åŒä¸€ã‚¹ãƒ­ãƒƒãƒˆéŒ²éŸ³ã®è‡ªå‹•ä¸Šæ›¸ã: 13-00.wav
   - æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ—¥æ™‚: 2025-06-23 13:00:00
   - æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 1.2 MB
   - æ—¢å­˜ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çŠ¶æ…‹: æ¸ˆã¿
ğŸ“ æ—¢å­˜ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤: /Documents/13-00.wav
âœ… ä¸Šæ›¸ãæº–å‚™å®Œäº† - æ–°éŒ²éŸ³ã‚’é–‹å§‹ã—ã¾ã™
ğŸ” æ–°è¦ã‚¹ãƒ­ãƒƒãƒˆéŒ²éŸ³é–‹å§‹:
   - ã‚¹ãƒ­ãƒƒãƒˆ: 13-00
   - ãƒ•ã‚¡ã‚¤ãƒ«å: 13-00.wav
   - ä¿å­˜ãƒ‘ã‚¹: /Documents/13-00.wav
```

#### é‡è¦ãªç‰¹å¾´
- **ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãªã—**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ç¢ºèªãªã—ã§è‡ªå‹•å®Ÿè¡Œ
- **å®Œå…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ»æ°¸ç¶šåŒ–çŠ¶æ…‹ã‚’ã™ã¹ã¦å‰Šé™¤
- **ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶**: ãƒ•ã‚¡ã‚¤ãƒ«åãŒæ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆã®é‡è¦ãªä½ç½®è¦ç´ ã®ãŸã‚ä¸Šæ›¸ããŒå¿…é ˆ
- **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: æ–°éŒ²éŸ³é–‹å§‹å‰ã«ã™ã¹ã¦ã®æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨å‰Šé™¤

#### ã‚µãƒ¼ãƒãƒ¼å´å‡¦ç†
- **ã‚¯ãƒ©ã‚¦ãƒ‰å´ã®é‡è¤‡å‡¦ç†**: EC2ã‚µãƒ¼ãƒãƒ¼ï¼ˆwatchme-vault-apiï¼‰ã®ä»•æ§˜ã«å®Œå…¨å§”ä»»
- **iOSå´ã®è²¬ä»»ç¯„å›²**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸Šæ›¸ãå‡¦ç†ã®ã¿
- **ã‚µãƒ¼ãƒãƒ¼å®Ÿè£…**: åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«åã§ã®ä¸Šæ›¸ããƒ»å±¥æ­´ç®¡ç†ã¯ã‚µãƒ¼ãƒãƒ¼å´ã§åˆ¶å¾¡

## Supabaseèªè¨¼ãƒ»ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²ä»•æ§˜

### èªè¨¼ãƒ•ãƒ­ãƒ¼
```
1. ã‚¢ãƒ—ãƒªèµ·å‹•
   â†“
2. ä¿å­˜ã•ã‚ŒãŸèªè¨¼çŠ¶æ…‹ç¢ºèªï¼ˆUserDefaultsï¼‰
   â†“ èªè¨¼æ¸ˆã¿
3. MainAppView â†’ ContentViewï¼ˆãƒ¡ã‚¤ãƒ³ç”»é¢ï¼‰
   â†“ æœªèªè¨¼
4. LoginViewï¼ˆãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ï¼‰
   â†“ ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
5. ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²å‡¦ç†
   â†“
6. ContentViewï¼ˆãƒ¡ã‚¤ãƒ³ç”»é¢ï¼‰
```

### ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ 
```sql
CREATE TABLE devices (
    device_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    platform_identifier TEXT NOT NULL,
    device_type TEXT,
    platform_type TEXT NOT NULL,
    owner_user_id UUID REFERENCES auth.users(id),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
    
    CONSTRAINT unique_platform_owner 
        UNIQUE (platform_identifier, owner_user_id)
);
```

### Supabaseè¨­å®šä¾‹
```swift
// SupabaseAuthManager.swift / DeviceManager.swift
private let supabaseURL = "https://your-project.supabase.co"
private let supabaseAnonKey = "your-anon-key"

private let supabase = SupabaseClient(
    supabaseURL: URL(string: supabaseURL)!,
    supabaseKey: supabaseAnonKey
)
```

### ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²UPSERTå®Ÿè£…
```swift
func registerDeviceToSupabase(platformIdentifier: String, ownerUserID: String?) {
    Task { @MainActor in
        do {
            let deviceData = DeviceInsert(
                platform_identifier: platformIdentifier,
                device_type: "ios",
                platform_type: "iOS",
                owner_user_id: ownerUserID
            )
            
            // UPSERT: æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Œã°æ›´æ–°ã€ãªã‘ã‚Œã°ä½œæˆ
            let response: [Device] = try await supabase
                .from("devices")
                .upsert(deviceData)
                .select()
                .execute()
                .value
                
            if let device = response.first {
                saveSupabaseDeviceRegistration(
                    deviceID: device.device_id,
                    platformIdentifier: platformIdentifier
                )
                print("âœ… ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã‚’å–å¾—/ç™»éŒ²å®Œäº†: \(device.device_id)")
            }
        } catch {
            print("âŒ ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼: \(error)")
        }
    }
}
```

### èªè¨¼çŠ¶æ…‹æ°¸ç¶šåŒ–
```swift
// UserDefaultsä¿å­˜ã‚­ãƒ¼
private let userKey = "supabase_user"
private let deviceIDKey = "watchme_device_id"
private let isRegisteredKey = "watchme_supabase_registered"

// èªè¨¼æƒ…å ±ä¿å­˜
func saveUserToDefaults(_ user: SupabaseUser) {
    let data = try JSONEncoder().encode(user)
    UserDefaults.standard.set(data, forKey: userKey)
}

// ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ä¿å­˜
func saveSupabaseDeviceRegistration(deviceID: String, platformIdentifier: String) {
    UserDefaults.standard.set(deviceID, forKey: deviceIDKey)
    UserDefaults.standard.set(true, forKey: "watchme_supabase_registered")
}
```

## æ‹¡å¼µå¯èƒ½æ€§

### è¿½åŠ æ©Ÿèƒ½å€™è£œ
1. **éŸ³å£°å“è³ªè¨­å®š**: ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆãƒ»ãƒ“ãƒƒãƒˆæ·±åº¦ã®å¤‰æ›´
2. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½**: è¤‡æ•°ã‚µãƒ¼ãƒãƒ¼ã¸ã®åŒæ™‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
3. **éŸ³å£°å†ç”Ÿæ©Ÿèƒ½**: ã‚¢ãƒ—ãƒªå†…ã§ã®éŒ²éŸ³å†ç”Ÿ
4. **éŸ³å£°è§£æ**: éŸ³é‡ãƒ¬ãƒ™ãƒ«ãƒ»ç„¡éŸ³æ¤œå‡º
5. **ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ**: è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹é–“ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«åŒæœŸ

### APIæ‹¡å¼µ
```swift
// éŸ³å£°ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿é€ä¿¡
struct AudioMetadata: Codable {
    let duration: TimeInterval
    let averageVolume: Double
    let peakVolume: Double
    let silencePercentage: Double
}
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### ãƒ‡ãƒ¼ã‚¿ä¿è­·
- **é€šä¿¡æš—å·åŒ–**: HTTPSé€šä¿¡ã§ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–
- **ãƒ­ãƒ¼ã‚«ãƒ«æš—å·åŒ–**: æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®Keychainä¿å­˜æ¤œè¨
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼IDç®¡ç†**: UUIDä½¿ç”¨ã«ã‚ˆã‚‹åŒ¿ååŒ–

### ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼
- **ãƒã‚¤ã‚¯è¨±å¯**: æ˜ç¤ºçš„ãªè¨±å¯å–å¾—
- **ãƒ‡ãƒ¼ã‚¿æœ€å°åŒ–**: å¿…è¦æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿åé›†
- **å‰Šé™¤æ©Ÿèƒ½**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å‰Šé™¤æ¨©é™

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å] ã®ä¸‹ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã•ã‚Œã¦ã„ã¾ã™ã€‚

## é–‹ç™ºè€…æƒ…å ±

- **ä½œæˆè€…**: Kaya Matsumoto
- **ä½œæˆæ—¥**: 2025å¹´6æœˆ11æ—¥
- **æœ€çµ‚æ›´æ–°**: 2025å¹´7æœˆ5æ—¥
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v9.1 - Supabaseèªè¨¼ãƒ»ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²æ©Ÿèƒ½è¿½åŠ 

---

ã“ã®READMEã¯ã€WatchMe ã‚¢ãƒ—ãƒªã®å®Œå…¨ãªæŠ€è¡“ä»•æ§˜æ›¸ã¨ã—ã¦ã€åŒç­‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã«å¿…è¦ãªã™ã¹ã¦ã®æƒ…å ±ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚