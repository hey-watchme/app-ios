# iOS WatchMe v9

WatchMeãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®iOSã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³9ï¼‰ã€‚
éŸ³å£°éŒ²éŸ³ã¨AIåˆ†æã«ã‚ˆã‚‹å¿ƒç†ãƒ»æ„Ÿæƒ…ãƒ»è¡Œå‹•ã®ç·åˆçš„ãªãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚’æä¾›ã—ã¾ã™ã€‚

## âœ… ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ï¼ˆ2025-09-16 å®Œæˆï¼‰

è¦³æ¸¬å¯¾è±¡ã«å¯¾ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ãƒ»é–²è¦§ãƒ»å‰Šé™¤ã§ãã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

### å®Ÿè£…å†…å®¹

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ**
   - `subject_comments`ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆä½œæˆæ¸ˆã¿ï¼‰
   - RLSãƒãƒªã‚·ãƒ¼è¨­å®šæ¸ˆã¿

2. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…**
   - RPCé–¢æ•°`get_dashboard_data`ã«ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—å‡¦ç†ã‚’è¿½åŠ 
   - `public.users`ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ã‚¢ãƒã‚¿ãƒ¼ã‚’å–å¾—
   - æœ€æ–°50ä»¶ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ–°ã—ã„é †ã«è¡¨ç¤º

3. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…**
   - `SubjectComment.swift` - ã‚³ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«ï¼ˆnameã€avatarå¯¾å¿œï¼‰
   - `SupabaseDataManager.swift` - CRUD ãƒ¡ã‚½ãƒƒãƒ‰
     - `addComment()` - ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
     - `deleteComment()` - ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤  
     - `fetchComments()` - ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—
   - `SimpleDashboardView.swift` - UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
     - ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§è¡¨ç¤ºï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ã‚¢ãƒã‚¿ãƒ¼ä»˜ãï¼‰
     - ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
     - å‰Šé™¤æ©Ÿèƒ½ï¼ˆè‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ï¼‰

### ä¸»ãªç‰¹å¾´
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®è¡¨ç¤ºï¼ˆ`public.users.name`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒã‚¿ãƒ¼ã®è¡¨ç¤ºï¼ˆ`AvatarView`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½¿ç”¨ï¼‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚³ãƒ¡ãƒ³ãƒˆã®è¿½åŠ ãƒ»å‰Šé™¤ãŒåæ˜ 
- è‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿å‰Šé™¤å¯èƒ½ï¼ˆRLSãƒãƒªã‚·ãƒ¼ã§åˆ¶å¾¡ï¼‰

## ğŸŒŸ ä¸»ãªæ©Ÿèƒ½

### éŒ²éŸ³ãƒ»ãƒ‡ãƒ¼ã‚¿åé›†
- **30åˆ†é–“éš”ã®è‡ªå‹•éŒ²éŸ³**: ãƒ©ã‚¤ãƒ•ãƒ­ã‚°ã¨ã—ã¦30åˆ†ã”ã¨ã«éŸ³å£°ã‚’è‡ªå‹•éŒ²éŸ³
- **é«˜å“è³ªéŒ²éŸ³è¨­å®š**: 16kHz/16bit/ãƒ¢ãƒãƒ©ãƒ«ã§éŸ³å£°èªè­˜ã«æœ€é©åŒ–ï¼ˆv9.24.0ã€œï¼‰
  - `AVAudioQuality.high`ã«ã‚ˆã‚‹é«˜å“è³ªéŒ²éŸ³ã§ãƒã‚¤ã‚¯ã‚²ã‚¤ãƒ³ã‚’æœ€é©åŒ–
  - `spokenAudio`ãƒ¢ãƒ¼ãƒ‰ã§éŸ³å£°ä¼šè©±ã«ç‰¹åŒ–ã—ãŸéŒ²éŸ³è¨­å®š
  - ãƒã‚¤ã‚¯ã‚²ã‚¤ãƒ³1.0ï¼ˆæœ€å¤§ï¼‰ã§ä½éŸ³é‡å•é¡Œã‚’è§£æ±º
  - **é‡è¦**: å¾“æ¥ã®`measurement`ãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰`spokenAudio`ã«å¤‰æ›´ï¼ˆv9.24.1ã€œï¼‰
- **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚å®‰å®šã—ãŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†**: ã‚¢ãƒ—ãƒªã‚’é–‰ã˜ã¦ã‚‚éŒ²éŸ³ãƒ»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒç¶™ç¶š

### åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: æ—¥ä»˜ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¨ªã‚¹ãƒ¯ã‚¤ãƒ—ã§åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ï¼ˆv9.19.0ã€œï¼‰
  - **ã‚¹ãƒ¯ã‚¤ãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: TabViewã«ã‚ˆã‚‹æ»‘ã‚‰ã‹ãªæ—¥ä»˜åˆ‡ã‚Šæ›¿ãˆ
  - **éå»1å¹´åˆ†ã®ãƒ‡ãƒ¼ã‚¿**: 1å¹´å‰ã‹ã‚‰ä»Šæ—¥ã¾ã§ã®æ—¥ä»˜ç¯„å›²ã‚’è¡¨ç¤º
  - **ãƒ¢ãƒ¼ãƒ€ãƒ«è©³ç´°è¡¨ç¤º**: å„ã‚°ãƒ©ãƒ•ã‚«ãƒ¼ãƒ‰ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨è©³ç´°ç”»é¢ãŒãƒ¢ãƒ¼ãƒ€ãƒ«ã‚·ãƒ¼ãƒˆã§è¡¨ç¤º
  - **æ—¥ä»˜è¡¨ç¤ºã®æ”¹å–„**ï¼ˆv9.23.0ã€œï¼‰:
    - æœ¬æ—¥ã¯ã€Œä»Šæ—¥ã€ã¨å¤§ããè¡¨ç¤ºã—ã€å®Ÿéš›ã®æ—¥ä»˜ã‚’å°ã•ãä½µè¨˜
    - éå»ã®æ—¥ä»˜ã¯å¹´ãƒ»æœˆæ—¥ãƒ»æ›œæ—¥ã‚’éšå±¤çš„ã«è¡¨ç¤º
    - æ—¥ä»˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®èƒŒæ™¯ã‚’ç´«è‰²ï¼ˆAppAccentColorï¼‰ã«çµ±ä¸€
  - **ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼**ï¼ˆv9.23.0ã€œï¼‰: æ°—åˆ†ã®çµµæ–‡å­—ä»˜ãã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º
    - æœˆé–“ã®æ°—åˆ†ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€è¦§è¡¨ç¤º
    - å„æ—¥ä»˜ã«æ°—åˆ†ã‚¹ã‚³ã‚¢ã«å¿œã˜ãŸçµµæ–‡å­—ï¼ˆğŸ‘âœŒï¸ğŸ‘ğŸ‘ŒğŸ’ªğŸ’”ï¼‰ã‚’è¡¨ç¤º
    - ãƒ‡ãƒ¼ã‚¿ãŒãªã„æ—¥ã¯çµµæ–‡å­—ãªã—ã§æ—¥ä»˜ã®ã¿è¡¨ç¤º
- **å¿ƒç†ã‚°ãƒ©ãƒ• (Vibe Graph)**: æ™‚é–“ã”ã¨ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¹ãƒˆè¡¨ç¤ºï¼ˆv9.25.0ã€œï¼‰
  - **æ™‚é–“è©³ç´°ãƒªã‚¹ãƒˆ**: dashboardãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰48ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ30åˆ†é–“éš”ï¼‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
  - **ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªè¡¨ç¤º**: æ™‚é–“ã€ã‚¹ã‚³ã‚¢ã€ã‚µãƒãƒªãƒ¼1è¡Œç›®ã‚’1è¡Œã«è¡¨ç¤º
  - **å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿**: ã‚¿ãƒƒãƒ—ã§è©³ç´°ã‚µãƒãƒªãƒ¼ã‚’å±•é–‹è¡¨ç¤º
  - **ã‚¹ã‚³ã‚¢ã«ã‚ˆã‚‹è‰²åˆ†ã‘**: ãƒã‚¸ãƒ†ã‚£ãƒ–ï¼ˆç·‘ï¼‰ã€ãƒã‚¬ãƒ†ã‚£ãƒ–ï¼ˆèµ¤ï¼‰ã€ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«ï¼ˆã‚°ãƒ¬ãƒ¼ï¼‰
- **è¡Œå‹•ã‚°ãƒ©ãƒ• (Behavior Graph)**: 1æ—¥ã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¨æ™‚é–“å¸¯åˆ¥ã§å¯è¦–åŒ–ï¼ˆv9.10.0ã€œï¼‰
- **æ„Ÿæƒ…ã‚°ãƒ©ãƒ• (Emotion Graph)**: 8ã¤ã®æ„Ÿæƒ…ï¼ˆJoyã€Fearã€Angerã€Trustã€Disgustã€Sadnessã€Surpriseã€Anticipationï¼‰ã®æ™‚ç³»åˆ—å¤‰åŒ–ã‚’æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã§è¡¨ç¤ºï¼ˆv9.10.0ã€œï¼‰

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†
- **Supabaseèªè¨¼**: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹å®‰å…¨ãªèªè¨¼
- **ä¼šå“¡ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³**:
  - ã‚¢ãƒ—ãƒªå†…ã§æ–°è¦ä¼šå“¡ç™»éŒ²ãŒå¯èƒ½ï¼ˆSignUpViewï¼‰
  - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹èªè¨¼ãƒ•ãƒ­ãƒ¼å®Ÿè£…æ¸ˆã¿
  - ç™»éŒ²æ™‚ã«`auth.users`ã¨`public.users`ã®ä¸¡æ–¹ã«ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
  - èªè¨¼ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¾Œã«æ¡ˆå†…ç”»é¢ã‚’è¡¨ç¤º
- **ãƒ¡ãƒ¼ãƒ«é…ä¿¡**: Amazon SESï¼ˆSMTPï¼‰ã«ã‚ˆã‚‹èªè¨¼ãƒ¡ãƒ¼ãƒ«é€ä¿¡
  - ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆhey-watch.meï¼‰ã‹ã‚‰ã®é€ä¿¡
  - DKIM/SPF/DMARCè¨­å®šã«ã‚ˆã‚‹åˆ°é”ç‡å‘ä¸Š
  - MAIL FROMãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šã§DMARCæº–æ‹ 
- **ãƒãƒ«ãƒãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ**: 1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’ç®¡ç†å¯èƒ½
- **ãƒ‡ãƒã‚¤ã‚¹é¸æŠæ–¹å¼**: ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ã¨ã®ç´ä»˜ã‘ãªã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‡ãƒã‚¤ã‚¹ã‚’é¸æŠã™ã‚‹ã ã‘ï¼ˆv9.29.0ã€œï¼‰
  - ã©ã®iPhoneã‹ã‚‰ã§ã‚‚ã€å¥½ããªãƒ‡ãƒã‚¤ã‚¹IDã‚’é¸æŠã—ã¦ä½¿ç”¨å¯èƒ½
  - ãƒãƒ³ãƒ‰ãƒ«IDå¤‰æ›´ã‚„ã‚¢ãƒ—ãƒªå†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å½±éŸ¿ã‚’å—ã‘ãªã„
- **QRã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ **: QRã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³ã§ç°¡å˜ã«ãƒ‡ãƒã‚¤ã‚¹ã‚’è¿½åŠ ï¼ˆv9.15.0ã€œï¼‰
  - ãƒ‡ãƒã‚¤ã‚¹é¸æŠç”»é¢ã‹ã‚‰ã‚«ãƒ¡ãƒ©ã§QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³
  - **ç¾åœ¨**: QRã‚³ãƒ¼ãƒ‰å†…å®¹ã¯device_idã®ã¿ï¼ˆUUIDå½¢å¼ï¼‰
  - **ä»Šå¾Œã®äºˆå®š**: QRã‚³ãƒ¼ãƒ‰ã«ãƒ‡ãƒã‚¤ã‚¹IDã¨ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ã®ä¸¡æ–¹ã‚’å«ã‚ã‚‹
    - ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ æ™‚ã«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ã‚‚æ­£ç¢ºã«åŒæœŸ
    - QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆå´ã§ã®å¯¾å¿œã‚‚å¿…è¦
  - ãƒ‡ãƒã‚¤ã‚¹IDã®å¦¥å½“æ€§æ¤œè¨¼ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å­˜åœ¨ç¢ºèª
  - æˆåŠŸãƒ»å¤±æ•—æ™‚ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨©é™ã¯ã€Œownerã€ã§è¿½åŠ 
- **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¯¾å¿œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§ã®è¨˜éŒ²ç®¡ç†
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†**: 
  - ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼é…ä¿¡è¨­å®šï¼ˆON/OFFï¼‰ã®ç®¡ç†
  - ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆAvatar Uploader APIçµŒç”±ã§S3ã«ä¿å­˜ï¼‰
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆãƒã‚¤ãƒšãƒ¼ã‚¸ï¼‰ã‹ã‚‰ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šã‚’å¤‰æ›´å¯èƒ½

### ã‚¢ãƒã‚¿ãƒ¼æ©Ÿèƒ½ï¼ˆv9.20.0ã€œï¼‰
- **ã‚»ã‚­ãƒ¥ã‚¢ãªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: Avatar Uploader APIï¼ˆhttp://3.24.16.82:8014ï¼‰çµŒç”±
  - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«AWSèªè¨¼æƒ…å ±ã‚’æŒãŸãªã„å®‰å…¨ãªå®Ÿè£…
  - Supabaseèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹æ¨©é™ç®¡ç†
- **å¯¾å¿œã‚¢ãƒã‚¿ãƒ¼ã‚¿ã‚¤ãƒ—**:
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒã‚¿ãƒ¼ï¼ˆãƒã‚¤ãƒšãƒ¼ã‚¸ï¼‰
  - è¦³æ¸¬å¯¾è±¡ã‚¢ãƒã‚¿ãƒ¼ï¼ˆSubjectï¼‰
- **ç”»åƒå‡¦ç†æ©Ÿèƒ½**:
  - ã‚«ãƒ¡ãƒ©æ’®å½±ã¾ãŸã¯ãƒ•ã‚©ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰é¸æŠ
  - å††å½¢ãƒ»æ­£æ–¹å½¢ã«ãƒˆãƒªãƒŸãƒ³ã‚°ï¼ˆMantisãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨ v9.21.0ã€œï¼‰
  - è‡ªå‹•ãƒªã‚µã‚¤ã‚ºï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã§512x512pxã«æœ€é©åŒ–ï¼‰
- **S3ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**:
  - ãƒã‚±ãƒƒãƒˆ: `watchme-avatars`ï¼ˆap-southeast-2ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
  - ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹è¨­å®šæ¸ˆã¿ï¼ˆç”»åƒã®è¡¨ç¤ºç”¨ï¼‰

### UI/UXæ”¹å–„ï¼ˆv9.25.0ã€œï¼‰
- **ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®æ¨™æº–åŒ–**: å…¥åŠ›æ¬„ã¨ãƒœã‚¿ãƒ³ã®é«˜ã•ã‚’44ptã«çµ±ä¸€ï¼ˆiOS Human Interface Guidelinesæº–æ‹ ï¼‰
- **ã‚¢ãƒ—ãƒªã‚«ãƒ©ãƒ¼ã®çµ±ä¸€**: ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã«AppAccentColorï¼ˆç´«è‰²ï¼‰ã‚’é©ç”¨
- **ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰åˆ¶å¾¡ã®æœ€é©åŒ–**: 
  - ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã«è‡ªå‹•çš„ã«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’é–‰ã˜ã‚‹
  - ãƒ•ã‚©ãƒ¼ãƒ ä»¥å¤–ã®éƒ¨åˆ†ã‚’ã‚¿ãƒƒãƒ—ã§ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’é–‰ã˜ã‚‹
  - ç”»é¢é·ç§»æ™‚ã«è‡ªå‹•çš„ã«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’é–‰ã˜ã‚‹

### é€šçŸ¥æ©Ÿèƒ½ï¼ˆv9.22.0ã€œï¼‰
- **3ç¨®é¡ã®é€šçŸ¥ã‚¿ã‚¤ãƒ—**:
  - **ã‚°ãƒ­ãƒ¼ãƒãƒ«é€šçŸ¥**: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼ˆuser_id = NULL, type = 'global'ï¼‰
    - ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€æ–°æ©Ÿèƒ½ãƒªãƒªãƒ¼ã‚¹ã€é‡è¦ãªãŠçŸ¥ã‚‰ã›ãªã©
    - æ—¢èª­ç®¡ç†ã¯`notification_reads`ãƒ†ãƒ¼ãƒ–ãƒ«ã§å€‹åˆ¥ç®¡ç†
  - **ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«é€šçŸ¥**: ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼ˆuser_id = å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼, type = 'personal'ï¼‰
    - ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã®é€šçŸ¥ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé–¢é€£ã®é€šçŸ¥ãªã©
    - æ—¢èª­ç®¡ç†ã¯`notifications.is_read`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ç®¡ç†
  - **ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥**: ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ï¼ˆuser_id = å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼, type = 'event'ï¼‰
    - åˆ†æå®Œäº†ã€ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã€ãƒ‡ãƒã‚¤ã‚¹æ¥ç¶šãªã©ã®ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ
    - æ—¢èª­ç®¡ç†ã¯`notifications.is_read`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ç®¡ç†
- **çµ±ä¸€ã•ã‚ŒãŸé€šçŸ¥ç”»é¢**:
  - 3ç¨®é¡ã®é€šçŸ¥ã‚’1ã¤ã®ç”»é¢ã§è¡¨ç¤º
  - æ™‚ç³»åˆ—é †ï¼ˆæ–°ã—ã„é †ï¼‰ã§çµ±åˆè¡¨ç¤º
  - é€šçŸ¥ã‚¿ã‚¤ãƒ—ã”ã¨ã«ç•°ãªã‚‹ã‚¢ã‚¤ã‚³ãƒ³ã¨è‰²ã§è¦–è¦šçš„ã«åŒºåˆ¥
- **æ—¢èª­ç®¡ç†**:
  - å€‹åˆ¥æ—¢èª­: ã‚¿ãƒƒãƒ—ã§æ—¢èª­åŒ–
  - ä¸€æ‹¬æ—¢èª­: ã€Œã™ã¹ã¦æ—¢èª­ã€ãƒœã‚¿ãƒ³ã§å…¨é€šçŸ¥ã‚’æ—¢èª­åŒ–
  - ã‚°ãƒ­ãƒ¼ãƒãƒ«é€šçŸ¥ã¯`notification_reads`ãƒ†ãƒ¼ãƒ–ãƒ«ã§æ—¢èª­çŠ¶æ…‹ã‚’è¨˜éŒ²
- **æœªèª­ãƒãƒƒã‚¸è¡¨ç¤º**:
  - ãƒ˜ãƒƒãƒ€ãƒ¼ã®é€šçŸ¥ã‚¢ã‚¤ã‚³ãƒ³ã«æœªèª­æ•°ã‚’è¡¨ç¤ºï¼ˆæœ€å¤§99ï¼‰
  - ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã¨ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å¾©å¸°æ™‚ã«è‡ªå‹•æ›´æ–°
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°å¯¾å¿œ**:
  - Supabase Realtimeã¨ã®é€£æºæº–å‚™æ¸ˆã¿ï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰

## é‡è¦ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨ãƒ‡ãƒã‚¤ã‚¹IDã®é–¢ä¿‚

ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ‡ãƒã‚¤ã‚¹ãŒä»¥ä¸‹ã®æ§‹é€ ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ï¼š

### èªè¨¼ã¨IDç®¡ç†ã®æµã‚Œ

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ï¼ˆSupabaseAuthManagerï¼‰**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³
   - èªè¨¼æˆåŠŸæ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆUUIDå½¢å¼ï¼‰ãŒå–å¾—ã•ã‚Œã‚‹
   - ä¾‹ï¼š`user_id: "123e4567-e89b-12d3-a456-426614174000"`

2. **ãƒ‡ãƒã‚¤ã‚¹é¸æŠï¼ˆDeviceManagerï¼‰**ï¼ˆv9.29.0ã§å¤§å¹…å¤‰æ›´ï¼‰
   - **ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ã¨ã®ç´ä»˜ã‘ãªã—**ï¼šãƒ‡ãƒã‚¤ã‚¹IDã¯ã€Œãƒ‡ãƒ¼ã‚¿ã®å…¥ã‚Œç‰©ã€ã¨ã—ã¦æ©Ÿèƒ½
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‡ãƒã‚¤ã‚¹è¨­å®šç”»é¢ã§é–²è¦§ãƒ»éŒ²éŸ³ã—ãŸã„ãƒ‡ãƒã‚¤ã‚¹ã‚’é¸æŠ
   - ã©ã®iPhoneã‹ã‚‰ã§ã‚‚ã€åŒã˜ãƒ‡ãƒã‚¤ã‚¹IDã‚’é¸æŠã™ã‚Œã°åŒã˜ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - **ç–çµåˆè¨­è¨ˆ**ï¼šãƒãƒ³ãƒ‰ãƒ«IDå¤‰æ›´ã€ã‚¢ãƒ—ãƒªå†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å½±éŸ¿ã‚’å—ã‘ãªã„

3. **ãƒ‡ãƒã‚¤ã‚¹IDã®ç®¡ç†**
   - `devices`ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒã‚¤ã‚¹IDï¼ˆUUIDå½¢å¼ï¼‰
   - `user_devices`ãƒ†ãƒ¼ãƒ–ãƒ«ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ‡ãƒã‚¤ã‚¹ã®é–¢ä¿‚ã‚’ç®¡ç†
   - ä¾‹ï¼š`device_id: "d067d407-cf73-4174-a9c1-d91fb60d64d0"`

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ï¼ˆv9.14.0ã§æ›´æ–°ï¼‰

```sql
-- devicesãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE devices (
    device_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    device_type TEXT NOT NULL,
    timezone TEXT NOT NULL,  -- v9.17.0ã§è¿½åŠ ï¼ˆIANAã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è­˜åˆ¥å­ï¼‰
    owner_user_id UUID REFERENCES auth.users(id),  -- å»ƒæ­¢äºˆå®š
    subject_id UUID REFERENCES subjects(subject_id),  -- v9.14.0ã§è¿½åŠ 
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- user_devicesãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦è¿½åŠ ï¼‰
CREATE TABLE user_devices (
    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
    device_id UUID NOT NULL REFERENCES devices(device_id) ON DELETE CASCADE,
    role TEXT NOT NULL DEFAULT 'viewer' CHECK (role IN ('owner', 'viewer')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    PRIMARY KEY (user_id, device_id)
);

-- subjectsãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆv9.14.0ã§è¿½åŠ ï¼‰
CREATE TABLE subjects (
    subject_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    age INTEGER,
    gender TEXT,
    avatar_url TEXT,
    notes TEXT,
    created_by_user_id UUID REFERENCES public.users(user_id) ON DELETE SET NULL,  -- public.usersã‚’å‚ç…§
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- subject_commentsãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆè¦³æ¸¬å¯¾è±¡ã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆï¼‰
CREATE TABLE subject_comments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    subject_id UUID NOT NULL REFERENCES subjects(subject_id) ON DELETE CASCADE,
    user_id UUID NOT NULL REFERENCES public.users(user_id) ON DELETE CASCADE,  -- public.usersã‚’å‚ç…§
    comment_text TEXT NOT NULL,
    date DATE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- dashboard_summaryãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆçµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼‰
CREATE TABLE dashboard_summary (
    device_id UUID NOT NULL,  -- devicesãƒ†ãƒ¼ãƒ–ãƒ«ã®device_idã‚’å‚ç…§
    date DATE NOT NULL,
    average_vibe REAL,                    -- 1æ—¥ã®å¹³å‡æ°—åˆ†ã‚¹ã‚³ã‚¢
    vibe_scores JSONB,                    -- 48å€‹ã®æ™‚ç³»åˆ—ã‚¹ã‚³ã‚¢é…åˆ—ï¼ˆ30åˆ†ã”ã¨ã€nullã¯0ã¨ã—ã¦æ‰±ã†ï¼‰
    burst_events JSONB,                   -- ãƒãƒ¼ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆé…åˆ—ï¼ˆæ„Ÿæƒ…ã®æ€¥å¤‰ç‚¹ï¼‰
    insights TEXT,                        -- 1æ—¥ã®ã‚µãƒãƒªãƒ¼ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
    analysis_result JSONB,                -- è©³ç´°ãªåˆ†æçµæœ
    processed_count INTEGER,              -- å‡¦ç†æ¸ˆã¿ãƒ–ãƒ­ãƒƒã‚¯æ•°
    last_time_block TEXT,                 -- æœ€å¾Œã«å‡¦ç†ã—ãŸæ™‚é–“ãƒ–ãƒ­ãƒƒã‚¯
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    PRIMARY KEY (device_id, date)
);

-- vibe_whisper_summaryãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå»ƒæ­¢æ¸ˆã¿ï¼‰
-- æ°—åˆ†ãƒ‡ãƒ¼ã‚¿ã¯ã™ã¹ã¦dashboard_summaryãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—ã—ã¦ãã ã•ã„

-- notificationsãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆv9.22.0ã§è¿½åŠ ï¼‰
CREATE TABLE notifications (
    id UUID NOT NULL DEFAULT gen_random_uuid(),
    user_id UUID NULL REFERENCES public.users(user_id) ON DELETE CASCADE,  -- NULLã®å ´åˆã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«é€šçŸ¥ã€public.usersã‚’å‚ç…§
    type TEXT NOT NULL,  -- 'global', 'personal', 'event'
    title TEXT NOT NULL,
    message TEXT NOT NULL,
    is_read BOOLEAN NULL DEFAULT false,  -- ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«/ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ã®æ—¢èª­ãƒ•ãƒ©ã‚°
    created_at TIMESTAMP WITH TIME ZONE NULL DEFAULT NOW(),
    triggered_by TEXT NULL,  -- ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒˆãƒªã‚¬ãƒ¼å…ƒ
    metadata JSONB NULL,  -- è¿½åŠ æƒ…å ±
    CONSTRAINT notifications_pkey PRIMARY KEY (id)
);

-- notification_readsãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«é€šçŸ¥ã®æ—¢èª­ç®¡ç†ï¼‰ï¼ˆv9.22.0ã§è¿½åŠ ï¼‰
CREATE TABLE notification_reads (
    user_id UUID NOT NULL REFERENCES public.users(user_id) ON DELETE CASCADE,  -- public.usersã‚’å‚ç…§
    notification_id UUID NOT NULL REFERENCES notifications(id) ON DELETE CASCADE,
    read_at TIMESTAMP WITHOUT TIME ZONE NULL DEFAULT NOW(),
    CONSTRAINT notification_reads_pkey PRIMARY KEY (user_id, notification_id)
);
```

## ğŸ“§ ä¼šå“¡ç™»éŒ²ãƒ•ãƒ­ãƒ¼ï¼ˆv9.31.0ã€œï¼šãƒ¡ãƒ¼ãƒ«ç¢ºèªä¸è¦ï¼‰

### æ–°è¦ä¼šå“¡ç™»éŒ²ãƒ—ãƒ­ã‚»ã‚¹

**âš ï¸ é‡è¦ãªå¤‰æ›´ï¼ˆ2025-10-04ï¼‰**:
- **ãƒ¡ãƒ¼ãƒ«ç¢ºèªã‚’ç„¡åŠ¹åŒ–**ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æœ€å„ªå…ˆã—ã€ç™»éŒ²å¾Œã™ãã«åˆ©ç”¨å¯èƒ½
- **è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³**ï¼šä¼šå“¡ç™»éŒ²å®Œäº†ã¨åŒæ™‚ã«è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³
- **ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªä½“é¨“**ï¼šã€Œç™»éŒ²â†’å³åˆ©ç”¨é–‹å§‹ã€ã‚’å®Ÿç¾

#### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ï¼ˆSignUpViewï¼‰
```swift
// UserAccountManager.signUp()ãƒ¡ã‚½ãƒƒãƒ‰ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼
1. å…¥åŠ›æ¤œè¨¼
   - è¡¨ç¤ºåï¼ˆ2æ–‡å­—ä»¥ä¸Šï¼‰
   - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆå½¢å¼ãƒã‚§ãƒƒã‚¯ï¼‰
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ8æ–‡å­—ä»¥ä¸Šï¼‰
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèªï¼ˆä¸€è‡´ãƒã‚§ãƒƒã‚¯ï¼‰
   - åˆ©ç”¨è¦ç´„åŒæ„ï¼ˆå¿…é ˆï¼‰
   - ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼è³¼èª­ï¼ˆä»»æ„ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆONï¼‰

2. auth.usersãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
   await supabase.auth.signUp(
       email: email,
       password: password,
       data: ["display_name": displayName, "newsletter_subscription": newsletter]
   )

3. public.usersãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
   - user_idï¼ˆauth.users.idã®ã‚³ãƒ”ãƒ¼ï¼‰
   - nameï¼ˆè¡¨ç¤ºåï¼‰
   - emailï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰
   - newsletter_subscriptionï¼ˆãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼è¨­å®šï¼‰
   - created_atï¼ˆç™»éŒ²æ—¥æ™‚ï¼‰

4. è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³å®Ÿè¡Œï¼ˆv9.31.0ã€œï¼‰
   - ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æˆåŠŸå¾Œã€ãƒ¡ãƒ¼ãƒ«ç¢ºèªçŠ¶æ…‹ã«é–¢ä¿‚ãªãè‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³
   - await performSignIn(email, password)
   - ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ â†’ isAuthenticated = true
   - SignUpView/LoginViewã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¦ãƒ¡ã‚¤ãƒ³ç”»é¢ã¸é·ç§»
```

#### 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãƒ•ãƒ­ãƒ¼

**å¾“æ¥ï¼ˆãƒ¡ãƒ¼ãƒ«ç¢ºèªã‚ã‚Šï¼‰**:
1. ä¼šå“¡ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
2. ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
3. ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ¡ˆå†…ç”»é¢ãŒè¡¨ç¤º
4. ãƒ¡ãƒ¼ãƒ«ã‚’é–‹ã„ã¦èªè¨¼ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ âŒ **ã‚¢ãƒ—ãƒªã®å¤–ã«å‡ºã‚‹**
5. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹
6. å†åº¦ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ› âŒ **æ‰‹é–“ãŒã‹ã‹ã‚‹**

**ç¾åœ¨ï¼ˆv9.31.0ã€œï¼‰**:
1. ä¼šå“¡ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
2. ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
3. **å³åº§ã«ãƒ¡ã‚¤ãƒ³ç”»é¢ã«é·ç§»** âœ… **ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ï¼**

### Supabaseèªè¨¼è¨­å®š

#### ãƒ¡ãƒ¼ãƒ«ç¢ºèªã®ç„¡åŠ¹åŒ–ï¼ˆv9.31.0ã€œï¼‰
**Supabase Dashboard** â†’ **Authentication** â†’ **Providers** â†’ **Email**
- **ã€ŒConfirm emailã€**: OFFï¼ˆç„¡åŠ¹ï¼‰
- ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç™»éŒ²å¾Œã™ãã«ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½

#### ç†ç”±ã¨åˆ©ç‚¹
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®æœ€å¤§åŒ–**: ç™»éŒ²ã‹ã‚‰åˆ©ç”¨é–‹å§‹ã¾ã§ã®æ™‚é–“ã‚’æœ€å°åŒ–
- **é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆã®åŠ¹ç‡åŒ–**: ãƒ¡ãƒ¼ãƒ«ç¢ºèªã®æ‰‹é–“ãªããƒ†ã‚¹ãƒˆå¯èƒ½
- **ã‚¹ãƒ‘ãƒ ãƒªã‚¹ã‚¯**: å€‹äººåˆ©ç”¨ä¸­å¿ƒã®ãŸã‚ã€ã‚¹ãƒ‘ãƒ ç™»éŒ²ã®ãƒªã‚¹ã‚¯ã¯ä½ã„
- **å¾Œã‹ã‚‰å¤‰æ›´å¯èƒ½**: å¿…è¦ã«ãªã‚Œã°æœ¬ç•ªç’°å¢ƒã§æœ‰åŠ¹åŒ–ã§ãã‚‹

### Amazon SESè¨­å®šï¼ˆå°†æ¥ã®ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ç”¨ï¼‰

**æ³¨æ„**: ç¾åœ¨ã¯ãƒ¡ãƒ¼ãƒ«ç¢ºèªã‚’ç„¡åŠ¹åŒ–ã—ã¦ã„ã‚‹ãŸã‚ã€èªè¨¼ãƒ¡ãƒ¼ãƒ«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚
ä»¥ä¸‹ã®è¨­å®šã¯ã€å°†æ¥çš„ã«ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼ã‚„é€šçŸ¥ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹éš›ã«ä½¿ç”¨ã—ã¾ã™ã€‚

#### SMTPè¨­å®šï¼ˆSupabaseå´ï¼‰
```
Enable Custom SMTP: ONï¼ˆå¿…é ˆï¼‰

Sender email: noreply@hey-watch.me
Sender name: WatchMe

Host: email-smtp.ap-southeast-2.amazonaws.com
Port: 587
Username: SMTPèªè¨¼æƒ…å ±ï¼ˆAWS SESã§ä½œæˆï¼‰
Password: SMTPèªè¨¼æƒ…å ±ï¼ˆAWS SESã§ä½œæˆï¼‰
Minimum interval: 60ç§’
```

**âš ï¸ é‡è¦**: ãƒ›ã‚¹ãƒˆåã¯ `.amazonaws.com` ã§ã™ï¼ˆ`.amazonses.com` ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰

#### AWS SES Sandboxãƒ¢ãƒ¼ãƒ‰ã«ã¤ã„ã¦
- **ç¾åœ¨**: Sandboxãƒ¢ãƒ¼ãƒ‰ï¼ˆæ¤œè¨¼æ¸ˆã¿ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿é€ä¿¡å¯èƒ½ï¼‰
- **æœ¬ç•ªç§»è¡Œæ™‚**: Production accessç”³è«‹ãŒå¿…è¦ï¼ˆé€šå¸¸24æ™‚é–“ä»¥å†…ã«æ‰¿èªï¼‰
- **ç”³è«‹æ–¹æ³•**: AWS SES â†’ Account dashboard â†’ Request production access

#### DNSè¨­å®šï¼ˆãŠåå‰.comï¼‰

**é‡è¦**: ãŠåå‰.comã§ã¯ã€ãƒ›ã‚¹ãƒˆåã‹ã‚‰`.hey-watch.me`ã‚’çœç•¥ã—ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

1. **DKIMãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆ3ã¤ã®CNAMEï¼‰**: ãƒ¡ãƒ¼ãƒ«ç½²åæ¤œè¨¼ç”¨
   ```
   ã‚¿ã‚¤ãƒ—: CNAME
   ãƒ›ã‚¹ãƒˆå: xxxxx._domainkeyï¼ˆ.hey-watch.meã¯çœç•¥ï¼‰
   VALUE: xxxxx.dkim.amazonses.com
   ```

2. **MXãƒ¬ã‚³ãƒ¼ãƒ‰**: MAIL FROMãƒ‰ãƒ¡ã‚¤ãƒ³ç”¨
   ```
   ã‚¿ã‚¤ãƒ—: MX
   ãƒ›ã‚¹ãƒˆå: bounceï¼ˆ.hey-watch.meã¯çœç•¥ï¼‰
   VALUE: feedback-smtp.ap-southeast-2.amazonses.comï¼ˆå„ªå…ˆåº¦10ã¯åˆ¥æ¬„ï¼‰
   å„ªå…ˆåº¦: 10
   ```

3. **TXTãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆMAIL FROMç”¨ï¼‰**: SPFè¨­å®š
   ```
   ã‚¿ã‚¤ãƒ—: TXT
   ãƒ›ã‚¹ãƒˆå: bounce
   VALUE: v=spf1 include:amazonses.com ~allï¼ˆã‚¯ã‚©ãƒ¼ãƒˆä¸è¦ï¼‰
   ```

4. **TXTãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆDMARCï¼‰**: DMARCè¨­å®š
   ```
   ã‚¿ã‚¤ãƒ—: TXT
   ãƒ›ã‚¹ãƒˆå: _dmarc
   VALUE: v=DMARC1; p=none;ï¼ˆã‚¯ã‚©ãƒ¼ãƒˆä¸è¦ï¼‰
   ```

**è¨­å®šå¾Œ**: DNSåæ˜ ã¾ã§5-30åˆ†ï¼ˆæœ€å¤§72æ™‚é–“ï¼‰å¾…ã¤

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨åˆ°é”ç‡
- **DKIMç½²å**: ãƒ¡ãƒ¼ãƒ«ã®æ”¹ã–ã‚“é˜²æ­¢
- **SPFè¨­å®š**: é€ä¿¡å…ƒã‚µãƒ¼ãƒãƒ¼ã®æ­£å½“æ€§æ¤œè¨¼
- **DMARCæº–æ‹ **: Header Fromã¨MAIL FROMã®ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€è‡´
- **ã‚«ã‚¹ã‚¿ãƒ MAIL FROM**: `bounce.hey-watch.me`ã‚’ä½¿ç”¨

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### ä¼šå“¡ç™»éŒ²é–¢é€£

**ã€Œã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€**
- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‹ã‚‰æ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³

**ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã€**
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’8æ–‡å­—ä»¥ä¸Šã«è¨­å®š

**ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€**
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèªæ¬„ã‚’æ­£ã—ãå…¥åŠ›

**ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚‚ç”»é¢é·ç§»ã—ãªã„**
1. Xcodeã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ­ã‚°ã‚’ç¢ºèª
2. ã€Œâœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã€ãŒå‡ºã¦ã„ã‚‹ã‹ç¢ºèª
3. ã€ŒğŸ” isAuthenticatedå¤‰æ›´æ¤œçŸ¥: false â†’ trueã€ãŒå‡ºã¦ã„ã‚‹ã‹ç¢ºèª
4. ä¸Šè¨˜ãŒå‡ºã¦ã„ãªã„å ´åˆã¯ã€UserAccountManager.swiftã®`performSignIn`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç¢ºèª

#### ãƒ¡ãƒ¼ãƒ«é€ä¿¡é–¢é€£ï¼ˆå°†æ¥ã®å‚è€ƒç”¨ï¼‰

**æ³¨æ„**: ç¾åœ¨ã¯ãƒ¡ãƒ¼ãƒ«ç¢ºèªã‚’ç„¡åŠ¹åŒ–ã—ã¦ã„ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚

**ã€ŒError sending confirmation emailã€ã‚¨ãƒ©ãƒ¼**
1. **ãƒ›ã‚¹ãƒˆåã‚’ç¢ºèª**
   - æ­£: `email-smtp.ap-southeast-2.amazonaws.com`
   - èª¤: `email-smtp.ap-southeast-2.amazonses.com`
2. **SMTPèªè¨¼æƒ…å ±ã‚’å†ä½œæˆ**
   - AWS SES â†’ SMTP settings â†’ Create SMTP credentials
   - æ–°ã—ã„Usernameã¨Passwordã‚’Supabaseã«è¨­å®š
3. **Enable Custom SMTPãŒONã‹ç¢ºèª**
4. **Rate limitã‚’ç¢ºèª**
   - Supabase â†’ Authentication â†’ Rate Limits
   - ã€ŒRate limit for sending emailsã€ã‚’100ä»¥ä¸Šã«è¨­å®š

**ãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„å ´åˆ**
1. **è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèª**
2. **DNSè¨­å®šã®ç¢ºèª**
   - AWS SESã§ã€ŒVerifiedã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«ãªã£ã¦ã„ã‚‹ã‹
   - DKIM/SPF/DMARCãƒ¬ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
3. **Sandboxãƒ¢ãƒ¼ãƒ‰ç¢ºèª**
   - æœ¬ç•ªç’°å¢ƒã§ã¯ã€ŒProduction accessã€ç”³è«‹ãŒå¿…è¦
   - Sandboxãƒ¢ãƒ¼ãƒ‰ã§ã¯æ¤œè¨¼æ¸ˆã¿ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã®ã¿é€ä¿¡å¯èƒ½

## ğŸš¨ é‡è¦ï¼šèªè¨¼ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã®è¨­è¨ˆåŸå‰‡

### âŒ çµ¶å¯¾ã«è¡Œã£ã¦ã¯ã„ã‘ãªã„ã“ã¨

1. **auth.usersã¸ã®ç›´æ¥å‚ç…§ã‚’ä½œã‚‰ãªã„**
   - auth.usersã¯Supabaseã®å†…éƒ¨ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ï¼‰
   - ã™ã¹ã¦ã®å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã¯`public.users(user_id)`ã‚’å‚ç…§ã™ã‚‹ã“ã¨
   - `public.users.user_id`ã¯`auth.users.id`ã®ã‚³ãƒ”ãƒ¼ã¨ã—ã¦æ©Ÿèƒ½

2. **æ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆæ™‚ã®å¿…é ˆãƒ«ãƒ¼ãƒ«**
   ```sql
   -- âŒ é–“é•ã„ï¼šauth.usersã‚’ç›´æ¥å‚ç…§
   CREATE TABLE new_table (
       user_id UUID REFERENCES auth.users(id)  -- çµ¶å¯¾NGï¼
   );
   
   -- âœ… æ­£ã—ã„ï¼špublic.usersã‚’å‚ç…§
   CREATE TABLE new_table (
       user_id UUID REFERENCES public.users(user_id) ON DELETE CASCADE
   );
   ```

3. **iOSå´ã®ã‚³ãƒ¼ãƒ‰è¦å‰‡**
   ```swift
   // âŒ é–“é•ã„ï¼šauth.users.idã‚’ä½¿ç”¨
   let userId = userAccountManager.currentUser?.id
   
   // âœ… æ­£ã—ã„ï¼špublic.usersã®user_idã‚’ä½¿ç”¨
   let userId = userAccountManager.currentUser?.profile?.userId
   ```

### ãªãœã“ã®è¨­è¨ˆãŒå¿…è¦ã‹

1. **auth.usersã¯ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯**ï¼šSupabaseã®èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ãŒç®¡ç†ã€ç›´æ¥ã‚¯ã‚¨ãƒªä¸å¯
2. **public.usersãŒä»²ä»‹å½¹**ï¼šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒç®¡ç†ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
3. **æ•´åˆæ€§ã®ä¿è¨¼**ï¼špublic.usersãŒauth.usersã¨é€£å‹•ï¼ˆCASCADE DELETEï¼‰

#### RLSï¼ˆRow Level Securityï¼‰ã®é‡è¦æ€§

**user_devicesãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¯å¿…ãšRLSãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š**

```sql
-- RLSã‚’æœ‰åŠ¹åŒ–
ALTER TABLE user_devices ENABLE ROW LEVEL SECURITY;

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
CREATE POLICY "Users can view their own device associations" ON user_devices
    FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own device associations" ON user_devices
    FOR INSERT WITH CHECK (auth.uid() = user_id);
```

### é‡è¦ãªæ³¨æ„ç‚¹

- **ä¸€å¯¾å¤šã®é–¢ä¿‚**: 1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’æŒã¤ã“ã¨ãŒã§ãã‚‹
- **ãƒ‡ãƒã‚¤ã‚¹IDã®æ°¸ç¶šæ€§**: ãƒ‡ãƒã‚¤ã‚¹IDã¯ä¸€åº¦ç”Ÿæˆã•ã‚Œã‚‹ã¨å¤‰æ›´ã•ã‚Œãªã„
- **ãƒ‡ãƒ¼ã‚¿ã®é–¢é€£ä»˜ã‘**: ã™ã¹ã¦ã®éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚„åˆ†æçµæœã¯ãƒ‡ãƒã‚¤ã‚¹IDã«ç´ä»˜ã‘ã‚‰ã‚Œã‚‹
- **ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹éä¾å­˜**: ãƒ‡ãƒã‚¤ã‚¹IDã¯ç‰¹å®šã®iPhoneã«ç´ä»˜ã‹ãªã„ï¼ˆv9.29.0ã€œï¼‰

### IDç®¡ç†ã®è©³ç´°

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨ãƒ‡ãƒã‚¤ã‚¹IDã®é•ã„

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ID**
   - Supabaseèªè¨¼ã§ç”Ÿæˆã•ã‚Œã‚‹UUID
   - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨å–å¾—
   - ä¾‹ï¼š`164cba5a-dba6-4cbc-9b39-4eea28d98fa5`
   - 1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«1ã¤ã®ID

2. **ãƒ‡ãƒã‚¤ã‚¹ID**
   - ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²æ™‚ã«SupabaseãŒè‡ªå‹•ç”Ÿæˆã™ã‚‹UUID
   - ä¾‹ï¼š`d067d407-cf73-4174-a9c1-d91fb60d64d0`
   - 1ã¤ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’ç™»éŒ²å¯èƒ½
   - VIBEãƒ‡ãƒ¼ã‚¿ãªã©ã€ã™ã¹ã¦ã®åˆ†æãƒ‡ãƒ¼ã‚¿ã¯ã“ã®IDã«ç´ä»˜ã
   - **é‡è¦**: ç‰©ç†çš„ãªiPhoneã¨ã¯ç´ä»˜ã‹ãšã€ã€Œãƒ‡ãƒ¼ã‚¿ã®å…¥ã‚Œç‰©ã€ã¨ã—ã¦æ©Ÿèƒ½

#### DeviceManagerã§ç®¡ç†ã•ã‚Œã‚‹IDãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆv9.29.0ã§ç°¡ç´ åŒ–ï¼‰

DeviceManagerã¯ä»¥ä¸‹ã®2ã¤ã®ä¸»è¦ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ï¼š

1. **`userDevices: [Device]`**
   - **å½¹å‰²**: ç¾åœ¨ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹å…¨ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã®ãƒªã‚¹ãƒˆ
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’ç®¡ç†ã§ãã‚‹ã¨ã„ã†è¦ä»¶ã‚’æº€ãŸã™ãŸã‚ã«å¿…é ˆ

2. **`selectedDeviceID: String?`**
   - **å½¹å‰²**: ç¾åœ¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®UIä¸Šã§é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒã‚¤ã‚¹ã®ID
   - ã‚°ãƒ©ãƒ•è¡¨ç¤ºãƒ»éŒ²éŸ³ãªã©ã€å…¨ã¦ã®æ“ä½œã§ä½¿ç”¨ã•ã‚Œã‚‹å”¯ä¸€ã®ãƒ‡ãƒã‚¤ã‚¹ID
   - userDevicesã‹ã‚‰é¸æŠã•ã‚Œã‚‹ã‹ã€ãƒ‡ãƒã‚¤ã‚¹ãŒ1ã¤ã—ã‹ãªã„å ´åˆã¯è‡ªå‹•è¨­å®š

#### è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã®ç®¡ç†

1. **ãƒ‡ãƒã‚¤ã‚¹é¸æŠUI**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã‚’æŒã¤å ´åˆã€ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã§é¸æŠå¯èƒ½
   - 1ã¤ã—ã‹ãªã„å ´åˆã¯è‡ªå‹•é¸æŠ
   - é¸æŠã—ãŸãƒ‡ãƒã‚¤ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹

2. **ãƒ‡ãƒã‚¤ã‚¹å–å¾—ã®æµã‚Œ**
   ```swift
   // ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
   await deviceManager.fetchUserDevices(for: userId)

   // å–å¾—ã—ãŸãƒ‡ãƒã‚¤ã‚¹ã¯ä»¥ä¸‹ã§å‚ç…§
   deviceManager.userDevices          // å…¨ãƒ‡ãƒã‚¤ã‚¹ãƒªã‚¹ãƒˆ
   deviceManager.selectedDeviceID     // é¸æŠä¸­ã®ãƒ‡ãƒã‚¤ã‚¹ID
   ```

3. **ãƒ‡ãƒ¼ã‚¿å–å¾—æ™‚ã®æ³¨æ„**
   - å¸¸ã«`selectedDeviceID`ã‚’ä½¿ç”¨
   - ãƒ‡ãƒã‚¤ã‚¹ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆIDé–¢é€£ï¼‰

#### ãƒ‡ãƒã‚¤ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç´ä»˜ããƒ‡ãƒã‚¤ã‚¹ãŒæœ¬å½“ã«å­˜åœ¨ã™ã‚‹ã‹ç¢ºèª**
   ```sql
   SELECT * FROM devices WHERE owner_user_id = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ID';
   ```

2. **VIBEãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª**
   ```sql
   SELECT * FROM vibe_whisper_summary WHERE device_id = 'ãƒ‡ãƒã‚¤ã‚¹ID';
   ```

#### ã‚ˆãã‚ã‚‹é–“é•ã„

- âŒ å‰Šé™¤ã•ã‚ŒãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆ`localDeviceIdentifier`, `isDeviceRegistered`ï¼‰ã‚’ä½¿ç”¨ï¼ˆv9.29.0ã§å‰Šé™¤ï¼‰
- âœ… `selectedDeviceID`ã®ã¿ã‚’ä½¿ç”¨ï¼ˆå…¨ã¦ã®æ“ä½œã§ä½¿ç”¨ã•ã‚Œã‚‹å”¯ä¸€ã®ãƒ‡ãƒã‚¤ã‚¹IDï¼‰

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Swift 5.9+**
- **SwiftUI**
- **AVFoundation** - éŸ³å£°éŒ²éŸ³
- **Supabase** - èªè¨¼ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **Combine** - ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. **Xcodeã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã**
   ```bash
   open ios_watchme_v9.xcodeproj
   ```

2. **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¾å­˜é–¢ä¿‚ã®è§£æ±º**
   - Xcode ãŒè‡ªå‹•çš„ã« Swift Package Manager ã®ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã—ã¾ã™
   - Supabase SDK ãŒè‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™

3. **ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œ**
   - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ‡ãƒã‚¤ã‚¹ã‚’é¸æŠ
   - Run (Cmd + R) ã§ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œ

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
ios_watchme_v9/
â”œâ”€â”€ ios_watchme_v9App.swift        # ã‚¢ãƒ—ãƒªã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ ContentView.swift              # ãƒ¡ã‚¤ãƒ³ãƒ“ãƒ¥ãƒ¼ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªæ—¥ä»˜ç®¡ç†ï¼‰
â”œâ”€â”€ SimpleDashboardView.swift      # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆ.task(id:)ã§ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰
â”œâ”€â”€ HomeView.swift                 # å¿ƒç†ã‚°ãƒ©ãƒ•ï¼ˆæ™‚é–“è©³ç´°ãƒªã‚¹ãƒˆï¼‰è¡¨ç¤º
â”œâ”€â”€ BehaviorGraphView.swift        # è¡Œå‹•ã‚°ãƒ©ãƒ•
â”œâ”€â”€ EmotionGraphView.swift         # æ„Ÿæƒ…ã‚°ãƒ©ãƒ•
â”œâ”€â”€ RecordingView.swift            # éŒ²éŸ³æ©Ÿèƒ½ã¨ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
â”œâ”€â”€ LoginView.swift                # ãƒ­ã‚°ã‚¤ãƒ³UI
â”œâ”€â”€ AudioRecorder.swift            # éŒ²éŸ³ç®¡ç†
â”œâ”€â”€ NetworkManager.swift           # APIé€šä¿¡
â”œâ”€â”€ DeviceManager.swift            # ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†
â”œâ”€â”€ SupabaseAuthManager.swift      # èªè¨¼ç®¡ç†
â”œâ”€â”€ SupabaseDataManager.swift      # ãƒ‡ãƒ¼ã‚¿å–å¾—ç®¡ç†
â”œâ”€â”€ AvatarView.swift               # ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ AvatarPickerView.swift         # ã‚¢ãƒã‚¿ãƒ¼é¸æŠãƒ»ç·¨é›†UI
â”œâ”€â”€ AWSManager.swift               # Avatar Uploader APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”œâ”€â”€ Configuration.swift            # APIè¨­å®šç®¡ç†
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ BehaviorReport.swift       # è¡Œå‹•ãƒ¬ãƒãƒ¼ãƒˆãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ EmotionReport.swift        # æ„Ÿæƒ…ãƒ¬ãƒãƒ¼ãƒˆãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ Subject.swift              # è¦³æ¸¬å¯¾è±¡ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ DailyVibeReport.swift          # Vibeãƒ¬ãƒãƒ¼ãƒˆãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ DashboardTimeBlock.swift       # dashboardãƒ†ãƒ¼ãƒ–ãƒ«ã®æ™‚é–“ãƒ–ãƒ­ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ DashboardSummary.swift         # dashboard_summaryãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ RecordingModel.swift           # éŒ²éŸ³ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ SlotTimeUtility.swift          # æ™‚åˆ»ã‚¹ãƒ­ãƒƒãƒˆç®¡ç†
â”œâ”€â”€ Assets.xcassets/               # ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚«ãƒ©ãƒ¼ã‚»ãƒƒãƒˆ
â””â”€â”€ Info.plist                     # ã‚¢ãƒ—ãƒªè¨­å®š
```

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### UI/ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
1. **ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³æ§‹é€ **
   - **ContentView**: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ“ãƒ¥ãƒ¼ã§æ—¥ä»˜ç®¡ç†ã¨ã‚¹ãƒ¯ã‚¤ãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
   - **TabViewã‚¹ãƒ¯ã‚¤ãƒ—**: å·¦å³ã‚¹ãƒ¯ã‚¤ãƒ—ã§æ—¥ä»˜ã‚’åˆ‡ã‚Šæ›¿ãˆï¼ˆéå»1å¹´åˆ†ï¼‰
   - **æ—¥ä»˜ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: å‰æ—¥/æ¬¡æ—¥ãƒœã‚¿ãƒ³ã¨ã‚¹ãƒ¯ã‚¤ãƒ—ãŒé€£å‹•
   - **ãƒ¢ãƒ¼ãƒ€ãƒ«è©³ç´°è¡¨ç¤º**: å„ã‚°ãƒ©ãƒ•ã¯ã‚·ãƒ¼ãƒˆã§è¡¨ç¤ºï¼ˆv9.19.0ã€œï¼‰

2. **ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ç°¡ç´ åŒ–**
   - SwiftUIã®`.task(id:)`ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã§æ—¥ä»˜å¤‰æ›´ã‚’æ¤œçŸ¥
   - æ—¥ä»˜ãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨è‡ªå‹•çš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—
   - ViewModelã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ã—ãªã„
   - å„ãƒ“ãƒ¥ãƒ¼ãŒç‹¬ç«‹ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

3. **æ¨™æº–çš„ãªSwiftUIãƒ‘ã‚¿ãƒ¼ãƒ³**
   - `@State`ã«ã‚ˆã‚‹ç›´æ¥çš„ãªçŠ¶æ…‹ç®¡ç†
   - `@EnvironmentObject`ã§ã®å…±æœ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†
   - è¤‡é›‘ãªçŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¿ã‘ã‚‹
   - SwiftUIã®æ¨™æº–æ©Ÿèƒ½ã‚’æœ€å¤§é™æ´»ç”¨

#### ãƒ‡ãƒ¼ã‚¿ç®¡ç†
1. **AudioRecorder**
   - AVAudioRecorderã‚’ä½¿ç”¨ã—ãŸéŒ²éŸ³æ©Ÿèƒ½
   - WAVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã®ä¿å­˜
   - 30åˆ†é–“éš”ã§ã®è‡ªå‹•éŒ²éŸ³
   - **v9.24.1æ”¹å–„**: éŸ³å£°ä¼šè©±ã«æœ€é©åŒ–ã•ã‚ŒãŸéŒ²éŸ³è¨­å®š
     - `spokenAudio`ãƒ¢ãƒ¼ãƒ‰: éŸ³å£°ä¼šè©±ã®éŒ²éŸ³ã«ç‰¹åŒ–
     - `AVAudioQuality.high`: é«˜å“è³ªéŒ²éŸ³ã§éŸ³é‡ãƒ»æ˜ç­åº¦ã‚’å‘ä¸Š
     - ãƒã‚¤ã‚¯ã‚²ã‚¤ãƒ³1.0: å…¥åŠ›æ„Ÿåº¦ã‚’æœ€å¤§ã«è¨­å®š

2. **NetworkManager**
   - ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ç®¡ç†
   - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ–¹å¼ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆv9.7.0ã€œï¼‰
   - multipart/form-dataã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½

3. **SupabaseDataManager**ï¼ˆv9.18.0ã§ã‚·ãƒ³ãƒ—ãƒ«åŒ–ï¼‰
   - **ãƒ‡ãƒ¼ã‚¿å–å¾—**: `fetchAllReports`ãƒ¡ã‚½ãƒƒãƒ‰ã§å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
   - **RPCé–¢æ•°ã®æ´»ç”¨**: `get_dashboard_data`ã§åŠ¹ç‡çš„ã«ãƒ‡ãƒ¼ã‚¿å–å¾—
   - **ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹é€ **: ViewModelãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã›ãšã€ç›´æ¥ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
   - **`.task(id:)`ã¨ã®é€£æº**: å„ãƒ“ãƒ¥ãƒ¼ãŒç‹¬ç«‹ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

4. **èªè¨¼ãƒ»ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†**
   - SupabaseAuthManager: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
   - DeviceManager: ãƒ‡ãƒã‚¤ã‚¹é€£æºç®¡ç†ã¨ãƒ‡ãƒã‚¤ã‚¹é¸æŠï¼ˆæ‰‹å‹•é€£æºæ–¹å¼ï¼‰

#### ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆv9.9.0ã€œï¼‰
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã¯ã€SwiftUIã®`@EnvironmentObject`ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¦Single Source of Truthã‚’å®Ÿç¾ï¼š

```swift
// ã‚¢ãƒ—ãƒªãƒ¬ãƒ™ãƒ«ã§ã®åˆæœŸåŒ–
@main
struct ios_watchme_v9App: App {
    @StateObject private var dataManager = SupabaseDataManager()
    
    var body: some Scene {
        WindowGroup {
            MainAppView()
                .environmentObject(dataManager)  // ç’°å¢ƒã«æ³¨å…¥
        }
    }
}

// å„ãƒ“ãƒ¥ãƒ¼ã§ã®åˆ©ç”¨
struct HomeView: View {
    @EnvironmentObject var dataManager: SupabaseDataManager  // å…±æœ‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—
    // ...
}
```

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šï¼š
- **åŠ¹ç‡æ€§**: ä¸è¦ãªAPIã‚³ãƒ¼ãƒ«ã®å‰Šæ¸›
- **ä¸€è²«æ€§**: ãƒ“ãƒ¥ãƒ¼é–“ã§ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸã®è‡ªå‹•åŒ–
- **æ‹¡å¼µæ€§**: æ–°ã—ã„ã‚°ãƒ©ãƒ•ãƒ“ãƒ¥ãƒ¼ã§ã‚‚åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’åˆ©ç”¨å¯èƒ½

## ãƒ©ã‚¤ãƒ•ãƒ­ã‚°ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã®è¨­è¨ˆæ€æƒ³ ğŸ¯

### è¦³æ¸¬å¯¾è±¡ä¸­å¿ƒã®æ™‚é–“è»¸ç®¡ç†

æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯**ãƒ©ã‚¤ãƒ•ãƒ­ã‚°ãƒ„ãƒ¼ãƒ«**ã¨ã—ã¦ã€è¦³æ¸¬å¯¾è±¡ï¼ˆãƒ‡ãƒã‚¤ã‚¹ã‚’è£…ç€ã—ã¦ã„ã‚‹äººï¼‰ã®ç”Ÿæ´»ãƒªã‚ºãƒ ã‚’æ­£ç¢ºã«è¨˜éŒ²ã™ã‚‹ã“ã¨ã‚’æœ€é‡è¦è¦–ã—ã¦ã„ã¾ã™ã€‚

#### åŸºæœ¬åŸå‰‡

1. **ãƒ‡ãƒã‚¤ã‚¹ = è¦³æ¸¬å¯¾è±¡ã®æ™‚é–“è»¸**
   - ãƒ‡ãƒã‚¤ã‚¹ã¯ç‰¹å®šã®äººï¼ˆè¦³æ¸¬å¯¾è±¡ï¼‰ã®ç”Ÿæ´»ã‚’è¨˜éŒ²ã™ã‚‹
   - ãã®ãƒ‡ãƒã‚¤ã‚¹ãŒè¨­ç½®ã•ã‚Œã¦ã„ã‚‹å ´æ‰€ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãŒåŸºæº–
   - è¦³æ¸¬å¯¾è±¡ãŒæ±äº¬ã«ã„ã‚Œã°ã€æœ7æ™‚ã®æ´»å‹•ã¯ã€Œæœ7æ™‚ã€ã¨ã—ã¦è¨˜éŒ²

2. **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ‰€æœ‰è€…ã®ä½ç½®ã¯ç„¡é–¢ä¿‚**
   - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰ã¯è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿ã‚’é–²è¦§ã™ã‚‹ã ã‘
   - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ‰€æœ‰è€…ãŒã‚¢ãƒ¡ãƒªã‚«ã«ã„ã¦ã‚‚ã€æ±äº¬ã®ãƒ‡ãƒã‚¤ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã¯æ±äº¬æ™‚é–“ã§è¡¨ç¤º
   - ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã¨ä¸€è²«æ€§ã‚’ä¿è¨¼

3. **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®å›ºå®šæ€§**
   - ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯ç™»éŒ²æ™‚ã«è¨­å®šã•ã‚Œã€åŸºæœ¬çš„ã«å¤‰æ›´ã•ã‚Œãªã„
   - æ—…è¡Œãªã©ã®ä¸€æ™‚çš„ãªç§»å‹•ã§ã¯å¤‰æ›´ã—ãªã„ï¼ˆãƒ©ã‚¤ãƒ•ãƒ­ã‚°ã®ä¸€è²«æ€§ã®ãŸã‚ï¼‰
   - å¼•ã£è¶Šã—ãªã©æ’ä¹…çš„ãªå¤‰æ›´æ™‚ã®ã¿ã€è¨­å®šã‹ã‚‰å¤‰æ›´å¯èƒ½

#### å®Ÿè£…ã«ãŠã‘ã‚‹é‡è¦ãªæ±ºå®š

- **ãƒ‡ãƒ¼ã‚¿ä¿å­˜**: ãƒ‡ãƒã‚¤ã‚¹ã®ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã§ä¿å­˜ï¼ˆUTCã«å¤‰æ›ã—ãªã„ï¼‰
- **ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º**: å¸¸ã«ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§è¡¨ç¤º
- **æ—¥ä»˜ã®å¢ƒç•Œ**: ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§ã®0æ™‚ãŒæ—¥ä»˜ã®å¢ƒç•Œ

## APIé€£æºã¨ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

#### 1. éŒ²éŸ³ã‹ã‚‰ã‚°ãƒ©ãƒ•è¡¨ç¤ºã¾ã§ã®å®Œå…¨ãªãƒ•ãƒ­ãƒ¼

```
[iOS App] 
  â†“ éŒ²éŸ³ï¼ˆ30åˆ†ã”ã¨ã€ãƒ‡ãƒã‚¤ã‚¹ã®ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ï¼‰
  â†“
[Vault API]
  â†“ file_pathç”Ÿæˆ: files/{device_id}/{date}/{time_slot}/audio.wav
  â†“ recorded_at: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ä»˜ãã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆâ€»å°†æ¥å»ƒæ­¢äºˆå®šï¼‰
  â†“
[S3 Storage]
  â†“
[Lambda Function] â† ğŸ†• 2025-09-22: S3ã‚¤ãƒ™ãƒ³ãƒˆã§å³åº§ã«èµ·å‹•
  â†“ ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•å‡¦ç†
  â†“
[Whisper API / AST API / SUPERB API]
  â†“ ä¸¦åˆ—å‡¦ç†ã§éŸ³å£°åˆ†æ
  â†“ file_pathã‹ã‚‰æ—¥ä»˜ã¨time_blockã‚’æŠ½å‡º
  â†“ å„APIãŒçµæœã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
  â†“
[ChatGPT API]
  â†“ æ„Ÿæƒ…åˆ†æã¨ã‚¹ã‚³ã‚¢ç”Ÿæˆ
  â†“
[vibe_whisper_summary / dashboard_summary]
  â†“ æ—¥æ¬¡é›†è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆ48ã‚¹ãƒ­ãƒƒãƒˆï¼‰
  â†“
[iOS App]
  ã‚°ãƒ©ãƒ•è¡¨ç¤ºï¼ˆãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§ï¼‰
```

**ğŸ†• 2025-09-22 æ›´æ–°: Lambdaé–¢æ•°ã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†**
- S3ã«ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¨å³åº§ã«Lambdaé–¢æ•°ãŒèµ·å‹•
- iPhoneã€ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ã‚’å«ã‚€ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•å‡¦ç†
- å¾“æ¥ã®1æ™‚é–“ã”ã¨ã®cronå‡¦ç†ã‹ã‚‰ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ã«æ”¹å–„

#### 2. file_pathã®é‡è¦æ€§ã¨æ§‹é€ 

##### ç¾åœ¨ã®æ§‹é€ 
```
files/{device_id}/{YYYY-MM-DD}/{HH-MM}/audio.wav
```

- **device_id**: ãƒ‡ãƒã‚¤ã‚¹ã®è­˜åˆ¥å­
- **YYYY-MM-DD**: ãƒ‡ãƒã‚¤ã‚¹ã®ãƒ­ãƒ¼ã‚«ãƒ«æ—¥ä»˜
- **HH-MM**: 30åˆ†ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ00-00, 00-30, ..., 23-30ï¼‰

##### file_pathãŒä¿¡é ¼ã§ãã‚‹å”¯ä¸€ã®æ™‚é–“æƒ…å ±æºã§ã‚ã‚‹ç†ç”±

1. **éŒ²éŸ³æ™‚ç‚¹ã§ç¢ºå®š**: ãƒ‡ãƒã‚¤ã‚¹ã®ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã§ç”Ÿæˆ
2. **ä¸å¤‰æ€§**: ä¸€åº¦ç”Ÿæˆã•ã‚ŒãŸãƒ‘ã‚¹ã¯å¤‰æ›´ã•ã‚Œãªã„
3. **é€šä¿¡é…å»¶ã®å½±éŸ¿ãªã—**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ãŒã‚ã£ã¦ã‚‚ãƒ‘ã‚¹ã¯æ­£ç¢º
4. **å…¨å‡¦ç†ã§ä¸€è²«**: Whisperã€ChatGPTã€ã‚°ãƒ©ãƒ•è¡¨ç¤ºã¾ã§åŒã˜ãƒ‘ã‚¹ã‚’ä½¿ç”¨

##### ä»Šå¾Œã®æ§‹é€ åŒ–è¨ˆç”»

```sql
-- å°†æ¥çš„ãª audio_files ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 
CREATE TABLE audio_files (
    device_id UUID NOT NULL,
    local_date DATE NOT NULL,        -- ãƒ‡ãƒã‚¤ã‚¹ã®ãƒ­ãƒ¼ã‚«ãƒ«æ—¥ä»˜
    time_slot VARCHAR(5) NOT NULL,   -- "HH-MM" å½¢å¼
    file_path TEXT NOT NULL,          -- äº’æ›æ€§ã®ãŸã‚æ®‹ã™
    -- recorded_at ã¯å»ƒæ­¢
    PRIMARY KEY (device_id, local_date, time_slot)
);
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- é«˜é€Ÿãªã‚¯ã‚¨ãƒªï¼ˆæ—¥ä»˜ãƒ»æ™‚é–“ã§ã®æ¤œç´¢ãŒå®¹æ˜“ï¼‰
- ãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§ä¿è¨¼
- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³éä¾å­˜ã§æ˜ç¢º

#### 3. recorded_atã‚«ãƒ©ãƒ ã®å•é¡Œã¨å»ƒæ­¢äºˆå®š

##### ç¾åœ¨ã®å•é¡Œç‚¹
- ã‚°ãƒ©ãƒ•ç”Ÿæˆã§ã¯**ä¸€åˆ‡ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„**
- é€šä¿¡é…å»¶ã«ã‚ˆã‚Šå®Ÿéš›ã®éŒ²éŸ³æ™‚åˆ»ã¨ãšã‚Œã‚‹å¯èƒ½æ€§
- file_pathã®æƒ…å ±ã¨é‡è¤‡
- èª¤è§£ã‚’æ‹›ãï¼ˆä½¿ã‚ã‚Œã¦ã„ã‚‹ã¨æ€ã‚ã‚ŒãŒã¡ï¼‰

##### å»ƒæ­¢è¨ˆç”»
1. çŸ­æœŸ: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§éæ¨å¥¨ã¨ã—ã¦æ˜è¨˜
2. ä¸­æœŸ: æ–°è¦ãƒ‡ãƒ¼ã‚¿ã§ã¯è¨˜éŒ²ã—ãªã„
3. é•·æœŸ: ã‚«ãƒ©ãƒ ã‚’å®Œå…¨ã«å‰Šé™¤

### ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ
1. **éŸ³å£°éŒ²éŸ³** â†’ ãƒ‡ãƒã‚¤ã‚¹ãƒ­ãƒ¼ã‚«ãƒ«ã«WAVå½¢å¼ã§ä¿å­˜
2. **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰** â†’ Vault APIçµŒç”±ã§S3ã«ä¿å­˜ï¼ˆfile_pathç”Ÿæˆï¼‰
3. **Whisperå‡¦ç†** â†’ éŸ³å£°ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã€file_pathã‹ã‚‰æ—¥ä»˜ãƒ»æ™‚é–“ã‚’æŠ½å‡º
4. **æ„Ÿæƒ…åˆ†æ** â†’ ChatGPTã§æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ã‚’ç”Ÿæˆ
5. **é›†è¨ˆä¿å­˜** â†’ `vibe_whisper_summary`ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ—¥æ¬¡ã‚µãƒãƒªãƒ¼ã‚’ä¿å­˜
6. **ãƒ‡ãƒ¼ã‚¿å–å¾—** â†’ ã‚¢ãƒ—ãƒªã‹ã‚‰ãƒ‡ãƒã‚¤ã‚¹IDã¨æ—¥ä»˜ã§åˆ†æçµæœã‚’ç…§ä¼š

### é«˜é€Ÿãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆRPCå®Ÿè£…ï¼‰

æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Supabaseã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢æ•°ï¼ˆRPCï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€è¤‡æ•°ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’æœ€é©åŒ–ã—ã¦ã„ã¾ã™ã€‚

#### ğŸš¨ æ¥µã‚ã¦é‡è¦: RPCé–¢æ•°ã¯å¿…é ˆã§ã™ï¼
**ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯Supabase RPCé–¢æ•° `get_dashboard_data` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚**
**RPCé–¢æ•°ãŒå­˜åœ¨ã—ãªã„ã€ã¾ãŸã¯æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚**

âš ï¸ **2025å¹´8æœˆ15æ—¥æ›´æ–°**: 
- å€‹åˆ¥APIå‘¼ã³å‡ºã—ã‚’å»ƒæ­¢ã—ã€å®Œå…¨ã«RPCé–¢æ•°ãƒ™ãƒ¼ã‚¹ã«ç§»è¡Œã—ã¾ã—ãŸ
- Subjectï¼ˆè¦³æ¸¬å¯¾è±¡ï¼‰æƒ…å ±ã‚‚RPCé–¢æ•°ã‹ã‚‰å–å¾—ã•ã‚Œã¾ã™
- å€‹åˆ¥å–å¾—ãƒ¡ã‚½ãƒƒãƒ‰ã¯éæ¨å¥¨ï¼ˆ@deprecatedï¼‰ã¨ãªã‚Šã¾ã—ãŸ
- **ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰å‰Šé™¤å®Œäº†**ï¼š195è¡Œã®ã‚³ãƒ¼ãƒ‰å‰Šé™¤ã€ä¿å®ˆæ€§å‘ä¸Š

#### ğŸ”§ **æ”¹å–„äºˆå®šï¼ˆå°†æ¥ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰**
ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§éæ¨å¥¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚Šã¾ã™ã€‚å°†æ¥çš„ã«RPCç‰ˆã«ç§»è¡Œäºˆå®šï¼š

1. **ReportTestView.swift**
   - `fetchDailyReport` â†’ `fetchAllReports`ï¼ˆRPCç‰ˆï¼‰ã«å¤‰æ›´äºˆå®š
   - ãƒ†ã‚¹ãƒˆç”¨ç”»é¢ã®ãŸã‚å„ªå…ˆåº¦ä½

2. **UserInfoView.swift** 
   - `fetchSubjectForDevice` â†’ `fetchAllReports`ï¼ˆRPCç‰ˆï¼‰ã«å¤‰æ›´äºˆå®š
   - ãƒã‚¤ãƒšãƒ¼ã‚¸ã§ã®è¦³æ¸¬å¯¾è±¡è¡¨ç¤ºç”¨ã€ç¾åœ¨ã¯è­¦å‘Šè¡¨ç¤ºæ¸ˆã¿

1. **çµ±åˆãƒ‡ãƒ¼ã‚¿å–å¾—é–¢æ•° `get_dashboard_data`**
   - å˜ä¸€ã®RPCå‘¼ã³å‡ºã—ã§å…¨ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
   - dashboard_summaryã€behavior_summaryã€emotion_opensmile_summaryã€subjectsã€subject_commentsã®5ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä¸€æ‹¬å–å¾—
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ5å›ä»¥ä¸Šã‹ã‚‰1å›ã«å‰Šæ¸›
   - **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
     - `p_device_id`: ãƒ‡ãƒã‚¤ã‚¹IDï¼ˆTEXTå‹ã€UUIDå½¢å¼ï¼‰
     - `p_date`: æ—¥ä»˜ï¼ˆTEXTå‹ã€YYYY-MM-DDå½¢å¼ï¼‰
   - **æˆ»ã‚Šå€¤**: DashboardDataå‹ã®é…åˆ—ï¼ˆå„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ï¼‰

#### ğŸ“ å¿…é ˆ: RPCé–¢æ•°ã®æ­£ã—ã„å®Ÿè£…

Supabaseã® SQL Editor ã§ä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦ã€RPCé–¢æ•°ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š

```sql
CREATE OR REPLACE FUNCTION get_dashboard_data(
    p_device_id TEXT,
    p_date TEXT
)
RETURNS TABLE (
    vibe_report JSONB,
    behavior_report JSONB,
    emotion_report JSONB,
    subject_info JSONB
)
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN QUERY
    SELECT
        -- æ—¥ä»˜ã§ã®çµã‚Šè¾¼ã¿æ¡ä»¶ã‚’å«ã‚ã‚‹ï¼ˆé‡è¦ï¼ï¼‰
        (SELECT to_jsonb(t) FROM vibe_whisper_summary t 
         WHERE t.device_id = p_device_id AND t.date = p_date::date 
         LIMIT 1) AS vibe_report,
        
        (SELECT to_jsonb(t) FROM behavior_summary t 
         WHERE t.device_id = p_device_id AND t.date = p_date::date 
         LIMIT 1) AS behavior_report,
        
        (SELECT to_jsonb(t) FROM emotion_opensmile_summary t 
         WHERE t.device_id = p_device_id AND t.date = p_date::date 
         LIMIT 1) AS emotion_report,
        
        -- subject_infoã¯æ—¥ä»˜ã«é–¢ä¿‚ãªã„ã®ã§device_idã®ã¿ã§æ¤œç´¢
        (SELECT to_jsonb(s) FROM subjects s
         JOIN devices d ON s.subject_id = d.subject_id
         WHERE d.device_id = p_device_id::uuid 
         LIMIT 1) AS subject_info;
END;
$$;
```

**âš ï¸ æ³¨æ„äº‹é …:**
- å„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¯ã‚¨ãƒªã§ `AND t.date = p_date::date` ã®æ¡ä»¶ãŒå¿…é ˆã§ã™
- ã“ã®æ¡ä»¶ãŒãªã„ã¨ã€ã™ã¹ã¦ã®æ—¥ä»˜ã§åŒã˜ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ä¸å…·åˆãŒç™ºç”Ÿã—ã¾ã™
- `p_date`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯`TEXT`å‹ã§å—ã‘å–ã‚Šã€`::date`ã§ã‚­ãƒ£ã‚¹ãƒˆã—ã¦ä½¿ç”¨ã—ã¾ã™

2. **SupabaseDataManagerã®å®Ÿè£…**
   ```swift
   // ğŸš€ RPCã‚’ä½¿ã£ãŸé«˜é€Ÿãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆå¿…é ˆå®Ÿè£…ï¼‰
   func fetchAllReportsData(deviceId: String, date: Date) async -> DashboardData {
       let params = ["p_device_id": deviceId, "p_date": dateString]
       let response: [RPCDashboardResponse] = try await supabase.rpc("get_dashboard_data", params: params).execute().value
       // Subjectæƒ…å ±ã‚‚å«ã‚ã¦ä¸€æ‹¬å–å¾—
   }
   ```

3. **DashboardDataæ§‹é€ ä½“**
   ```swift
   struct DashboardData: Decodable {
       let behavior_report: BehaviorReport?     // behavior_summaryãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿
       let emotion_report: EmotionReport?       // emotion_opensmile_summaryãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿
       let subject_info: Subject?               // subjectsãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿
       let dashboard_summary: DashboardSummary? // dashboard_summaryãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆæ°—åˆ†ãƒ‡ãƒ¼ã‚¿å«ã‚€ï¼‰
       let subject_comments: [SubjectComment]?  // subject_commentsãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿
   }
   ```

4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿**
   - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºã®é…å»¶ã‚’å¤§å¹…ã«çŸ­ç¸®
   - ãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§ã‚’ä¿è¨¼ï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿ãŒåŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å–å¾—ï¼‰
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡ã®åŠ¹ç‡åŒ–ã«ã‚ˆã‚Šãƒãƒƒãƒ†ãƒªãƒ¼æ¶ˆè²»ã‚‚æ”¹å–„

#### ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°: ã™ã¹ã¦ã®æ—¥ä»˜ã§åŒã˜ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆ

ã‚‚ã—ç•°ãªã‚‹æ—¥ä»˜ã‚’é¸æŠã—ã¦ã‚‚åŒã˜ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

1. **RPCé–¢æ•°ã®å®Ÿè£…ç¢ºèª**
   - `get_dashboard_data`é–¢æ•°ãŒ`p_date`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ­£ã—ãå‡¦ç†ã—ã¦ã„ã‚‹ã‹
   - WHEREå¥ã§æ—¥ä»˜ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹
   - æ—¥ä»˜æ¯”è¼ƒãŒæ­£ã—ã„å½¢å¼ï¼ˆYYYY-MM-DDï¼‰ã§è¡Œã‚ã‚Œã¦ã„ã‚‹ã‹

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¢ºèª**
   - å„ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç•°ãªã‚‹æ—¥ä»˜ã®ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã‹
   - æ—¥ä»˜ã‚«ãƒ©ãƒ ãŒæ­£ã—ã„å½¢å¼ã§ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹

3. **ãƒ‡ãƒãƒƒã‚°æ–¹æ³•**
   - Xcodeã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§é€ä¿¡ã•ã‚Œã¦ã„ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç¢ºèª
   - Supabaseã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç›´æ¥RPCé–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆ
   - å„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’å€‹åˆ¥ã«ç¢ºèª

#### ğŸ“ˆ RPCé–¢æ•°ã®æ‹¡å¼µæ–¹æ³•ï¼ˆä»Šå¾Œã®é–‹ç™ºç”¨ï¼‰

æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§æ‹¡å¼µã—ã¦ãã ã•ã„ï¼š

1. **Supabaseå´ï¼ˆSQLï¼‰**ï¼šRPCé–¢æ•°ã«æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
   ```sql
   -- ä¾‹ï¼šæ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
   (SELECT to_jsonb(n) FROM new_table n 
    WHERE n.device_id = p_device_id AND n.date = p_date::date 
    LIMIT 1) AS new_report
   ```

2. **iOSå´ï¼ˆSwiftï¼‰**ï¼šæ§‹é€ ä½“ã‚’æ›´æ–°
   ```swift
   // RPCDashboardResponseã«æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
   struct RPCDashboardResponse: Codable {
       let vibe_report: DailyVibeReport?
       let behavior_report: BehaviorReport?
       let emotion_report: EmotionReport?
       let subject_info: Subject?
       let new_report: NewReport?  // æ–°è¦è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
   }
   ```

3. **äº’æ›æ€§ã®ç¶­æŒ**
   - æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¿…ãšã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼ˆ`?`ï¼‰ã§å®šç¾©
   - æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åå‰ã‚„å‹ã¯å¤‰æ›´ã—ãªã„
   - RPCé–¢æ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã‚‚å¤‰æ›´ã—ãªã„

âš ï¸ **é‡è¦**: RPCé–¢æ•°ã®æ›´æ–°ãŒå¿…è¦ãªå ´åˆã¯ã€é–‹ç™ºè€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚
Supabaseå´ã®æ›´æ–°ã¨ã€iOSå´ã®æ§‹é€ ä½“æ›´æ–°ãŒå¿…è¦ã§ã™ã€‚

### å¿ƒç†ã‚°ãƒ©ãƒ•ã®å®Ÿè£…ï¼ˆv9.25.0ã§å¤§å¹…å¤‰æ›´ï¼‰

1. **HomeViewï¼ˆæ™‚é–“è©³ç´°ãƒªã‚¹ãƒˆè¡¨ç¤ºï¼‰**
   - dashboardãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰48ã‚¹ãƒ­ãƒƒãƒˆã®æ™‚é–“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
   - å„æ™‚é–“ãƒ–ãƒ­ãƒƒã‚¯ã®vibe_scoreã¨summaryã‚’è¡¨ç¤º
   - ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãª1è¡Œè¡¨ç¤ºï¼ˆæ™‚é–“ã€ã‚¹ã‚³ã‚¢ã€ã‚µãƒãƒªãƒ¼1è¡Œç›®ï¼‰
   - ã‚¿ãƒƒãƒ—ã§è©³ç´°ã‚µãƒãƒªãƒ¼ã‚’å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿

2. **DashboardTimeBlockï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼‰**
   - dashboardãƒ†ãƒ¼ãƒ–ãƒ«ã®æ™‚é–“ãƒ–ãƒ­ãƒƒã‚¯ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†
   - time_blockã€summaryã€vibe_scoreãªã©ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
   - ã‚¹ã‚³ã‚¢ã«ã‚ˆã‚‹è‰²åˆ†ã‘æ©Ÿèƒ½

3. **SupabaseDataManager**
   - `fetchDashboardTimeBlocks`ãƒ¡ã‚½ãƒƒãƒ‰ã§dashboardãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
   - ãƒ‡ãƒã‚¤ã‚¹IDã¨æ—¥ä»˜ã§çµã‚Šè¾¼ã¿
   - æ™‚é–“é †ã§ã‚½ãƒ¼ãƒˆæ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´

## APIä»•æ§˜

### ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```
POST https://api.hey-watch.me/upload
Content-Type: multipart/form-data

Parameters:
- file: éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ« (WAVå½¢å¼)
- user_id: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- timestamp: éŒ²éŸ³æ™‚åˆ» (ISO 8601å½¢å¼ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ä»˜ã)
  ä¾‹: 2025-07-19T14:15:00+09:00
- metadata: ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã¨ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å«ã‚€JSON
  {
    "device_id": "device_xxxxx",
    "recorded_at": "2025-07-19T14:15:00+09:00"
  }
```

### ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å‡¦ç†ã®å®Ÿè£…è©³ç´° ï¼ˆv9.17.0ã€œï¼‰

æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€**ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’ä¸­å¿ƒã¨ã—ãŸè¨­è¨ˆ**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼š

#### 1. ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ç®¡ç†ã®éšå±¤

```
ãƒ‡ãƒã‚¤ã‚¹ï¼ˆè¦³æ¸¬å¯¾è±¡ã®æ™‚é–“è»¸ï¼‰
    â†“
DeviceManagerï¼ˆã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ç®¡ç†ï¼‰
    â†“
å„UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆãƒ‡ãƒã‚¤ã‚¹ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§è¡¨ç¤ºï¼‰
```

#### 2. DeviceManagerã®æ‹¡å¼µæ©Ÿèƒ½

```swift
// é¸æŠä¸­ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å–å¾—
var selectedDeviceTimezone: TimeZone {
    // devicesãƒ†ãƒ¼ãƒ–ãƒ«ã®timezoneã‚«ãƒ©ãƒ ã‹ã‚‰å–å¾—
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: TimeZone.current
}

// ãƒ‡ãƒã‚¤ã‚¹ç”¨ã®Calendarç”Ÿæˆ
var deviceCalendar: Calendar {
    var calendar = Calendar.current
    calendar.timeZone = selectedDeviceTimezone
    return calendar
}
```

#### 3. å®Ÿè£…ã•ã‚ŒãŸä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¿®æ­£

##### DatePagingView / DateNavigationView
- `Calendar.current`ã®ä½¿ç”¨ã‚’å»ƒæ­¢
- `deviceManager.deviceCalendar`ã‚’ä½¿ç”¨
- ã€Œä»Šæ—¥ã€ã®åˆ¤å®šã‚‚ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§å®Ÿè¡Œ

##### SlotTimeUtility
- UTCå¤‰æ›ã‚’å‰Šé™¤
- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
- ãƒ‡ãƒã‚¤ã‚¹ã®ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ç”Ÿæˆ

##### SupabaseDataManager
- UTCå¤‰æ›ã‚’å‰Šé™¤
- `fetchAllReports`ã«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
- ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§æ—¥ä»˜æ–‡å­—åˆ—ã‚’ç”Ÿæˆ

##### DashboardViewModel
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆã§ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’ä½¿ç”¨
- ãƒ‡ãƒ¼ã‚¿å–å¾—æ™‚ã«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’æ˜ç¤ºçš„ã«æ¸¡ã™

#### 4. éŒ²éŸ³æ™‚åˆ»ã®è¨˜éŒ²

```swift
// AudioRecorderã®å®Ÿè£…
private func getDeviceTimezone() -> TimeZone {
    return deviceManager?.selectedDeviceTimezone ?? TimeZone.current
}

// ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ç”Ÿæˆæ™‚
let dateString = SlotTimeUtility.getDateString(from: Date(), timezone: getDeviceTimezone())
```

#### 5. é‡è¦ãªè¨­è¨ˆæ±ºå®š

- **UTCå¤‰æ›ã®å®Œå…¨å»ƒæ­¢**: ãƒ‡ãƒ¼ã‚¿ã¯ãƒ‡ãƒã‚¤ã‚¹ã®ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã§ä¿å­˜ãƒ»å‡¦ç†
- **Calendar.currentã®ä½¿ç”¨ç¦æ­¢**: å¸¸ã«ãƒ‡ãƒã‚¤ã‚¹ã®Calendarã‚’ä½¿ç”¨
- **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®æ˜ç¤ºçš„ãªç®¡ç†**: æš—é»™çš„ãªã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ä½¿ç”¨ã‚’é¿ã‘ã‚‹

## é–‹ç™ºæ™‚ã®æ³¨æ„ç‚¹

### 1. Supabaseèªè¨¼ã®é‡è¦äº‹é … ğŸš¨

#### âŒ ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨
```swift
// âš ï¸ æ‰‹å‹•ã§APIã‚’å‘¼ã³å‡ºã•ãªã„ï¼
URLSession.shared.dataTask(with: "supabaseURL/auth/v1/token") { ... }
URLSession.shared.dataTask(with: "supabaseURL/rest/v1/table") { ... }
```

#### âœ… æ­£ã—ã„å®Ÿè£…
```swift
// ğŸ” èªè¨¼: Supabase SDKã®æ¨™æº–ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨
let session = try await supabase.auth.signIn(email: email, password: password)

// ğŸ“Š ãƒ‡ãƒ¼ã‚¿å–å¾—: SDKã®ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼ã‚’ä½¿ç”¨
let data: [MyModel] = try await supabase
    .from("table_name")
    .select()
    .eq("column", value: "value")
    .execute()
    .value
```

#### ğŸ” èªè¨¼æƒ…å ±ä¸æ•´åˆå•é¡Œã®è§£æ±ºï¼ˆv9.12.1ã§ä¿®æ­£æ¸ˆã¿ï¼‰
- **å•é¡Œ**: æ‰‹å‹•APIå‘¼ã³å‡ºã—ã§ã¯RLSãƒãƒªã‚·ãƒ¼ã‚’é€šéã§ããªã„
- **è§£æ±º**: å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã‚’SDKæ¨™æº–ãƒ¡ã‚½ãƒƒãƒ‰ã«çµ±ä¸€
- **åŠ¹æœ**: èªè¨¼çŠ¶æ…‹ã¨ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã®å®Œå…¨ãªæ•´åˆæ€§ã‚’å®Ÿç¾

#### èªè¨¼çŠ¶æ…‹ã®å¾©å…ƒï¼ˆã‚¢ãƒ—ãƒªå†èµ·å‹•æ™‚ï¼‰
```swift
// ä¿å­˜ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¾©å…ƒ
_ = try await supabase.auth.setSession(
    accessToken: savedUser.accessToken,
    refreshToken: savedUser.refreshToken
)
```

#### ã‚°ãƒ­ãƒ¼ãƒãƒ«Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½¿ç”¨
```swift
// SupabaseAuthManager.swiftã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨
let supabase = SupabaseClient(...)  // ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©

// å„ã‚¯ãƒ©ã‚¹ã§ç‹¬è‡ªã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã—ãªã„ï¼
// âŒ self.supabase = SupabaseClient(...)  // ã“ã‚Œã¯NG
```

### 2. RLSï¼ˆRow Level Securityï¼‰ã®è¨­å®š

æ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹éš›ã¯ã€å¿…ãšRLSãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š

1. **RLSã‚’æœ‰åŠ¹åŒ–**
2. **é©åˆ‡ãªãƒãƒªã‚·ãƒ¼ã‚’è¨­å®š**ï¼ˆèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªã©ï¼‰
3. **ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª**

### 3. ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†ã®æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆv9.29.0ã§å¤§å¹…ç°¡ç´ åŒ–ï¼‰

- **ãƒ‡ãƒã‚¤ã‚¹é¸æŠæ–¹å¼**ï¼š
  - ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ã¨ã®ç´ä»˜ã‘ã‚’å®Œå…¨å»ƒæ­¢
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‡ãƒã‚¤ã‚¹è¨­å®šç”»é¢ã§ãƒ‡ãƒã‚¤ã‚¹ã‚’é¸æŠã™ã‚‹ã ã‘
  - ã©ã®iPhoneã‹ã‚‰ã§ã‚‚ã€åŒã˜ãƒ‡ãƒã‚¤ã‚¹IDã‚’é¸æŠã™ã‚Œã°åŒã˜ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
  - ãƒãƒ³ãƒ‰ãƒ«IDå¤‰æ›´ã‚„ã‚¢ãƒ—ãƒªå†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å½±éŸ¿ã‚’å—ã‘ãªã„
- **user_devicesãƒ†ãƒ¼ãƒ–ãƒ«**ã‚’çµŒç”±ã—ã¦ãƒ‡ãƒã‚¤ã‚¹ã‚’ç®¡ç†
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã‚’æŒã¦ã‚‹ï¼ˆowner/viewerãƒ­ãƒ¼ãƒ«ä»˜ãï¼‰
- `DeviceManager.fetchUserDevices`ã¯ä»¥ä¸‹ã®æµã‚Œï¼š
  1. user_devicesãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§ã‚’å–å¾—
  2. devicesãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰è©³ç´°æƒ…å ±ã‚’å–å¾—
  3. roleæƒ…å ±ã‚’ä»˜ä¸ã—ã¦UIã«åæ˜ 

### 4. ãƒã‚¤ã‚¯æ¨©é™
- Info.plistã«`NSMicrophoneUsageDescription`ãŒå¿…è¦
- åˆå›èµ·å‹•æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¨©é™ã‚’æ±‚ã‚ã‚‹

### 5. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†
- Background Modesã§audioã‚’æœ‰åŠ¹åŒ–
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚‚ç¶™ç¶š

### 6. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã®å®šæœŸçš„ãªå‰Šé™¤
- ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã®ç›£è¦–

### 7. ã‚¢ãƒã‚¿ãƒ¼æ©Ÿèƒ½ã®é–‹ç™ºï¼ˆv9.20.0ã€œï¼‰
- **APIè¨­å®š**: `Configuration.swift`ã§Avatar Uploader APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç®¡ç†
  - é–‹ç™ºç’°å¢ƒ: `http://3.24.16.82:8014`ï¼ˆEC2ç›´æ¥ï¼‰
  - æœ¬ç•ªç’°å¢ƒ: `https://api.hey-watch.me/avatar`ï¼ˆNginxçµŒç”±ã€å°†æ¥å®Ÿè£…äºˆå®šï¼‰
- **èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³**: `SupabaseAuthManager.getAccessToken()`ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: `AWSManager`ã§HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«å¿œã˜ãŸè©³ç´°ãªã‚¨ãƒ©ãƒ¼å‡¦ç†
- **ç”»åƒå‡¦ç†**: å¤§ãã„ç”»åƒã§ã®ãƒ¡ãƒ¢ãƒªå•é¡Œã«æ³¨æ„ï¼ˆãƒˆãƒªãƒŸãƒ³ã‚°å‰ã®ãƒªã‚µã‚¤ã‚ºã‚’æ¤œè¨ï¼‰

### 8. éŸ³å£°éŒ²éŸ³å“è³ªã®æœ€é©åŒ–ï¼ˆv9.24.1ã€œï¼‰

#### æ”¹å–„æ¦‚è¦
å¾“æ¥ã®`measurement`ãƒ¢ãƒ¼ãƒ‰ã¨`AVAudioQuality.medium`ã‹ã‚‰ã€éŸ³å£°ä¼šè©±ã«ç‰¹åŒ–ã—ãŸè¨­å®šã«å¤‰æ›´ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€AIåˆ†æã«å¿…è¦ãªæ˜ç­ãªéŸ³å£°ãƒ‡ãƒ¼ã‚¿ã®éŒ²éŸ³ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

#### æŠ€è¡“çš„ãªæ”¹å–„ç‚¹

1. **AVAudioSessionãƒ¢ãƒ¼ãƒ‰ã®å¤‰æ›´**
   ```swift
   // å¤‰æ›´å‰ï¼ˆv9.24.0ä»¥å‰ï¼‰
   try audioSession.setCategory(.record, mode: .measurement)
   
   // å¤‰æ›´å¾Œï¼ˆv9.24.1ã€œï¼‰
   try audioSession.setCategory(.record, mode: .spokenAudio, options: [])
   ```
   - `measurement`ãƒ¢ãƒ¼ãƒ‰: æ¸¬å®šæ©Ÿå™¨å‘ã‘ã®è¨­å®šã€éŸ³å£°ä¼šè©±ã«ã¯ä¸é©åˆ‡
   - `spokenAudio`ãƒ¢ãƒ¼ãƒ‰: éŸ³å£°ä¼šè©±ã«æœ€é©åŒ–ã€ãƒã‚¤ã‚ºãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³å¼·åŒ–

2. **éŒ²éŸ³å“è³ªã®å‘ä¸Š**
   ```swift
   // å¤‰æ›´å‰ï¼ˆv9.24.0ä»¥å‰ï¼‰
   AVEncoderAudioQualityKey: AVAudioQuality.medium.rawValue
   
   // å¤‰æ›´å¾Œï¼ˆv9.24.1ã€œï¼‰
   AVEncoderAudioQualityKey: AVAudioQuality.high.rawValue
   ```
   - `medium`å“è³ª: 16kHzéŒ²éŸ³ã«ã¯ä¸ååˆ†
   - `high`å“è³ª: ã‚ˆã‚Šè‰¯ã„éŸ³é‡ãƒ»æ˜ç­åº¦ã‚’å®Ÿç¾

3. **ãƒã‚¤ã‚¯ã‚²ã‚¤ãƒ³ã®æœ€é©åŒ–**
   ```swift
   // æ–°è¦è¿½åŠ ï¼ˆv9.24.1ã€œï¼‰
   if audioSession.isInputGainSettable {
       try audioSession.setInputGain(1.0)  // æœ€å¤§ã‚²ã‚¤ãƒ³
   }
   ```
   - ãƒ‡ãƒã‚¤ã‚¹ãŒã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹å ´åˆã€ãƒã‚¤ã‚¯å…¥åŠ›æ„Ÿåº¦ã‚’æœ€å¤§ã«è¨­å®š
   - ä½éŸ³é‡å•é¡Œã‚’æ ¹æœ¬çš„ã«è§£æ±º

#### æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

1. **éŸ³é‡ã®å‘ä¸Š**: ãƒã‚¤ã‚¯ã‚²ã‚¤ãƒ³æœ€å¤§åŒ–ã«ã‚ˆã‚Šå°ã•ãªå£°ã‚‚ç¢ºå®Ÿã«éŒ²éŸ³
2. **æ˜ç­åº¦ã®æ”¹å–„**: `spokenAudio`ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒã‚¤ã‚ºé™¤å»å¼·åŒ–
3. **AIåˆ†æç²¾åº¦å‘ä¸Š**: ã‚ˆã‚Šè‰¯ã„éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹æ„Ÿæƒ…ãƒ»è¡Œå‹•åˆ†æã®ç²¾åº¦å‘ä¸Š
4. **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š**: éŒ²éŸ³ã®å¤±æ•—ã‚„éŸ³é‡ä¸è¶³ã®å•é¡Œã‚’å¤§å¹…ã«å‰Šæ¸›

### 9. ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä»•æ§˜ï¼ˆv9.7.0ã€œï¼‰

#### æ¦‚è¦
å¾“æ¥ã®`Data(contentsOf:)`ã«ã‚ˆã‚‹ä¸€æ‹¬ãƒ¡ãƒ¢ãƒªèª­ã¿è¾¼ã¿æ–¹å¼ã‹ã‚‰ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ–¹å¼ã«ç§»è¡Œã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã«é–¢ä¿‚ãªãå®‰å®šã—ãŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

#### æŠ€è¡“ä»•æ§˜
1. **ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«æˆ¦ç•¥**
   - multipart/form-dataã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦æ§‹ç¯‰
   - `FileManager.default.temporaryDirectory`ã«ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
   - UUIDãƒ™ãƒ¼ã‚¹ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ•ã‚¡ã‚¤ãƒ«åã§è¡çªã‚’å›é¿

2. **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚³ãƒ”ãƒ¼**
   - éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’64KBå˜ä½ã®ãƒãƒ£ãƒ³ã‚¯ã§èª­ã¿è¾¼ã¿
   - FileHandleã‚’ä½¿ç”¨ã—ãŸãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
   - autoreleasepoolã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªã®é©åˆ‡ãªè§£æ”¾

3. **URLSessionUploadTask**
   - `dataTask`ã‹ã‚‰`uploadTask(with:fromFile:)`ã«å¤‰æ›´
   - OSãƒ¬ãƒ™ãƒ«ã§ã®åŠ¹ç‡çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
   - ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã®å®‰å®šã—ãŸè»¢é€

4. **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†**
   - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†å¾Œã«ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•å‰Šé™¤
   - deferãƒ–ãƒ­ãƒƒã‚¯ã«ã‚ˆã‚‹ç¢ºå®Ÿãªãƒªã‚½ãƒ¼ã‚¹è§£æ”¾
   - ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚é©åˆ‡ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

#### ãƒ¡ãƒªãƒƒãƒˆ
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã¾ãªã„ãŸã‚ã€å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚å®‰å®šå‹•ä½œ
- **ä¿¡é ¼æ€§å‘ä¸Š**: ãƒ¡ãƒ¢ãƒªä¸è¶³ã«ã‚ˆã‚‹ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—ã‚’å®Œå…¨ã«è§£æ¶ˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: OSãƒ¬ãƒ™ãƒ«ã®æœ€é©åŒ–ã«ã‚ˆã‚Šã€åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿è»¢é€ã‚’å®Ÿç¾

#### å®Ÿè£…ä¾‹
```swift
// ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ›¸ãè¾¼ã¿
let tempFileURL = FileManager.default.temporaryDirectory.appendingPathComponent("\(UUID().uuidString).tmp")
let fileHandle = FileHandle(forWritingAtPath: tempFileURL.path)

// 64KBã”ã¨ã«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚³ãƒ”ãƒ¼
let bufferSize = 65536 // 64KB
while true {
    let chunk = audioFileHandle.readData(ofLength: bufferSize)
    if chunk.isEmpty { break }
    fileHandle.write(chunk)
}

// URLSessionUploadTaskã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
let uploadTask = URLSession.shared.uploadTask(with: request, fromFile: tempFileURL) { data, response, error in
    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    defer { try? FileManager.default.removeItem(at: tempFileURL) }
    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†
}
```

### 9. Xcodeãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã®å¯¾å‡¦

#### "Missing package product 'Supabase'" ã‚¨ãƒ©ãƒ¼

ã“ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ä»¥ä¸‹ã®æ‰‹é †ã§è§£æ±ºã§ãã¾ã™ï¼š

1. **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ**
   ```bash
   ./reset_packages.sh
   ```

2. **Xcodeã§ã®æ“ä½œ**
   - Xcodeã‚’å®Œå…¨ã«çµ‚äº†
   - Xcodeã‚’å†èµ·å‹•ã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã
   - File â†’ Packages â†’ Reset Package Caches
   - File â†’ Packages â†’ Resolve Package Versions
   - Product â†’ Clean Build Folder (Shift+Cmd+K)
   - Product â†’ Build (Cmd+B)

3. **ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆ**
   - Project Navigator ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ
   - Package Dependencies ã‚¿ãƒ–ã‚’é¸æŠ
   - Supabase ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‰Šé™¤ï¼ˆâˆ’ãƒœã‚¿ãƒ³ï¼‰
   - +ãƒœã‚¿ãƒ³ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å†è¿½åŠ ï¼š`https://github.com/supabase/supabase-swift`

#### "Duplicate GUID reference" ã‚¨ãƒ©ãƒ¼

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«é‡è¤‡ã—ãŸå‚ç…§ãŒã‚ã‚‹å ´åˆï¼š

1. DerivedDataã‚’å‰Šé™¤
   ```bash
   rm -rf ~/Library/Developer/Xcode/DerivedData/*
   ```

2. Xcodeã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
   ```bash
   rm -rf ~/Library/Caches/com.apple.dt.Xcode
   ```

3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ä¸€èˆ¬çš„ãªå•é¡Œ

- **éŒ²éŸ³ãŒé–‹å§‹ã•ã‚Œãªã„**: ãƒã‚¤ã‚¯æ¨©é™ã‚’ç¢ºèª
- **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå¤±æ•—ã™ã‚‹**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã¨ã‚µãƒ¼ãƒãƒ¼URLã‚’ç¢ºèª
- **èªè¨¼ã‚¨ãƒ©ãƒ¼**: Supabaseã®è¨­å®šã¨APIã‚­ãƒ¼ã‚’ç¢ºèª
- **ã‚¢ãƒã‚¿ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„**: 
  - Avatar Uploader APIã®ç¨¼åƒçŠ¶æ…‹ã‚’ç¢ºèªï¼ˆhttp://3.24.16.82:8014/healthï¼‰
  - S3ã®URLå½¢å¼ã‚’ç¢ºèªï¼ˆ`watchme-avatars.s3.ap-southeast-2.amazonaws.com`ï¼‰
  - Xcodeã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ­ã‚°ã‚’ç¢ºèª

### èªè¨¼ãƒ»ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã®å•é¡Œ

#### ãƒ‡ãƒã‚¤ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã„å ´åˆ

1. **èªè¨¼çŠ¶æ…‹ã®ç¢ºèª**
   ```swift
   // DeviceManagerã®ãƒ­ã‚°ã§ç¢ºèª
   "âœ… èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼: [ID]" ã¾ãŸã¯ "âŒ èªè¨¼ã•ã‚Œã¦ã„ã¾ã›ã‚“"
   ```

2. **RLSãƒãƒªã‚·ãƒ¼ã®ç¢ºèª**
   - user_devicesãƒ†ãƒ¼ãƒ–ãƒ«ã«RLSãŒæœ‰åŠ¹ã‹ç¢ºèª
   - é©åˆ‡ãªãƒãƒªã‚·ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

3. **ä¸€åº¦ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦å†ãƒ­ã‚°ã‚¤ãƒ³**
   - å¤ã„èªè¨¼æƒ…å ±ãŒæ®‹ã£ã¦ã„ã‚‹å¯èƒ½æ€§
   - æ–°ã—ã„èªè¨¼ãƒ•ãƒ­ãƒ¼ã§å•é¡Œè§£æ±º

#### "Decoded user_devices count: 0"ã‚¨ãƒ©ãƒ¼

**åŸå› **: èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„
**è§£æ±ºç­–**: 
1. SupabaseAuthManagerãŒæ¨™æº–ã®SDKãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ç¢ºèª
2. DeviceManagerãŒã‚°ãƒ­ãƒ¼ãƒãƒ«supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ç¢ºèª
3. checkAuthStatusã§ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒãŒæ­£ã—ãè¡Œã‚ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³é–¢é€£ã®å•é¡Œã¨è§£æ±ºç­– ï¼ˆv9.17.0ã§æ”¹å–„ï¼‰

#### å•é¡Œ: æ—¥ä»˜ãŒãšã‚Œã‚‹ã€ç•°ãªã‚‹ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®ãƒ‡ãƒã‚¤ã‚¹ã§è¡¨ç¤ºãŒãŠã‹ã—ã„

**åŸå› ã¨è§£æ±ºç­–**:

1. **Calendar.currentã®ä½¿ç”¨ã‚’ç¢ºèª**
   - âŒ å•é¡Œ: `Calendar.current`ã¯iPhoneã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
   - âœ… è§£æ±º: `deviceManager.deviceCalendar`ã‚’ä½¿ç”¨

2. **UTCå¤‰æ›ã®ç¢ºèª**
   - âŒ å•é¡Œ: ãƒ‡ãƒ¼ã‚¿ã‚’UTCã«å¤‰æ›ã—ã¦ã„ã‚‹
   - âœ… è§£æ±º: ãƒ‡ãƒã‚¤ã‚¹ã®ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã®ã¾ã¾ä¿å­˜

3. **ãƒ‡ãƒã‚¤ã‚¹åˆ‡ã‚Šæ›¿ãˆæ™‚ã®å•é¡Œ**
   - ç¢ºèª: `DeviceManager.selectedDeviceTimezone`ãŒæ­£ã—ãå–å¾—ã•ã‚Œã¦ã„ã‚‹ã‹
   - ç¢ºèª: å„ViewãŒ`@EnvironmentObject`ã§DeviceManagerã‚’å‚ç…§ã—ã¦ã„ã‚‹ã‹

4. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¢ºèª**
   ```sql
   -- ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   SELECT device_id, timezone FROM devices WHERE device_id = 'your-device-id';
   
   -- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãŒNULLã®å ´åˆã¯æ›´æ–°
   UPDATE devices SET timezone = 'Asia/Tokyo' WHERE device_id = 'your-device-id';
   ```

5. **ãƒ‡ãƒãƒƒã‚°æ–¹æ³•**
   ```swift
   // ç¾åœ¨ã®ãƒ‡ãƒã‚¤ã‚¹ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’ç¢ºèª
   print("Device Timezone: \(deviceManager.selectedDeviceTimezone)")
   
   // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã‚’ç¢ºèªï¼ˆæ—¥ä»˜ãŒæ­£ã—ã„ã‹ï¼‰
   print("Cache Key: \(makeCacheKey(deviceId: deviceId, date: date))")
   ```

#### å•é¡Œ: file_pathã®æ—¥ä»˜ã¨ã‚°ãƒ©ãƒ•è¡¨ç¤ºã®æ—¥ä»˜ãŒä¸€è‡´ã—ãªã„

**åŸå› **: Vault APIã§ã®file_pathç”Ÿæˆæ™‚ã¨iOSã‚¢ãƒ—ãƒªã§ã®è¡¨ç¤ºæ™‚ã§ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãŒç•°ãªã‚‹

**è§£æ±ºç­–**:
1. Vault APIãŒ`recorded_at`ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’ä¿æŒã—ã¦ã„ã‚‹ã‹ç¢ºèª
2. file_pathã®æ—¥ä»˜éƒ¨åˆ†ãŒãƒ‡ãƒã‚¤ã‚¹ã®ãƒ­ãƒ¼ã‚«ãƒ«æ—¥ä»˜ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
3. iOSå´ã§`SlotTimeUtility.getDateString`ã«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’æ¸¡ã—ã¦ã„ã‚‹ã‹ç¢ºèª

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼**: ä¸Šè¨˜ã®ã€ŒXcodeãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã®å¯¾å‡¦ã€ã‚’å‚ç…§
- **ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ã®ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼**: å®Ÿæ©Ÿã‚’é¸æŠã™ã‚‹ã‹ã€é©åˆ‡ãªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’é¸æŠ

## ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### ãƒ­ã‚°ã®ç¢ºèª
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯è©³ç´°ãªãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¾ã™ï¼š
- ğŸš€ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–‹å§‹
- âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
- âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
- ğŸ“Š ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±
- ğŸ” ãƒ‡ãƒã‚¤ã‚¹IDç¢ºèª
- ğŸ“± ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²çŠ¶æ…‹

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡ã®ç¢ºèª
Xcodeã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€é€ä¿¡ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å†…å®¹ã‚’ç¢ºèªã§ãã¾ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®ç¢ºèª
VIBEãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®ç¢ºèªæ‰‹é †ï¼š

1. **é¸æŠä¸­ã®ãƒ‡ãƒã‚¤ã‚¹IDã‚’ç¢ºèª**
   ```swift
   print("Selected Device ID: \(deviceManager.selectedDeviceID ?? "nil")")
   ```

2. **Supabaseã§ãƒ‡ãƒ¼ã‚¿å­˜åœ¨ç¢ºèª**
   ```sql
   -- ãƒ‡ãƒã‚¤ã‚¹ã®ç¢ºèª
   SELECT * FROM devices WHERE owner_user_id = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ID';
   
   -- VIBEãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
   SELECT * FROM vibe_whisper_summary WHERE device_id = 'ãƒ‡ãƒã‚¤ã‚¹ID';
   ```

3. **æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ç¢ºèª**
   - æ—¥ä»˜ã¯`YYYY-MM-DD`å½¢å¼ã§ä¿å­˜ã•ã‚Œã‚‹
   - ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯è€ƒæ…®ã•ã‚Œãªã„ï¼ˆæ—¥ä»˜ã®ã¿ï¼‰

## UI/UXè¨­è¨ˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### NavigationViewã®é©åˆ‡ãªä½¿ç”¨æ–¹æ³•

æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€iOSæ¨™æº–ã®UIã‚’ç¶­æŒã—ã¤ã¤ã€é©åˆ‡ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ§‹é€ ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’éµå®ˆã—ã¾ã™ï¼š

#### âœ… æ¨å¥¨ã•ã‚Œã‚‹å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

1. **ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆ.sheetï¼‰å†…ã§ã®NavigationViewä½¿ç”¨**
   ```swift
   .sheet(isPresented: $showSheet) {
       NavigationView {  // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã§ç‹¬ç«‹ã—ãŸNavigationViewã‚’ä½¿ç”¨
           ContentView()
               .navigationTitle("ã‚¿ã‚¤ãƒˆãƒ«")
               .toolbar {
                   ToolbarItem(placement: .cancellationAction) {
                       Button("ã‚­ãƒ£ãƒ³ã‚»ãƒ«") { dismiss() }
                   }
               }
       }
   }
   ```
   - ãƒ¢ãƒ¼ãƒ€ãƒ«ã¯ç‹¬ç«‹ã—ãŸãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãªã®ã§ã€ãã®ä¸­ã§NavigationViewã‚’ä½¿ç”¨ã—ã¦ã‚‚ãƒã‚¹ãƒˆã«ãªã‚Šã¾ã›ã‚“
   - iOSæ¨™æº–ã®ç¾ã—ã„ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ãŒåˆ©ç”¨ã§ãã¾ã™

2. **NavigationLinkã«ã‚ˆã‚‹ç”»é¢é·ç§»**
   ```swift
   NavigationLink(destination: DetailView()) {
       Text("è©³ç´°ç”»é¢ã¸")
   }
   ```
   - éšå±¤çš„ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯NavigationLinkã‚’ä½¿ç”¨
   - ãƒ¢ãƒ¼ãƒ€ãƒ«ã§ã¯ãªãã€ãƒ—ãƒƒã‚·ãƒ¥é·ç§»ãŒé©åˆ‡ãªå ´åˆã«ä½¿ç”¨

#### âŒ é¿ã‘ã‚‹ã¹ãå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

1. **NavigationViewã®å…¥ã‚Œå­ï¼ˆãƒã‚¹ãƒˆï¼‰**
   ```swift
   // NG: NavigationViewå†…ã§ã•ã‚‰ã«NavigationViewã‚’å«ã‚€ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
   NavigationView {
       NavigationLink(destination: NavigationView { ... })
   }
   ```

2. **ãƒ¢ãƒ¼ãƒ€ãƒ«å‘¼ã³å‡ºã—æ™‚ã®NavigationViewãƒ©ãƒƒãƒ—**
   ```swift
   // NG: sheetå‘¼ã³å‡ºã—å´ã§NavigationViewã§ãƒ©ãƒƒãƒ—
   .sheet(isPresented: $show) {
       NavigationView {  // å‘¼ã³å‡ºã—å´ã§ãƒ©ãƒƒãƒ—ã—ãªã„
           SomeView()
       }
   }
   ```

#### å®Ÿè£…ä¾‹ï¼šUserInfoViewã®ã‚¢ãƒã‚¿ãƒ¼é¸æŠ

æ­£ã—ã„å®Ÿè£…ã«ã‚ˆã‚Šã€iOSæ¨™æº–ã®ç¾ã—ã„UIã‚’å®Ÿç¾ï¼š
- ã‚¢ãƒã‚¿ãƒ¼é¸æŠç”»é¢ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆsheetï¼‰ã§è¡¨ç¤º
- ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã§ç‹¬ç«‹ã—ãŸNavigationViewã‚’ä½¿ç”¨
- æ¨™æº–çš„ãªãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã‚’é…ç½®

## Git é‹ç”¨ãƒ«ãƒ¼ãƒ«ï¼ˆãƒ–ãƒ©ãƒ³ãƒãƒ™ãƒ¼ã‚¹é–‹ç™ºãƒ•ãƒ­ãƒ¼ï¼‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€**ãƒ–ãƒ©ãƒ³ãƒãƒ™ãƒ¼ã‚¹ã®é–‹ç™ºãƒ•ãƒ­ãƒ¼**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚  
main ãƒ–ãƒ©ãƒ³ãƒã§ç›´æ¥é–‹ç™ºã›ãšã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦ä½œæ¥­ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚

---

### ğŸ”¹ é‹ç”¨ãƒ«ãƒ¼ãƒ«æ¦‚è¦

1. `main` ãƒ–ãƒ©ãƒ³ãƒã¯å¸¸ã«å®‰å®šã—ãŸçŠ¶æ…‹ã‚’ä¿ã¡ã¾ã™ï¼ˆãƒªãƒªãƒ¼ã‚¹å¯èƒ½ãªçŠ¶æ…‹ï¼‰ã€‚
2. é–‹ç™ºä½œæ¥­ã¯ã™ã¹ã¦ **`feature/xxx` ãƒ–ãƒ©ãƒ³ãƒ** ã§è¡Œã£ã¦ãã ã•ã„ã€‚
3. ä½œæ¥­ãŒå®Œäº†ã—ãŸã‚‰ã€GitHubä¸Šã§ Pull Requestï¼ˆPRï¼‰ã‚’ä½œæˆã—ã€å·®åˆ†ã‚’ç¢ºèªã—ãŸä¸Šã§ `main` ã«ãƒãƒ¼ã‚¸ã—ã¦ãã ã•ã„ã€‚
4. **1äººé–‹ç™ºã®å ´åˆã§ã‚‚ã€å¿…ãšPRã‚’çµŒç”±ã—ã¦ `main` ã«ãƒãƒ¼ã‚¸ã—ã¦ãã ã•ã„**ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ä¸è¦ã€è‡ªåˆ†ã§ç¢ºèªï¼†ãƒãƒ¼ã‚¸OKï¼‰ã€‚

---

### ğŸ”§ ãƒ–ãƒ©ãƒ³ãƒé‹ç”¨ã®æ‰‹é †

#### 1. `main` ã‚’æœ€æ–°åŒ–ã—ã¦ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
```bash
git checkout main
git pull origin main
git checkout -b feature/æ©Ÿèƒ½å
```

#### 2. ä½œæ¥­å†…å®¹ã‚’ã‚³ãƒŸãƒƒãƒˆ
```bash
git add .
git commit -m "å¤‰æ›´å†…å®¹ã®èª¬æ˜"
```

#### 3. ãƒªãƒ¢ãƒ¼ãƒˆã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦PRä½œæˆ
```bash
git push origin feature/æ©Ÿèƒ½å
# GitHubä¸Šã§Pull Requestã‚’ä½œæˆ
```

## æ›´æ–°å±¥æ­´

æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³: **v9.31.0** (2025-10-04)

### v9.31.0 (2025-10-04)
- **ãƒ¡ãƒ¼ãƒ«ç¢ºèªã®ç„¡åŠ¹åŒ–**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“æœ€é©åŒ–ã®ãŸã‚ã€ä¼šå“¡ç™»éŒ²æ™‚ã®ãƒ¡ãƒ¼ãƒ«ç¢ºèªã‚’å»ƒæ­¢
- **è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½**: ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æˆåŠŸå¾Œã€ãƒ¡ãƒ¼ãƒ«ç¢ºèªçŠ¶æ…‹ã«é–¢ä¿‚ãªãè‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³
  - `UserAccountManager.performSignIn()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ï¼ˆasync/awaitå¯¾å¿œï¼‰
  - `signUp()` ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰è‡ªå‹•çš„ã« `performSignIn()` ã‚’å‘¼ã³å‡ºã—
- **ç”»é¢é·ç§»ã®æ”¹å–„**:
  - SignUpView/LoginViewã§ã® `isAuthenticated` å¤‰åŒ–ã®æ¤œçŸ¥ã‚’å¼·åŒ–
  - ä¼šå“¡ç™»éŒ²å¾Œã€å³åº§ã«ãƒ¡ã‚¤ãƒ³ç”»é¢ã¸é·ç§»
  - SignUpSuccessViewï¼ˆãƒ¡ãƒ¼ãƒ«æ¡ˆå†…ç”»é¢ï¼‰ã®è¡¨ç¤ºã‚’ç„¡åŠ¹åŒ–
- **Supabaseè¨­å®š**: Authentication â†’ Providers â†’ Email â†’ Confirm email ã‚’ OFF ã«å¤‰æ›´
- **UXå‘ä¸Š**: ã€Œç™»éŒ²â†’å³åˆ©ç”¨é–‹å§‹ã€ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªä½“é¨“ã‚’å®Ÿç¾

### v9.30.0 (2025-10-02)
- ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½ã‚’è¿½åŠ 
- SignUpViewã¨SignUpSuccessViewã‚’å®Ÿè£…
- UserAccountManagerã«ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤æ©Ÿèƒ½ã‚’è¿½åŠ 

### v9.29.0 (2025-10-02)
- **ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†ã®å¤§å¹…ç°¡ç´ åŒ–**: ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ã¨ã®ç´ä»˜ã‘ã‚’å®Œå…¨å»ƒæ­¢
  - `localDeviceIdentifier`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‰Šé™¤
  - `isDeviceRegistered`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‰Šé™¤
  - ãƒ‡ãƒã‚¤ã‚¹é€£æºã‚¢ãƒ©ãƒ¼ãƒˆã‚’å‰Šé™¤
  - éŒ²éŸ³é–‹å§‹æ™‚ã®ãƒã‚§ãƒƒã‚¯ã‚’`selectedDeviceID`ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´
- **ç–çµåˆè¨­è¨ˆã®å®Ÿç¾**: ã©ã®iPhoneã‹ã‚‰ã§ã‚‚åŒã˜ãƒ‡ãƒã‚¤ã‚¹IDã‚’é¸æŠã—ã¦ä½¿ç”¨å¯èƒ½
- **ãƒãƒ³ãƒ‰ãƒ«IDå¤‰æ›´å¯¾å¿œ**: UserDefaultsã«ä¾å­˜ã—ãªã„è¨­è¨ˆã«ã‚ˆã‚Šã€ãƒãƒ³ãƒ‰ãƒ«IDå¤‰æ›´ã‚„ã‚¢ãƒ—ãƒªå†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å½±éŸ¿ã‚’å—ã‘ãªã„
- **ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š**: ãƒ‡ãƒã‚¤ã‚¹IDã¯ã€Œãƒ‡ãƒ¼ã‚¿ã®å…¥ã‚Œç‰©ã€ã¨ã—ã¦æ©Ÿèƒ½

### v9.28.0 (2025-09-22)
- **Lambdaé€£æºã®æ”¹å–„**: iPhoneãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å‰Šé™¤ã—ã€ç´”ç²‹ãªdevice_idã‚’ä½¿ç”¨
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†å¯¾å¿œ**: ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒå³åº§ã«å‡¦ç†ã•ã‚Œã‚‹ã‚ˆã†ã«æ”¹å–„
- NetworkManager.swiftã‹ã‚‰iphone_ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ä¸å‡¦ç†ã‚’å‰Šé™¤

è©³ç´°ãªæ›´æ–°å±¥æ­´ã¯ [`CHANGELOG.md`](./CHANGELOG.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ã®é‡è¦äº‹é …

### âœ… å®Ÿæ–½æ¸ˆã¿ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

1. **HTTPSé€šä¿¡ã®å¼·åˆ¶**ï¼ˆ2025-08-16å®Œäº†ï¼‰
   - ã™ã¹ã¦ã®APIé€šä¿¡ãŒHTTPSçµŒç”±ã«ç§»è¡Œ
   - Info.plistã®ATSä¾‹å¤–è¨­å®šï¼ˆ`NSAllowsArbitraryLoads`ï¼‰ã‚’å‰Šé™¤
   - ä¸­é–“è€…æ”»æ’ƒã®ãƒªã‚¹ã‚¯ã‚’æ’é™¤

2. **UUIDæ­£è¦åŒ–**
   - ã‚¢ãƒã‚¿ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã«UUIDã‚’å°æ–‡å­—ã«çµ±ä¸€
   - S3ãƒ‘ã‚¹ã®ä¸€è²«æ€§ã‚’ä¿è¨¼

### âš ï¸ æœªå¯¾å¿œã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ï¼ˆè¦å¯¾å¿œï¼‰

#### ğŸ”´ Avatar Uploader APIã®èªè¨¼æ©Ÿèƒ½ãŒç„¡åŠ¹åŒ–ä¸­

**ç¾åœ¨ã®å•é¡Œï¼š**
- Avatar Uploader APIï¼ˆ`https://api.hey-watch.me/avatar/`ï¼‰ãŒèªè¨¼ãªã—ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- æ‚ªæ„ã®ã‚ã‚‹ç¬¬ä¸‰è€…ãŒä»–äººã®ã‚¢ãƒã‚¿ãƒ¼ã‚’è‡ªç”±ã«å¤‰æ›´å¯èƒ½
- user_idã‚’çŸ¥ã£ã¦ã„ã‚Œã°èª°ã§ã‚‚ã‚¢ãƒã‚¿ãƒ¼ã‚’ä¸Šæ›¸ãã§ãã‚‹

**å¿…è¦ãªå¯¾å¿œï¼š**
1. Avatar Uploader APIã®`app.py`ã§èªè¨¼å‡¦ç†ã‚’æœ‰åŠ¹åŒ–
2. Supabase JWTãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ã‚’å®Ÿè£…
3. user_idã¨ãƒˆãƒ¼ã‚¯ãƒ³ã®æ‰€æœ‰è€…ãŒä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

**iOSå´ã§å®Ÿè£…æ¸ˆã¿ã®èªè¨¼ã‚³ãƒ¼ãƒ‰ï¼š**
```swift
// AWSManager.swiftï¼ˆ72-74è¡Œç›®ï¼‰
if let token = authToken {
    request.setValue("Bearer \(token)", forHTTPHeaderField: "Authorization")
}

// UserInfoView.swiftï¼ˆ188-189è¡Œç›®ï¼‰
let authToken = authManager.getAccessToken()  // ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—æ¸ˆã¿
```

**APIå´ã§å¿…è¦ãªå®Ÿè£…ï¼š**
è©³ç´°ã¯[Avatar Uploader APIã®README](../projects/watchme/api/avatar-uploader/README.md)ã‚’å‚ç…§

### ğŸ“‹ æœ¬ç•ªç’°å¢ƒç§»è¡Œå‰ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] ã™ã¹ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’HTTPSåŒ–
- [x] Info.plistã®ATSä¾‹å¤–è¨­å®šã‚’å‰Šé™¤
- [x] ã‚¢ãƒ—ãƒªå´ã§èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’é€ä¿¡
- [ ] **Avatar Uploader APIã®èªè¨¼æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–**ï¼ˆæœªå¯¾å¿œï¼‰
- [ ] APIã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’å®Ÿè£…ï¼ˆæ¨å¥¨ï¼‰
- [ ] CloudFront CDNã®è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### ğŸš¨ é‡è¦ãªæ³¨æ„

**ç¾åœ¨ã®Avatar Uploader APIã¯é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨ã®è¨­å®šã§ã™ã€‚**
æœ¬ç•ªç’°å¢ƒã§ä½¿ç”¨ã™ã‚‹å‰ã«ã€å¿…ãšèªè¨¼æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„ã€‚

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ãƒ—ãƒ­ãƒ—ãƒ©ã‚¤ã‚¨ã‚¿ãƒª