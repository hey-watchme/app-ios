# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆ·æ–°è¨ˆç”»

æœ€çµ‚æ›´æ–°: 2025-12-06 10:45

> **ğŸš¨ é‡è¦ãªèªè­˜**
>
> ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€å€‹åˆ¥ã®ç—‡çŠ¶ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ•ãƒªãƒ¼ã‚ºã€ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºã®ä¸å®‰å®šæ€§ã€ç”»é¢é·ç§»ã®é…å»¶ï¼‰ã‚’åˆ—æŒ™ã™ã‚‹ã ã‘ã§ãªãã€**ãã‚Œã‚‰ã®æ ¹æœ¬åŸå› ã§ã‚ã‚‹æ§‹é€ çš„å•é¡Œ**ã‚’æ˜ã‚‰ã‹ã«ã—ã€**ã‚ã‚‹ã¹ãå§¿ã¸ã®ç§»è¡Œè¨ˆç”»**ã‚’ç¤ºã—ã¾ã™ã€‚
>
> **ãƒ‘ãƒƒãƒå¯¾å¿œã§ã¯è§£æ±ºã—ã¾ã›ã‚“ã€‚** æ§‹é€ æ”¹é©ãŒå¿…è¦ã§ã™ã€‚

---

## ğŸ“Š ç¾çŠ¶ã®å•é¡Œãƒãƒƒãƒ—

### ç—‡çŠ¶ãƒ¬ãƒ™ãƒ«ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½“æ„Ÿã™ã‚‹å•é¡Œï¼‰

| ç—‡çŠ¶ | æ·±åˆ»åº¦ | ç™ºç”Ÿé »åº¦ | ãƒ¦ãƒ¼ã‚¶ãƒ¼å½±éŸ¿ |
|-----|--------|---------|------------|
| ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ãƒ•ãƒªãƒ¼ã‚ºï¼ˆ30ç§’ï¼‰ | ğŸ”´ è‡´å‘½çš„ | å¸¸æ™‚ | ã‚¢ãƒ—ãƒªãŒä½¿ãˆãªã„ |
| ç”»é¢é·ç§»æ™‚ã®Hangï¼ˆ5-20ç§’ï¼‰ | ğŸ”´ è‡´å‘½çš„ | å¸¸æ™‚ | ã‚¹ãƒˆãƒ¬ã‚¹ãƒ•ãƒ« |
| ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã®ä¸å®‰å®šãªè¡¨ç¤º | ğŸŸ  æ·±åˆ» | é–“æ¬ çš„ | ä¿¡é ¼æ€§ã®æ¬ å¦‚ |
| ãƒ‡ãƒ¼ã‚¿å†å–å¾—ã®ç„¡é§„ | ğŸŸ¡ ä¸­ç¨‹åº¦ | å¸¸æ™‚ | ãƒãƒƒãƒ†ãƒªãƒ¼ãƒ»é€šä¿¡é‡ã®ç„¡é§„ |
| è‡ªå‹•ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ¶ç´„ã®ç«¶åˆ | ğŸŸ¢ è»½å¾® | å¸¸æ™‚ | UIã®ã¡ã‚‰ã¤ã |

### æ ¹æœ¬åŸå› ãƒ¬ãƒ™ãƒ«ï¼ˆæŠ€è¡“çš„è² å‚µï¼‰

| æ§‹é€ å•é¡Œ | å½±éŸ¿ã™ã‚‹ç—‡çŠ¶ | æ·±åˆ»åº¦ | ä¿®æ­£é›£æ˜“åº¦ |
|---------|------------|--------|-----------|
| **ãƒ‡ãƒ¼ã‚¿ã®æ‰€æœ‰æ¨©ãŒä¸æ˜ç¢ºï¼ˆSSOTæ¬ å¦‚ï¼‰** | ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºã€ãƒ‡ãƒ¼ã‚¿å†å–å¾— | ğŸ”´ æœ€é‡è¦ | ğŸ”¥ğŸ”¥ğŸ”¥ é«˜ |
| **éåŒæœŸå‡¦ç†ã®åˆ¶å¾¡ä¸è¶³** | ç”»é¢é·ç§»Hangã€ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤º | ğŸ”´ æœ€é‡è¦ | ğŸ”¥ğŸ”¥ ä¸­ |
| **NotificationCenterã®èª¤ç”¨** | ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºã€ãƒ‡ãƒ¼ã‚¿åŒæœŸ | ğŸŸ  é‡è¦ | ğŸ”¥ ä½ |
| **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®æ¬ é™¥** | ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºã€ãƒ‡ãƒ¼ã‚¿å†å–å¾— | ğŸŸ  é‡è¦ | ğŸ”¥ğŸ”¥ ä¸­ |
| **å¾ªç’°ä¾å­˜ï¼ˆManageré–“ï¼‰** | å…¨èˆ¬ | ğŸŸ  é‡è¦ | ğŸ”¥ğŸ”¥ğŸ”¥ é«˜ |
| **éå‰°ãª@Publishedæ›´æ–°** | ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ•ãƒªãƒ¼ã‚ºã€Hang | ğŸŸ¡ ä¸­ç¨‹åº¦ | ğŸ”¥ ä½ |
| **ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®éå‰°å‡ºåŠ›** | å…¨èˆ¬ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ | ğŸŸ¢ è»½å¾® | ğŸ”¥ ä½ |

**é‡è¦ãªæ´å¯Ÿ**:
- **ç—‡çŠ¶ã¯7ã¤ã€æ ¹æœ¬åŸå› ã¯7ã¤**
- **1ã¤ã®æ ¹æœ¬åŸå› ãŒè¤‡æ•°ã®ç—‡çŠ¶ã‚’å¼•ãèµ·ã“ã—ã¦ã„ã‚‹**
- **å€‹åˆ¥å¯¾å¿œã§ã¯è§£æ±ºã—ãªã„ï¼ˆã“ã‚Œã¾ã§ã®è©¦è¡ŒéŒ¯èª¤ãŒè¨¼æ˜ï¼‰**

---

## ğŸ” æ ¹æœ¬åŸå› ã®è©³ç´°åˆ†æ

### 1. ãƒ‡ãƒ¼ã‚¿ã®æ‰€æœ‰æ¨©ãŒä¸æ˜ç¢ºï¼ˆSSOTæ¬ å¦‚ï¼‰ ğŸ”´

#### ç¾çŠ¶ã®å•é¡Œ

**Subject.avatarUrlãŒå­˜åœ¨ã™ã‚‹å ´æ‰€**:
```
1. DeviceManager.devices[].subject.avatarUrl     â† JOIN queryã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥
2. DeviceManager.selectedSubject.avatarUrl       â† æ´¾ç”Ÿã‚³ãƒ”ãƒ¼
3. DashboardData.subject.avatarUrl               â† SupabaseDataManagerãŒç‹¬è‡ªå–å¾—
```

**ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³ï¼ˆç¾çŠ¶ï¼‰**:
```
Database (Supabase)
    â†“ JOIN query
DeviceManager.devices[].subject  â† ã‚³ãƒ”ãƒ¼ #1
    â†“ didSet
DeviceManager.selectedSubject    â† ã‚³ãƒ”ãƒ¼ #2ï¼ˆæ´¾ç”Ÿï¼‰
    â†“ æ‰‹å‹•å‚ç…§
SupabaseDataManagerèª­ã¿å–ã‚Š      â† ã‚³ãƒ”ãƒ¼ #2ã‚’å‚ç…§
    â†“ ç‹¬è‡ªå–å¾—ã‚‚å¯èƒ½
DashboardData.subject            â† ã‚³ãƒ”ãƒ¼ #3ï¼ˆç‹¬ç«‹ï¼‰
```

**å•é¡Œç‚¹**:
- **èª°ãŒæœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ã‚‹ã‹ä¸æ˜**
- **æ›´æ–°æ™‚ã«3ç®‡æ‰€ã™ã¹ã¦ã‚’åŒæœŸã™ã‚‹ä»•çµ„ã¿ãŒãªã„**
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–° â‰  ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿æ›´æ–°**

**å®Ÿéš›ã«èµ·ãã‚‹ã“ã¨**:
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒã‚¿ãƒ¼ã‚’æ›´æ–°
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯æ›´æ–°ã•ã‚Œã‚‹
3. ã—ã‹ã—ã€DeviceManager.selectedSubjectã¯å¤ã„ã¾ã¾
4. HeaderViewã¯å¤ã„URLã‚’å‚ç…§
5. ã‚¢ãƒã‚¿ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„ â† ç—‡çŠ¶ç™ºç”Ÿ
```

#### ã‚ã‚‹ã¹ãå§¿

**SSOTï¼ˆSingle Source of Truthï¼‰ã®ç¢ºç«‹**:
```
Database (Supabase)              â† çµ¶å¯¾çš„ãªSSOT
    â†“ Repository
SubjectRepository.current        â† ã‚¢ãƒ—ãƒªå†…ã®SSOTï¼ˆ1ç®‡æ‰€ã®ã¿ï¼‰
    â†“ @Published
ã™ã¹ã¦ã®View                     â† è¦³å¯Ÿï¼ˆã‚³ãƒ”ãƒ¼ã‚’æŒãŸãªã„ï¼‰
```

**åŸå‰‡**:
- **ãƒ‡ãƒ¼ã‚¿ã¯1ç®‡æ‰€ã«ã®ã¿å­˜åœ¨**
- **ä»–ã¯ã™ã¹ã¦å‚ç…§**
- **æ›´æ–°ã¯ã‚¢ãƒˆãƒŸãƒƒã‚¯ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ + ãƒ­ãƒ¼ã‚«ãƒ«åŒæ™‚æ›´æ–°ï¼‰**

---

### 2. éåŒæœŸå‡¦ç†ã®åˆ¶å¾¡ä¸è¶³ ğŸ”´

#### ç¾çŠ¶ã®å•é¡Œ

**ã‚¿ã‚¤ãƒŸãƒ³ã‚°å›³**:
```
æ™‚åˆ»    å‡¦ç†                                  selectedSubject    HeaderView
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0ms     ã‚¢ãƒ—ãƒªèµ·å‹•
100ms   HeaderViewæç”»                        nil                âŒ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
700ms   initializeDevices()é–‹å§‹               nil
1200ms  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å–å¾—å®Œäº†                   nil
1250ms  state = .available(devices)           nil â† ã¾ã nil
1260ms  determineSelectedDevice()             Subject â† è¨­å®š
1300ms  HeaderViewå†æç”»                      Subject            âœ… è¡¨ç¤º
```

**å•é¡Œç‚¹**:
- **UIãŒå…ˆã€ãƒ‡ãƒ¼ã‚¿ãŒå¾Œ** â†’ ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³
- **didSetã®ãƒã‚§ãƒ¼ãƒ³** â†’ å®Ÿè¡Œé †åºãŒä¿è¨¼ã•ã‚Œãªã„
- **é€šçŸ¥ãƒ™ãƒ¼ã‚¹ã®åŒæœŸ** â†’ ãƒ‡ãƒ¼ã‚¿æº–å‚™å®Œäº†ã‚’å¾…ãŸãšã«é€šçŸ¥

#### ã‚ã‚‹ã¹ãå§¿

**ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**:
```swift
@MainActor
func loadSubject(id: String) async {
    // 1. ãƒ‡ãƒ¼ã‚¿å–å¾—
    let subject = try await repository.fetch(id)

    // 2. ãƒ­ãƒ¼ã‚«ãƒ«æ›´æ–°ï¼ˆåŒæœŸçš„ï¼‰
    self.current = subject

    // 3. SwiftUIãŒè‡ªå‹•çš„ã«å†æç”»ï¼ˆ@Publishedã«ã‚ˆã‚Šï¼‰
}
```

**åŸå‰‡**:
- **async/awaitã§é †åºã‚’åˆ¶å¾¡**
- **@MainActorã§ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè¡Œã‚’ä¿è¨¼**
- **@Publishedã§è‡ªå‹•çš„ã«UIæ›´æ–°ï¼ˆé€šçŸ¥ä¸è¦ï¼‰**

---

### 3. NotificationCenterã®èª¤ç”¨ ğŸŸ 

#### ç¾çŠ¶ã®å•é¡Œ

**é€šçŸ¥ã®ä½¿ã‚ã‚Œæ–¹**:
```swift
// DeviceManager.swift
NotificationCenter.post("SubjectUpdated")

// AvatarView.swift
.onReceive("SubjectUpdated") { reload() }
.onReceive("AvatarUpdated") { reload() }
```

**å•é¡Œç‚¹**:
1. **å‘½ä»¤çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**ï¼ˆSwiftUIã¯å®£è¨€çš„ã§ã‚ã‚‹ã¹ãï¼‰
2. **ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ãŒä¿è¨¼ã•ã‚Œãªã„**ï¼ˆé€šçŸ¥ãŒå…ˆã€ãƒ‡ãƒ¼ã‚¿ãŒå¾Œã®å¯èƒ½æ€§ï¼‰
3. **é‡è¤‡å®Ÿè¡Œ**ï¼ˆSubjectUpdated + AvatarUpdatedï¼‰
4. **ãƒ‡ãƒãƒƒã‚°å›°é›£**ï¼ˆé€šçŸ¥ã®é€ä¿¡å…ƒãƒ»ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒè¿½è·¡ä¸å¯ï¼‰

#### ã‚ã‚‹ã¹ãå§¿

**SwiftUIã®è¦³å¯Ÿãƒ‘ã‚¿ãƒ¼ãƒ³**:
```swift
// ViewModel
@Published var currentSubject: Subject?

// View
@ObservedObject var viewModel: SubjectViewModel
// currentSubjectãŒå¤‰ã‚ã‚Œã°UIã¯è‡ªå‹•æ›´æ–°ï¼ˆé€šçŸ¥ä¸è¦ï¼‰
```

**åŸå‰‡**:
- **NotificationCenterã¯åŸå‰‡ä½¿ç”¨ç¦æ­¢**
- **@Publishedã«ã‚ˆã‚‹å®£è¨€çš„ãªæ›´æ–°**
- **ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ = UIæ›´æ–°ï¼ˆè‡ªå‹•ï¼‰**

---

### 4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®æ¬ é™¥ ğŸŸ 

#### ç¾çŠ¶ã®å•é¡Œ

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```swift
let timestamp = Int(Date().timeIntervalSince1970)
let url = "\(avatarUrl)?t=\(timestamp)"  // â† æ¯å›ç•°ãªã‚‹URL
```

**çµæœ**:
- **NSCacheãŒç„¡æ„å‘³**ï¼ˆã‚­ãƒ¼ãŒæ¯å›é•ã†ï¼‰
- **æ¯å›ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ï¼ˆå¸¯åŸŸå¹…ã®ç„¡é§„ï¼‰
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ‚ªåŒ–**

**ãªãœã“ã†ãªã£ãŸã®ã‹**:
- ã‚¢ãƒã‚¿ãƒ¼ãŒæ›´æ–°ã•ã‚Œãªã„ â†’ å¼·åˆ¶ãƒªãƒ­ãƒ¼ãƒ‰ã—ãŸã„ â†’ ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—è¿½åŠ ï¼ˆãƒ‘ãƒƒãƒï¼‰

#### ã‚ã‚‹ã¹ãå§¿

**ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼**:
```swift
class ImageCacheManager {
    func get(entityType: String, entityId: String, imageType: String) -> UIImage? {
        let key = "\(entityType)_\(entityId)_\(imageType)"
        // ä¾‹: "subject_12345_avatar"
        return cache.object(forKey: key as NSString)
    }

    func invalidate(entityType: String, entityId: String, imageType: String) {
        let key = "\(entityType)_\(entityId)_\(imageType)"
        cache.removeObject(forKey: key as NSString)
    }
}
```

**ä½¿ã„æ–¹**:
```swift
// ã‚¢ãƒã‚¿ãƒ¼æ›´æ–°æ™‚ã®ã¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
await updateAvatar(image)
imageCache.invalidate(entityType: "subject", entityId: subjectId, imageType: "avatar")
```

**åŸå‰‡**:
- **æ„å‘³ã®ã‚ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼**
- **æ˜ç¤ºçš„ãªç„¡åŠ¹åŒ–**
- **ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯ä½¿ã‚ãªã„**

---

### 5. å¾ªç’°ä¾å­˜ï¼ˆManageré–“ï¼‰ ğŸŸ 

#### ç¾çŠ¶ã®å•é¡Œ

**ä¾å­˜é–¢ä¿‚å›³**:
```
DeviceManager
  â”œâ”€ Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç›´æ¥ä½¿ç”¨
  â”œâ”€ ãƒ‡ãƒã‚¤ã‚¹å–å¾—
  â”œâ”€ Subjectå–å¾—ï¼ˆJOINã§ï¼‰
  â””â”€ Subjectä¿æŒï¼ˆselectedSubjectï¼‰
       â†“ å‚ç…§
SupabaseDataManager
  â”œâ”€ DeviceManagerã¸ã®å‚ç…§ã‚’æŒã¤
  â”œâ”€ DeviceManager.selectedSubjectã‚’èª­ã‚€ â† ğŸ”´ å¾ªç’°
  â””â”€ ç‹¬è‡ªã«Subjectã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚ â† ğŸ”´ é‡è¤‡
```

**å•é¡Œç‚¹**:
- **è²¬å‹™ãŒä¸æ˜ç¢º**
- **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ãŒè¿½è·¡å›°é›£**
- **ãƒ†ã‚¹ãƒˆãŒä¸å¯èƒ½**

#### ã‚ã‚‹ã¹ãå§¿ï¼ˆææ¡ˆA: Repositoryåˆ†é›¢ï¼‰

```
SubjectRepository      â† Subject CRUDã®ã¿
DeviceRepository       â† Device CRUDã®ã¿
DashboardRepository    â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ã¿

SubjectViewModel       â† Subjectã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
DeviceViewModel        â† Deviceã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

Views                  â† ViewModelã‚’è¦³å¯Ÿ
```

#### ã‚ã‚‹ã¹ãå§¿ï¼ˆææ¡ˆB: DeviceManagerã«çµ±åˆï¼‰

```
DeviceManager
  â”œâ”€ Deviceç®¡ç†
  â”œâ”€ Subjectç®¡ç†ï¼ˆã™ã¹ã¦ï¼‰
  â””â”€ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾—

Views â†’ DeviceManagerã‚’è¦³å¯Ÿ
```

**åŸå‰‡**:
- **å˜æ–¹å‘ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**
- **è²¬å‹™ã®æ˜ç¢ºãªåˆ†é›¢**
- **ä¾å­˜é–¢ä¿‚ã¯ä¸€æ–¹å‘ã®ã¿**

---

### 6. éå‰°ãª@Publishedæ›´æ–° ğŸŸ¡

#### ç¾çŠ¶ã®å•é¡Œ

**è¦³å¯Ÿã•ã‚ŒãŸç¾è±¡**:
```
Hang detected: 18.86s
Hang detected: 7.16s
Hang detected: 9.70s
```

**åŸå› ã®æ¨æ¸¬**:
- **@Publishedãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®é »ç¹ãªæ›´æ–°**
- **computed propertyã®è¨ˆç®—ã‚³ã‚¹ãƒˆ**
- **Viewéšå±¤å…¨ä½“ã®å†æç”»**

#### ã‚ã‚‹ã¹ã„å§¿

**æ›´æ–°ã®æœ€å°åŒ–**:
```swift
// BEFORE: æ¯å›æ›´æ–°
@Published var devices: [Device] = []

// AFTER: å¤‰æ›´ãŒã‚ã‚‹æ™‚ã®ã¿æ›´æ–°
private var _devices: [Device] = []
@Published var devices: [Device] = [] {
    willSet {
        guard newValue != _devices else { return }  // å¤‰æ›´ãªã—ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—
        _devices = newValue
    }
}
```

**åŸå‰‡**:
- **Equatableã®å®Ÿè£…**
- **å¤‰æ›´æ¤œçŸ¥ã®æœ€é©åŒ–**
- **å¿…è¦æœ€å°é™ã®å†æç”»**

---

### 7. ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®éå‰°å‡ºåŠ› ğŸŸ¢

#### ç¾çŠ¶ã®å•é¡Œ

- ã‚¢ãƒ—ãƒªèµ·å‹•ã‹ã‚‰çŸ­æ™‚é–“ã§**340è¡Œä»¥ä¸Š**ã®ãƒ­ã‚°
- ãƒ­ã‚°å‡ºåŠ›è‡ªä½“ãŒãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å½±éŸ¿

#### ã‚ã‚‹ã¹ãå§¿

**ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®å°å…¥**:
```swift
enum LogLevel {
    case verbose, info, warning, error
}

func log(_ message: String, level: LogLevel = .info) {
    #if DEBUG
    guard level >= .info else { return }  // Verboseã¯é€šå¸¸éè¡¨ç¤º
    print("[\(level)] \(message)")
    #endif
}
```

**åŸå‰‡**:
- **Releaseãƒ“ãƒ«ãƒ‰ã§ã¯ãƒ­ã‚°å®Œå…¨ç„¡åŠ¹åŒ–**
- **Debugãƒ“ãƒ«ãƒ‰ã§ã‚‚ãƒ¬ãƒ™ãƒ«åˆ¶å¾¡**
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬æ™‚ã¯ãƒ­ã‚°OFF**

---

## ğŸ¯ æ§‹é€ æ”¹é©ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### é€²ã‚æ–¹ã®é¸æŠè‚¢

#### é¸æŠè‚¢A: æ®µéšçš„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆæ¨å¥¨ï¼‰

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ãƒªã‚¹ã‚¯ãŒä½ã„
- å„æ®µéšã§ãƒ†ã‚¹ãƒˆå¯èƒ½
- æ—¢å­˜æ©Ÿèƒ½ã‚’å£Šã•ãªã„

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- æ™‚é–“ãŒã‹ã‹ã‚‹ï¼ˆ2-3ãƒ¶æœˆï¼‰
- ä¸­é€”åŠç«¯ãªçŠ¶æ…‹ãŒç¶šã

**ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**:
```
Phase 0: æº–å‚™         ï¼ˆ1é€±é–“ï¼‰  â† ä»Šã“ã“
Phase 1: åŸºç›¤æ•´å‚™     ï¼ˆ2é€±é–“ï¼‰
Phase 2: ãƒ‡ãƒ¼ã‚¿å±¤åˆ·æ–° ï¼ˆ3é€±é–“ï¼‰
Phase 3: UIå±¤åˆ·æ–°     ï¼ˆ3é€±é–“ï¼‰
Phase 4: æœ€é©åŒ–       ï¼ˆ2é€±é–“ï¼‰
Phase 5: æ¤œè¨¼         ï¼ˆ1é€±é–“ï¼‰
```

#### é¸æŠè‚¢B: ä¸€æ°—ã«ãƒªãƒ©ã‚¤ãƒˆ

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ã‚¯ãƒªãƒ¼ãƒ³ãªè¨­è¨ˆ
- æŠ€è¡“çš„è² å‚µã‚¼ãƒ­

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- é«˜ãƒªã‚¹ã‚¯
- æ—¢å­˜æ©Ÿèƒ½ã®ä¸€æ™‚åœæ­¢
- ãƒã‚°ã®æ··å…¥ãƒªã‚¹ã‚¯

**æ¨å¥¨ã—ãªã„ç†ç”±**:
- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å½±éŸ¿ãŒå¤§ãã„
- ãƒ†ã‚¹ãƒˆãŒå›°é›£
- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒä¸å¯èƒ½

---

### ğŸš€ Phase 0: æº–å‚™ï¼ˆ1é€±é–“ï¼‰

**ç›®çš„**: ç¾çŠ¶æŠŠæ¡ã¨æ–¹é‡æ±ºå®š

#### ã‚¿ã‚¹ã‚¯

- [x] ç¾çŠ¶ã®å•é¡Œã‚’æ–‡æ›¸åŒ–ï¼ˆã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
- [ ] Instrumentsã§è©³ç´°ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°å®Ÿæ–½
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³ã®ä½œæˆï¼ˆç¾çŠ¶ vs ã‚ã‚‹ã¹ãå§¿ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¢ºèªï¼ˆæ—¢å­˜æ©Ÿèƒ½ã®ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³é˜²æ­¢ï¼‰
- [ ] ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«å°å…¥ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬ã®ãŸã‚ï¼‰

#### æˆæœç‰©

- [ ] `ARCHITECTURE.md`: ç¾çŠ¶ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³
- [ ] `REFACTORING_PLAN.md`: è©³ç´°ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»
- [ ] ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ãƒ¬ãƒãƒ¼ãƒˆ

---

### ğŸ”§ Phase 1: åŸºç›¤æ•´å‚™ï¼ˆ2é€±é–“ï¼‰

**ç›®çš„**: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®åœŸå°ã‚’ä½œã‚‹

#### 1.1 ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®æ”¹å–„

**å•é¡Œ**: ãƒ­ã‚°ã®éå‰°å‡ºåŠ›ãŒãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å½±éŸ¿

**å¯¾å¿œ**:
```swift
// Services/Logger.swift ã‚’æ–°è¦ä½œæˆ
enum Logger {
    static func verbose(_ message: String) { ... }
    static func info(_ message: String) { ... }
    static func warning(_ message: String) { ... }
    static func error(_ message: String) { ... }
}
```

**å½±éŸ¿ç¯„å›²**: å…¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆprintæ–‡ã‚’Loggerå‘¼ã³å‡ºã—ã«ç½®æ›ï¼‰

**ãƒªã‚¹ã‚¯**: ğŸŸ¢ ä½ï¼ˆæ—¢å­˜æ©Ÿèƒ½ã«å½±éŸ¿ãªã—ï¼‰

#### 1.2 ãƒ†ã‚¹ãƒˆã®æ•´å‚™

**å•é¡Œ**: ãƒ†ã‚¹ãƒˆãŒãªã„ â†’ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãŒæ€–ã„

**å¯¾å¿œ**:
- ä¸»è¦ãªManagerã‚¯ãƒ©ã‚¹ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ
- ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ãƒ¢ãƒƒã‚¯åŒ–
- UIè¡¨ç¤ºã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

**å½±éŸ¿ç¯„å›²**: ãƒ†ã‚¹ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

**ãƒªã‚¹ã‚¯**: ğŸŸ¢ ä½ï¼ˆæ—¢å­˜æ©Ÿèƒ½ã«å½±éŸ¿ãªã—ï¼‰

#### 1.3 NotificationCenterã®æ®µéšçš„å‰Šé™¤

**å•é¡Œ**: å‘½ä»¤çš„ãªé€šçŸ¥ãŒå®£è¨€çš„UIã‚’å¦¨ã’ã‚‹

**å¯¾å¿œ**:
1. ã™ã¹ã¦ã®é€šçŸ¥ã‚’åˆ—æŒ™
2. å„é€šçŸ¥ã‚’@Publishedã«ã‚ˆã‚‹è¦³å¯Ÿã«ç½®ãæ›ãˆ
3. é€šçŸ¥ã‚’å‰Šé™¤

**å½±éŸ¿ç¯„å›²**:
- `DeviceManager.swift`: SubjectUpdatedé€šçŸ¥å‰Šé™¤
- `AvatarView.swift`: onReceiveå‰Šé™¤
- `AvatarUploadViewModel.swift`: AvatarUpdatedé€šçŸ¥å‰Šé™¤

**ãƒªã‚¹ã‚¯**: ğŸŸ¡ ä¸­ï¼ˆæ…é‡ãªãƒ†ã‚¹ãƒˆãŒå¿…è¦ï¼‰

**ã‚¿ã‚¹ã‚¯**:
- [ ] é€šçŸ¥ã®ä½¿ç”¨ç®‡æ‰€ã‚’å…¨æ¤œç´¢
- [ ] å„é€šçŸ¥ã®ä»£æ›¿æ‰‹æ®µã‚’è¨­è¨ˆ
- [ ] æ®µéšçš„ã«ç½®ãæ›ãˆ
- [ ] å‹•ä½œç¢ºèª

---

### ğŸ—ï¸ Phase 2: ãƒ‡ãƒ¼ã‚¿å±¤åˆ·æ–°ï¼ˆ3é€±é–“ï¼‰

**ç›®çš„**: SSOTã‚’ç¢ºç«‹ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã‚’æ•´ç†

#### 2.1 Repositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã®å°å…¥

**å•é¡Œ**: ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãŒåˆ†æ•£ã—ã¦ã„ã‚‹

**å¯¾å¿œ**:
```swift
// Repositories/SubjectRepository.swift ã‚’æ–°è¦ä½œæˆ
protocol SubjectRepositoryProtocol {
    func fetch(id: String) async throws -> Subject
    func update(_ subject: Subject) async throws -> Subject
    func updateAvatar(subjectId: String, imageData: Data) async throws -> String
}

class SubjectRepository: SubjectRepositoryProtocol {
    private let supabase: SupabaseClient

    func fetch(id: String) async throws -> Subject {
        // Supabase APIã‚’ç›´æ¥å‘¼ã³å‡ºã—
    }

    func update(_ subject: Subject) async throws -> Subject {
        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–° â†’ æ›´æ–°å¾Œã®Subjectã‚’è¿”ã™ï¼ˆSSOTï¼‰
    }
}
```

**å½±éŸ¿ç¯„å›²**: æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ 

**ãƒªã‚¹ã‚¯**: ğŸŸ¢ ä½ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ãªã—ï¼‰

#### 2.2 SubjectViewModelã®ä½œæˆ

**å•é¡Œ**: DeviceManagerãŒSubjectã‚‚ç®¡ç†ã—ã¦ã„ã‚‹ï¼ˆè²¬å‹™ã®æ··åœ¨ï¼‰

**å¯¾å¿œ**:
```swift
// ViewModels/SubjectViewModel.swift ã‚’æ–°è¦ä½œæˆ
@MainActor
class SubjectViewModel: ObservableObject {
    @Published private(set) var current: Subject?
    private let repository: SubjectRepositoryProtocol
    private let imageCache: ImageCacheManager

    func load(id: String) async {
        current = try? await repository.fetch(id)
    }

    func updateAvatar(image: UIImage) async {
        guard let subject = current else { return }

        // 1. ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        let imageData = image.jpegData(compressionQuality: 0.8)!
        let url = try await repository.updateAvatar(
            subjectId: subject.subjectId,
            imageData: imageData
        )

        // 2. ãƒ­ãƒ¼ã‚«ãƒ«æ›´æ–°ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯ï¼‰
        var updated = subject
        updated.avatarUrl = url
        current = updated

        // 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–
        imageCache.invalidate(
            entityType: "subject",
            entityId: subject.subjectId,
            imageType: "avatar"
        )

        // âœ… é€šçŸ¥ä¸è¦ - @PublishedãŒè‡ªå‹•çš„ã«UIã‚’æ›´æ–°
    }
}
```

**å½±éŸ¿ç¯„å›²**: æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ 

**ãƒªã‚¹ã‚¯**: ğŸŸ¢ ä½ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ãªã—ï¼‰

#### 2.3 DeviceManagerã‹ã‚‰Subjectç®¡ç†ã‚’åˆ†é›¢

**å•é¡Œ**: DeviceManagerãŒSubjectã‚’ä¿æŒã—ã¦ã„ã‚‹

**å¯¾å¿œ**:
1. `DeviceManager.selectedSubject`ã‚’å‰Šé™¤
2. ä»£ã‚ã‚Šã«`DeviceManager.selectedSubjectId`ã®ã¿ä¿æŒ
3. SubjectViewModelãŒå®Ÿéš›ã®Subjectã‚’ä¿æŒ

```swift
// DeviceManager.swift (ä¿®æ­£)
class DeviceManager: ObservableObject {
    @Published var selectedSubjectId: String?  // â† IDã®ã¿
    // @Published var selectedSubject: Subject? â† å‰Šé™¤
}

// ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚
@StateObject var deviceManager = DeviceManager()
@StateObject var subjectViewModel = SubjectViewModel(repository: SubjectRepository())

// ãƒ‡ãƒã‚¤ã‚¹é¸æŠæ™‚
deviceManager.selectDevice(deviceId)
if let subjectId = deviceManager.selectedSubjectId {
    await subjectViewModel.load(id: subjectId)
}
```

**å½±éŸ¿ç¯„å›²**:
- `DeviceManager.swift`: å¤§å¹…ãªå¤‰æ›´
- ã™ã¹ã¦ã®View: `deviceManager.selectedSubject` â†’ `subjectViewModel.current`

**ãƒªã‚¹ã‚¯**: ğŸ”´ é«˜ï¼ˆæ…é‡ãªãƒ†ã‚¹ãƒˆãŒå¿…é ˆï¼‰

**ã‚¿ã‚¹ã‚¯**:
- [ ] SubjectViewModelã®å®Ÿè£…
- [ ] DeviceManagerã®ä¿®æ­£
- [ ] ã™ã¹ã¦ã®Viewã®ä¿®æ­£
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ

---

### ğŸ¨ Phase 3: UIå±¤åˆ·æ–°ï¼ˆ3é€±é–“ï¼‰

**ç›®çš„**: Viewã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã—UIæ›´æ–°ã‚’æœ€é©åŒ–

#### 3.1 AvatarViewã®ç°¡ç´ åŒ–

**å•é¡Œ**: AvatarViewãŒè¤‡é›‘ã™ãã‚‹

**å¯¾å¿œ**:
```swift
struct AvatarView: View {
    @EnvironmentObject var subjectViewModel: SubjectViewModel
    let size: CGFloat

    var body: some View {
        if let url = subjectViewModel.current?.avatarUrl {
            CachedAsyncImage(
                url: url,
                cacheKey: "subject_\(subjectViewModel.current!.subjectId)_avatar",
                size: size
            )
        } else {
            DefaultAvatarIcon(size: size)
        }
    }
}
```

**å½±éŸ¿ç¯„å›²**: `AvatarView.swift`

**ãƒªã‚¹ã‚¯**: ğŸŸ¡ ä¸­

#### 3.2 HeaderViewã®æœ€é©åŒ–

**å•é¡Œ**: HeaderViewãŒæ¯å›å†æç”»ã•ã‚Œã‚‹

**å¯¾å¿œ**:
```swift
struct HeaderView: View {
    @EnvironmentObject var subjectViewModel: SubjectViewModel

    var body: some View {
        if let subject = subjectViewModel.current {
            AvatarView(size: 32)
                .id(subject.subjectId)  // â† Subjectå¤‰æ›´æ™‚ã®ã¿å†æç”»
        }
    }
}
```

**å½±éŸ¿ç¯„å›²**: `HeaderView.swift`

**ãƒªã‚¹ã‚¯**: ğŸŸ¢ ä½

#### 3.3 SimpleDashboardViewã®æœ€é©åŒ–

**å•é¡Œ**: ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒæ¯å›å®Ÿè¡Œã•ã‚Œã‚‹

**å¯¾å¿œ**:
```swift
struct SimpleDashboardView: View {
    @EnvironmentObject var subjectViewModel: SubjectViewModel
    let date: Date

    var body: some View {
        // ...
    }
    .task(id: subjectViewModel.current?.subjectId) {
        // Subjectå¤‰æ›´æ™‚ã®ã¿ãƒ‡ãƒ¼ã‚¿å†å–å¾—
        await loadDashboardData()
    }
}
```

**å½±éŸ¿ç¯„å›²**: `SimpleDashboardView.swift`

**ãƒªã‚¹ã‚¯**: ğŸŸ¡ ä¸­

---

### âš¡ Phase 4: æœ€é©åŒ–ï¼ˆ2é€±é–“ï¼‰

**ç›®çš„**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€çµ‚èª¿æ•´

#### 4.1 ç”»åƒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ€é©åŒ–

**å¯¾å¿œ**:
```swift
class ImageCacheManager {
    private let cache = NSCache<NSString, UIImage>()
    private let diskCache = DiskCacheManager()  // â† æ°¸ç¶šåŒ–

    func get(entityType: String, entityId: String, imageType: String) async -> UIImage? {
        let key = "\(entityType)_\(entityId)_\(imageType)"

        // 1. ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª
        if let cached = cache.object(forKey: key as NSString) {
            return cached
        }

        // 2. ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª
        if let cached = await diskCache.load(key: key) {
            cache.setObject(cached, forKey: key as NSString)
            return cached
        }

        // 3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        let url = await fetchURL(entityType: entityType, entityId: entityId, imageType: imageType)
        let image = try? await downloadImage(from: url)

        if let image = image {
            cache.setObject(image, forKey: key as NSString)
            await diskCache.save(image, key: key)
        }

        return image
    }
}
```

**ãƒªã‚¹ã‚¯**: ğŸŸ¡ ä¸­

#### 4.2 ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ãƒãƒƒãƒå‡¦ç†åŒ–

**å•é¡Œ**: è¤‡æ•°ã®APIå‘¼ã³å‡ºã—ãŒé€æ¬¡çš„

**å¯¾å¿œ**:
```swift
// RPCé–¢æ•°ã®æ´»ç”¨
func fetchDashboardData(deviceId: String, date: Date) async throws -> DashboardData {
    // 1å›ã®RPCå‘¼ã³å‡ºã—ã§å…¨ãƒ‡ãƒ¼ã‚¿å–å¾—
    return try await supabase.rpc("get_dashboard_data", params: [...])
}
```

**ãƒªã‚¹ã‚¯**: ğŸŸ¡ ä¸­ï¼ˆRPCé–¢æ•°ã®å®Ÿè£…ãŒå¿…è¦ï¼‰

#### 4.3 @Publishedã®æ›´æ–°æœ€é©åŒ–

**å¯¾å¿œ**:
```swift
extension DeviceManager {
    func updateDevices(_ newDevices: [Device]) {
        // å¤‰æ›´ãŒãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
        guard devices != newDevices else { return }
        devices = newDevices
    }
}
```

**ãƒªã‚¹ã‚¯**: ğŸŸ¢ ä½

---

### âœ… Phase 5: æ¤œè¨¼ï¼ˆ1é€±é–“ï¼‰

**ç›®çš„**: æ”¹å–„åŠ¹æœã®æ¸¬å®šã¨ãƒã‚°ä¿®æ­£

#### ã‚¿ã‚¹ã‚¯

- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬ï¼ˆBefore/Afteræ¯”è¼ƒï¼‰
- [ ] å…¨æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
- [ ] ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿ã€ä½é€Ÿãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰
- [ ] ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ç¢ºèª
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆ

#### æˆæœç‰©

- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ
- [ ] ãƒã‚°ä¿®æ­£ãƒªã‚¹ãƒˆ
- [ ] ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„åŠ¹æœ

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™

| æ“ä½œ | ç¾çŠ¶ | ç›®æ¨™ | æ”¹å–„å¾Œäºˆæ¸¬ |
|-----|------|------|----------|
| ã‚¢ãƒ—ãƒªèµ·å‹• | 1.58ç§’ | <2ç§’ | 1.2ç§’ âœ… |
| ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ | 30ç§’ | <0.5ç§’ | 0.3ç§’ âœ… |
| ç”»é¢é·ç§»ï¼ˆãƒ›ãƒ¼ãƒ â†’è¦³æ¸¬å¯¾è±¡ï¼‰ | 7-18ç§’ | <1ç§’ | 0.5ç§’ âœ… |
| ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºï¼ˆåˆå›ï¼‰ | ä¸å®š | <1ç§’ | 0.8ç§’ âœ… |
| ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºï¼ˆ2å›ç›®ï¼‰ | ä¸å®š | <0.1ç§’ | 0ç§’ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰ âœ… |

### æŠ€è¡“çš„è² å‚µã®è§£æ¶ˆ

| æŒ‡æ¨™ | ç¾çŠ¶ | ç›®æ¨™ |
|-----|------|------|
| ãƒ‡ãƒ¼ã‚¿ã®ã‚³ãƒ”ãƒ¼æ•°ï¼ˆSubjectï¼‰ | 3ç®‡æ‰€ | 1ç®‡æ‰€ |
| NotificationCenterã®ä½¿ç”¨ç®‡æ‰€ | 5ç®‡æ‰€ | 0ç®‡æ‰€ |
| å¾ªç’°ä¾å­˜ | 2çµ„ | 0çµ„ |
| ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ | 0% | 70% |
| ã‚³ãƒ¼ãƒ‰ã®è¤‡é›‘åº¦ï¼ˆCyclomaticï¼‰ | 15+ | <10 |

---

## ğŸš§ ãƒªã‚¹ã‚¯ç®¡ç†

### é«˜ãƒªã‚¹ã‚¯é ˜åŸŸ

| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | ç™ºç”Ÿç¢ºç‡ | å¯¾ç­– |
|-------|--------|---------|------|
| Phase 2.3ã§ã®ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ | ğŸ”´ é«˜ | ğŸŸ  ä¸­ | æ®µéšçš„ç§»è¡Œã€è±Šå¯Œãªãƒ†ã‚¹ãƒˆ |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„åŠ¹æœãŒä¸ååˆ† | ğŸŸ  ä¸­ | ğŸŸ¢ ä½ | Instrumentsã§ã®äº‹å‰æ¤œè¨¼ |
| ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é…å»¶ | ğŸŸ¡ ä½ | ğŸŸ  ä¸­ | ãƒãƒƒãƒ•ã‚¡æœŸé–“ã®ç¢ºä¿ |

### ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»

å„Phaseã§ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã€å•é¡Œç™ºç”Ÿæ™‚ã¯å‰ã®Phaseã«æˆ»ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

```bash
main
  â”œâ”€ refactor/phase1
  â”œâ”€ refactor/phase2
  â”œâ”€ refactor/phase3
  â”œâ”€ refactor/phase4
  â””â”€ refactor/phase5
```

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [README.md](../../README.md): ã‚¢ãƒ—ãƒªå…¨ä½“ã®æ§‹æˆ
- [TECHNICAL.md](../technical/TECHNICAL.md): æŠ€è¡“ä»•æ§˜
- [TROUBLESHOOTING.md](../operations/TROUBLESHOOTING.md): ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

---

## ğŸ“š å‚è€ƒè³‡æ–™

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

- [Clean Architecture in SwiftUI](https://nalexn.github.io/clean-architecture-swiftui/)
- [MVVM in SwiftUI](https://www.hackingwithswift.com/books/ios-swiftui/introducing-mvvm-into-your-swiftui-project)
- [Repository Pattern in Swift](https://www.swiftbysundell.com/articles/repository-and-unit-of-work-pattern-in-swift/)

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

- [Apple - Improving Your App's Performance](https://developer.apple.com/documentation/xcode/improving-your-app-s-performance)
- [SwiftUI Performance Tips](https://www.swiftbysundell.com/articles/swiftui-performance-tips/)
- [Optimizing SwiftUI View Updates](https://www.hackingwithswift.com/books/ios-swiftui/optimizing-swiftui-view-updates)

### éåŒæœŸå‡¦ç†

- [Swift Concurrency by Example](https://www.hackingwithswift.com/quick-start/concurrency)
- [@MainActor and async/await](https://www.swiftbysundell.com/articles/the-mainactor-attribute/)

---

## ğŸ¯ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å³åº§ã«å®Ÿæ–½ï¼ˆä»Šæ—¥ï½æ˜æ—¥ï¼‰

- [ ] ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨æ‰¿èª
- [ ] Phase 0ã®ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆä½œæˆ
- [ ] Instrumentsã§ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°æº–å‚™

### 1é€±é–“ä»¥å†…

- [ ] Phase 0å®Œäº†
- [ ] Phase 1ã®è©³ç´°è¨ˆç”»
- [ ] é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒï¼‰

### ç›¸è«‡äº‹é …

1. **é€²ã‚æ–¹ã®é¸æŠ**: æ®µéšçš„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆæ¨å¥¨ï¼‰vs ä¸€æ°—ã«ãƒªãƒ©ã‚¤ãƒˆ
2. **å„ªå…ˆé †ä½**: ã©ã®ç—‡çŠ¶ã‹ã‚‰å¯¾å¿œã™ã‚‹ã‹ï¼Ÿ
3. **ãƒªã‚½ãƒ¼ã‚¹é…åˆ†**: ã©ã®Phaseã«ã©ã‚Œã ã‘ã®æ™‚é–“ã‚’å‰²ãã‹ï¼Ÿ

**æ¬¡ã®åˆ¤æ–­ãŒå¿…è¦**: ã“ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã§é€²ã‚ã¦è‰¯ã„ã‹ï¼Ÿ

---

**æœ€çµ‚æ›´æ–°**: 2025-12-06 10:45
**ä½œæˆè€…**: Claude (AI Assistant)
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: æœªå®Ÿæ–½
